<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>é€šè¿‡ HeadScale(TailScaleå¼€æºæœåŠ¡ç«¯) å¤šå¹³å°å®ç°å†…ç½‘ç©¿é€</title>
    <link href="/2024/03/20/12-intranet-penetration-headscale/"/>
    <url>/2024/03/20/12-intranet-penetration-headscale/</url>
    
    <content type="html"><![CDATA[<h1 id="HeadScale-æœåŠ¡ç«¯æ­å»º"><a href="#HeadScale-æœåŠ¡ç«¯æ­å»º" class="headerlink" title="HeadScale æœåŠ¡ç«¯æ­å»º"></a>HeadScale æœåŠ¡ç«¯æ­å»º</h1><blockquote><p><a href="https://github.com/juanfont/headscale">HeadScale</a> æ˜¯ä¸€ä¸ªå¼€æºçš„ TailScale æœåŠ¡ç«¯å®ç°ï¼Œå¯ä»¥å®ç°å¤šå¹³å°çš„å†…ç½‘ç©¿é€ã€‚</p></blockquote><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p><code>docker-compose.yaml</code> æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.9&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">headscale:</span><br>    <span class="hljs-comment"># é•œåƒç‰ˆæœ¬</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">headscale/headscale:0.23.0-alpha5</span><br>    <span class="hljs-comment"># å®¹å™¨åç§°</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">headscale</span><br>    <span class="hljs-comment"># æŒ‚è½½ç›®å½•æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œä¿®æ”¹ï¼ˆå®¿ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•ï¼‰</span><br>    <span class="hljs-comment"># å…¶ä¸­ /headscale/config ä¸ºé…ç½®æ–‡ä»¶ç›®å½•ï¼Œ/headscale/data ä¸ºæ•°æ®ç›®å½•ï¼Œ/headscale/run ä¸ºè¿è¡Œç›®å½•</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/headscale/config:/etc/headscale</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/headscale/data:/var/lib/headscale</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/headscale/run:/var/run/headscale</span><br>    <span class="hljs-comment"># ç«¯å£å·æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œä¿®æ”¹ï¼ˆå®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ï¼‰</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">8080</span><span class="hljs-string">:8080</span><br>    <span class="hljs-comment"># æ­¤å¤„æœ€æ–°ç‰ˆçš„å‘½ä»¤è¡Œå¿…é¡»ä½¿ç”¨ server å‘½ä»¤ï¼Œä¹‹å‰ç‰ˆæœ¬ä¸º headscale serve</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">serve</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºç›®å½•åŠé…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»ºå®¿ä¸»æœºæŒ‚è½½ç›®å½•</span><br><span class="hljs-built_in">mkdir</span> -p /headscale/config<br><span class="hljs-built_in">mkdir</span> -p /headscale/data<br><span class="hljs-built_in">mkdir</span> -p /headscale/run<br><span class="hljs-built_in">cd</span> /headscale<br><br><span class="hljs-comment"># åˆ›å»ºé…ç½®æ–‡ä»¶ï¼ˆé€šè¿‡wgetï¼‰</span><br>wget -O ./config/config.yaml https://raw.githubusercontent.com/juanfont/headscale/main/config-example.yaml<br><span class="hljs-comment"># æˆ–è€…é€šè¿‡curl</span><br>curl https://raw.githubusercontent.com/juanfont/headscale/main/config-example.yaml -o ./config/config.yaml<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># config.yaml(æ­¤å¤„å°±è®²å‡ ä¸ªå…³é”®é…ç½®ï¼Œå…¶ä»–åŸºæœ¬ä¸ç”¨ä¿®æ”¹)</span><br><span class="hljs-comment"># ä¿®æ”¹ server_url ä¸ºä½ çš„åŸŸå</span><br><span class="hljs-attr">server_url:</span> <span class="hljs-string">https://proxy.your-domain.com/</span><br><br><span class="hljs-comment"># ç›‘å¬åœ°å€ï¼ˆå¦‚æœä¸Šè¾¹å®¹å™¨ç«¯å£è¢«ä¿®æ”¹æ­¤å¤„ä¹Ÿè¦ä¿®æ”¹ï¼‰</span><br><span class="hljs-attr">listen_addr:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">:8080</span><br><br><span class="hljs-comment"># å½“ magic_dns ä¸º true æ—¶ï¼ŒHeadScale ä¼šè‡ªåŠ¨ä¸ºä½ çš„è®¾å¤‡åˆ†é…ä¸€ä¸ªåŸŸå(ä¹Ÿå°±æ˜¯ä¸‹è¾¹çš„base_domainï¼Œå¯ä»¥åœ¨å†…ç½‘ç¯å¢ƒè®¿é—®ï¼Œè€Œä¸éœ€è¦é€šè¿‡IP)</span><br><span class="hljs-attr">magic_dns:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">base_domain:</span> <span class="hljs-string">base_domain.com</span><br><br><span class="hljs-comment"># éšæœºåŒ–å®¢æˆ·ç«¯ç«¯å£</span><br><span class="hljs-attr">randomize_client_port:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨ Docker å®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åœ¨ docker-compose.yaml æ‰€åœ¨ç›®å½•ä¸‹å¯åŠ¨æœåŠ¡</span><br>docker-compose up -d<br></code></pre></td></tr></table></figure><h2 id="WEB-UIç®¡ç†å·¥å…·"><a href="#WEB-UIç®¡ç†å·¥å…·" class="headerlink" title="WEB-UIç®¡ç†å·¥å…·"></a>WEB-UIç®¡ç†å·¥å…·</h2><blockquote><p>è¿™ç±»æœåŠ¡ç«¯ä¸€èˆ¬éƒ½æœ‰ä¸€ä¸ª WEB-UI ç®¡ç†å·¥å…·ï¼ŒHeadScale ä¹Ÿä¸ä¾‹å¤–ã€‚</p><p>æ­¤å¤„ç”¨ <a href="https://github.com/GoodiesHQ/headscale-admin">headscale-admin</a> åšæ¼”ç¤ºï¼Œå…¶ä»–çš„ç®¡ç†å·¥å…·ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p></blockquote><p>ä½¿ç”¨ Docker è¿è¡Œå®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®¿ä¸»æœºç«¯å£éšæ„</span><br>docker run -p 8000:80 goodieshq/headscale-admin:latest<br></code></pre></td></tr></table></figure><h2 id="åå‘ä»£ç†é…ç½®"><a href="#åå‘ä»£ç†é…ç½®" class="headerlink" title="åå‘ä»£ç†é…ç½®"></a>åå‘ä»£ç†é…ç½®</h2><p>åœ¨ Nginx ä¸­é…ç½®åå‘ä»£ç†ï¼Œå°† HeadScale æœåŠ¡ç«¯çš„ 8080 ç«¯å£æ˜ å°„åˆ° 443 ç«¯å£ã€‚æƒ³å·æ‡’å°±ç›´æ¥é€šè¿‡é¢æ¿ç®¡ç†å·¥å…·æ·»åŠ ä¸€ä¸ªåå‘ä»£ç†ã€‚é…ç½®å®Œæ¯•è®°å¾—é‡è½½ Nginxã€‚å…¶ä»–WEBæœåŠ¡å™¨ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl http2;<br>    <span class="hljs-comment"># ä½ çš„åŸŸåï¼ˆè‡ªè¡Œä¿®æ”¹ï¼‰</span><br>    <span class="hljs-attribute">server_name</span> proxy.your-domain.com;<br><br>    <span class="hljs-comment"># è¯ä¹¦è·¯å¾„ï¼ˆè‡ªè¡Œä¿®æ”¹ï¼‰</span><br>    <span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/your-domain.com/fullchain.pem;<br>    <span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/your-domain.com/privkey.pem;<br><br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-comment"># ä»£ç†åœ°å€ï¼Œå¦‚æœä¸Šè¾¹æ˜ å°„çš„å®¿ä¸»æœºç«¯å£è¢«ä¿®æ”¹æ­¤å¤„ä¹Ÿè¦ä¿®æ”¹</span><br>        <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:8080;<br>        <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>    &#125;<br><br>    <span class="hljs-comment"># WEB-UI ç®¡ç†å·¥å…·, è®¿é—®åœ°å€ä¸º https://proxy.your-domain.com/admin</span><br>    <span class="hljs-section">location</span> /admin &#123;<br>        <span class="hljs-comment"># ä»£ç†åœ°å€ï¼Œå¦‚æœä¸Šè¾¹æ˜ å°„çš„å®¿ä¸»æœºç«¯å£è¢«ä¿®æ”¹æ­¤å¤„ä¹Ÿè¦ä¿®æ”¹</span><br>        <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:8000;<br>        <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>ä¸å‡ºæ„å¤–çš„è¯ï¼ŒHeadScale æœåŠ¡ç«¯å°±æ­å»ºå®Œæˆäº†ã€‚å‡ºæ„å¤–å°±åœ¨ä¸‹è¾¹ç•™è¨€å§ã€‚ğŸ˜Š</p><p>ç°åœ¨å°±å¯ä»¥é€šè¿‡ <code>https://proxy.your-domain.com/admin</code> è®¿é—® HeadScale çš„ WEB-UI é¡µé¢äº†ã€‚</p><p>PS: ç›´æ¥è®¿é—® <code>https://proxy.your-domain.com</code> æ²¡æ•ˆæœã€‚</p></blockquote><h2 id="WEB-UI-é…ç½®"><a href="#WEB-UI-é…ç½®" class="headerlink" title="WEB-UI é…ç½®"></a>WEB-UI é…ç½®</h2><p>é¦–å…ˆï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„ API å¯†é’¥ï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°é¡µé¢ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åœ¨ HeadScale æœåŠ¡ç«¯æ‰€åœ¨çš„å®¿ä¸»æœºä¸Šæ‰§è¡Œã€‚æ‰§è¡Œå®Œæ¯•åä¼šç”Ÿæˆä¸€ä¸ª API å¯†é’¥ã€‚</span><br>docker <span class="hljs-built_in">exec</span> -it headscale headscale apikeys create<br></code></pre></td></tr></table></figure><p>ç„¶åç‚¹å‡»é¡µé¢çš„ä¿å­˜æŒ‰é’®ï¼Œå‡ºç°å·¦ä¾§çš„èœå•å°±ç®—æˆåŠŸäº†ã€‚</p><p><img src="https://image.origin-tec.com/origin/2024/03/20/65fa99353a468.jpg" alt="HeadScale-Admin"></p><h1 id="TailScale-å®¢æˆ·ç«¯é…ç½®"><a href="#TailScale-å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="TailScale å®¢æˆ·ç«¯é…ç½®"></a>TailScale å®¢æˆ·ç«¯é…ç½®</h1><blockquote><p>ä¸‹è½½å¹¶å®‰è£… <a href="https://tailscale.com/download">TailScale</a> å®¢æˆ·ç«¯ã€‚</p></blockquote><p>åœ¨ WEB-UI è¿™é‡Œæ·»åŠ ç”¨æˆ·ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„keyï¼Œåè¾¹è¦ç”¨åˆ°ã€‚</p><p><img src="https://image.origin-tec.com/origin/2024/03/20/65fa9ab874689.jpg" alt="æ·»åŠ ç”¨æˆ·"></p><p><img src="https://image.origin-tec.com/origin/2024/03/20/65fa9b92abd4c.jpg" alt="ç”ŸæˆPreAuthKey"></p><p>ç„¶åæ ¹æ®ä½ å½“å‰è®¾å¤‡å¹³å°ï¼Œé€‰æ‹©å®‰è£…ä¸åŒçš„å®¢æˆ·ç«¯ã€‚<strong>è¦ä¿®æ”¹ URL ä¸ºä½ çš„ HeadScale æœåŠ¡ç«¯åŸŸåã€‚</strong></p><h2 id="Linux-å®¢æˆ·ç«¯éƒ¨ç½²"><a href="#Linux-å®¢æˆ·ç«¯éƒ¨ç½²" class="headerlink" title="Linux å®¢æˆ·ç«¯éƒ¨ç½²"></a>Linux å®¢æˆ·ç«¯éƒ¨ç½²</h2><p>æ­¤å¤„ä»¥ CentOS ä¸ºä¾‹ï¼ˆå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å·²ç»æ˜¯ root ç”¨æˆ·å°±ä¸ç”¨è¾“å…¥ sudo äº†ã€‚</span><br>sudo dnf config-manager --add-repo https://pkgs.tailscale.com/stable/centos/8/tailscale.repo<br>sudo dnf install tailscale<br><br>sudo systemctl <span class="hljs-built_in">enable</span> --now tailscaled<br></code></pre></td></tr></table></figure><p>ä¸»è¦æ˜¯åç»­æ­¥éª¤ä¸åŒï¼Œè¿™é‡Œæ‰“å¼€ WEB-UI é¡µé¢ï¼Œé€‰æ‹© Deployï¼Œå¤åˆ¶ç”Ÿæˆçš„å‘½ä»¤è¡Œï¼š</p><p><img src="https://image.origin-tec.com/origin/2024/03/20/65fa9d456ebe5.jpg" alt="deploy"></p><blockquote><p>å¦‚æœåªéœ€è¦é€šè¿‡å†…ç½‘IPè¿›è¡Œè®¿é—®ï¼Œå°±ä¸éœ€è¦å‹¾é€‰ â€“accept-dns äº†ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åœ¨ä½ çš„è®¾å¤‡ä¸Šæ‰§è¡Œï¼ˆæ­¤å¤„ä»…ä½œä¸ºå‚è€ƒï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰</span><br>tailscale up --login-server=https://proxy.your-domain.com --reset --authkey=xxx --accept-dns --accept-routes<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹çŠ¶æ€</span><br>tailscale status<br></code></pre></td></tr></table></figure><p>ç„¶åç°åœ¨å®¢æˆ·ç«¯å°±éƒ¨ç½²æˆåŠŸäº†ï¼Œå¯ä»¥é€šè¿‡å†…ç½‘IPè¿›è¡Œè®¿é—®äº†ã€‚å…¶ä»–å¹³å°çš„éƒ¨ç½²å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚<br>ä¾‹å¦‚ï¼š<a href="https://github.com/juanfont/headscale/blob/main/docs/android-client.md">Android</a>ã€<a href="https://github.com/juanfont/headscale/blob/main/docs/iOS-client.md">iOS</a>ã€<a href="https://github.com/juanfont/headscale/blob/main/docs/windows-client.md">Windows</a> ç­‰ã€‚</p><p>å®¢æˆ·ç«¯æä¾›å¾ˆå¤šåŠŸèƒ½ï¼Œä¾‹å¦‚å¯ä»¥é€šè¿‡å†…ç½‘ä¼ è¾“æ–‡ä»¶ã€è¿œç¨‹æ¡Œé¢ã€è¿œç¨‹è°ƒè¯•ç­‰ï¼Œå¦å¤–è¿˜å¯ä»¥é€šè¿‡å…¬ç½‘æœåŠ¡å™¨åå‘ä»£ç†è®¿é—®å†…ç½‘æœåŠ¡å™¨ï¼Œç”¨äºæ•°æ®å¤„ç†ç­‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># éƒ¨ç½²äº†å¤šå°è®¾å¤‡ä¹‹åï¼Œå¯ä»¥é€šè¿‡Pingæµ‹è¯•ä¸€ä¸‹(æ­¤å¤„ä¿®æ”¹ä¸ºä½ éœ€è¦PINGçš„è®¾å¤‡å†…ç½‘IP)</span><br>tailscale ping xxx.xxx.xxx.xxx<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå¦‚æœä½ å¯èƒ½å‘ç°è®¿é—®é€Ÿåº¦å¯èƒ½ä¼šæœ‰ç‚¹æ…¢ï¼Œå¯ä»¥é€šè¿‡é…ç½® Derp ä¸­ç»§æœåŠ¡å™¨æ¥è§£å†³ï¼Œå¯ä»¥å¿«é€Ÿæ‰“æ´ï¼Œå¦‚æœä¸æˆåŠŸä¹Ÿèƒ½è¿›è¡Œå…œåº•ã€‚</p><h1 id="Derp-æœåŠ¡ç«¯éƒ¨ç½²"><a href="#Derp-æœåŠ¡ç«¯éƒ¨ç½²" class="headerlink" title="Derp æœåŠ¡ç«¯éƒ¨ç½²"></a>Derp æœåŠ¡ç«¯éƒ¨ç½²</h1><p>å¯å‚è€ƒ <a href="https://github.com/fredliang44/derper-docker">derper-docker</a>ï¼Œdocker-compose.yaml æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.5&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">derper:</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">derper</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">fredliang/derper</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-comment"># æ­¤å¤„ä¿®æ”¹ä¸ºä½ çš„è¯ä¹¦ç›®å½•ï¼ˆä¾‹å¦‚letsencryptçš„è¯ä¹¦ï¼Œç›®å½•éœ€è¦åŒ…å«fullchain.pemã€privkey.pem ç­‰æ–‡ä»¶ï¼‰</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./cert:/cert</span><br>      <span class="hljs-comment"># handscale.sock</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;headscale/run/handscale.sock:/var/run/tailscale/tailscaled.sock:ro&#x27;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-comment"># è®°å¾—é˜²ç«å¢™å¼€æ”¾ç«¯å£ï¼ˆäº‘æœåŠ¡å™¨åŒæ ·ï¼‰</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">3478</span><span class="hljs-string">:3478/udp</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">23479</span><span class="hljs-string">:23479</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-comment"># æ­¤å¤„ä¿®æ”¹ä¸ºä½ çš„åŸŸå</span><br>      <span class="hljs-attr">DERP_DOMAIN:</span> <span class="hljs-string">derp.your-domain.com</span><br>      <span class="hljs-comment"># ç«¯å£å·æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œä¿®æ”¹</span><br>      <span class="hljs-attr">DERP_ADDR:</span> <span class="hljs-string">&#x27;:23479&#x27;</span><br>      <span class="hljs-comment"># æ­¤å¤„ä¿®æ”¹ä¸ºä½ çš„è¯ä¹¦ç›®å½•</span><br>      <span class="hljs-attr">DERP_CERT_DIR:</span> <span class="hljs-string">/cert</span><br>      <span class="hljs-comment"># è¯ä¹¦æ¨¡å¼ï¼ˆè¿™é‡Œè¯·å‚è€ƒä¸Šè¾¹çš„ derper-dockerï¼‰</span><br>      <span class="hljs-attr">DERP_CERT_MODE:</span> <span class="hljs-string">&#x27;letsencrypt&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿è¡Œ Docker å®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åœ¨ docker-compose.yaml æ‰€åœ¨ç›®å½•ä¸‹å¯åŠ¨æœåŠ¡</span><br>docker-compose up -d<br></code></pre></td></tr></table></figure><p>ç„¶åè®¾ç½®åå‘ä»£ç†ï¼Œä¾‹å¦‚æŠŠä½ çš„ <code>derp.your-domain.com</code> ä»£ç†åˆ° <code>127.0.0.1:23479</code>ï¼Œhttpsåè®®ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p><p>æ­¤æ—¶è®¿é—®ä½ çš„ <code>https://derp.your-domain.com</code> é¡µé¢ä¼šæ˜¾ç¤ºç›¸å…³ä¿¡æ¯ï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸäº†ã€‚</p><p>é…ç½®å®Œæ¯•ååœ¨ <code>config.yaml</code> æ‰€åœ¨ç›®å½• <code>/headscale/config</code> ä¸‹æ·»åŠ  <code>derp.yaml</code> æ–‡ä»¶ï¼Œå¹¶ä¿®æ”¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># derp.yaml</span><br><span class="hljs-comment"># If you plan to somehow use headscale, please deploy your own DERP infra: https://tailscale.com/kb/1118/custom-derp-servers/</span><br><span class="hljs-attr">regions:</span><br>  <span class="hljs-attr">900:</span><br>    <span class="hljs-attr">regionid:</span> <span class="hljs-number">900</span><br>    <span class="hljs-attr">regioncode:</span> <span class="hljs-string">åœ°åŸŸä»£ç </span><br>    <span class="hljs-attr">regionname:</span> <span class="hljs-string">åœ°åŸŸåç§°</span><br>    <span class="hljs-attr">nodes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">900a</span><br>        <span class="hljs-attr">regionid:</span> <span class="hljs-number">900</span><br>        <span class="hljs-attr">hostname:</span> <span class="hljs-string">derp.your-domain.com</span><br>        <span class="hljs-attr">ipv4:</span> <span class="hljs-string">ä½ çš„å…¬ç½‘IP</span><br>        <span class="hljs-attr">stunport:</span> <span class="hljs-number">3478</span><br>        <span class="hljs-attr">stunonly:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">derpport:</span> <span class="hljs-number">443</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ HeadScale æœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ  Derp é…ç½®è·¯å¾„ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># config.yaml</span><br><span class="hljs-attr">derp:</span> <br> <span class="hljs-comment"># å°†é»˜è®¤çš„ DERP æœåŠ¡å™¨æ³¨é‡Šæ‰</span><br> <span class="hljs-attr">urls:</span><br>    <span class="hljs-comment"># - https://controlplane.tailscale.com/derpmap/default</span><br> <span class="hljs-comment"># è‡ªå®šä¹‰ DERP æœåŠ¡å™¨è·¯å¾„</span><br> <span class="hljs-attr">paths:</span> <br>    <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/headscale/derp.yaml</span><br></code></pre></td></tr></table></figure><p>é…ç½®å®Œæ¯•åé€šè¿‡ <code>docker restart</code> é‡å¯ HeadScale æœåŠ¡ç«¯ã€‚å†ç„¶ååœ¨å®¢æˆ·ç«¯é‡æ–°è¿è¡Œ tailscale ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">tailscale down<br>tailscale up <br></code></pre></td></tr></table></figure><p>ç½‘ç»œæ£€æŸ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tailscale netcheck<br></code></pre></td></tr></table></figure><p>å¦‚æœå±•ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼Œè¯´æ˜é…ç½®æˆåŠŸäº†ã€‚</p><p><img src="https://image.origin-tec.com/origin/2024/03/20/65faa8911f9cf.jpg" alt="derp"></p><p>ç°åœ¨ï¼Œå†…ç½‘ç©¿é€å°±é…ç½®å®Œæˆäº†ï¼Œå¯ä»¥é€šè¿‡å…¬ç½‘IPè®¿é—®å†…ç½‘æœåŠ¡å™¨äº†ï¼Œé€Ÿåº¦ä¹Ÿä¼šæå‡å·¨å¤§ã€‚</p><p><strong>Enjoy it! ğŸ‰</strong></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://github.com/juanfont/headscale">HeadScale Git</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://github.com/GoodiesHQ/headscale-admin">headscale-admin Git</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://tailscale.com/">TailScale Website</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://github.com/fredliang44/derper-docker">Derper-Docker</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å†…ç½‘ç©¿é€</tag>
      
      <tag>headscale</tag>
      
      <tag>tailscale</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hiå·¥å¤§Proé¡¹ç›®å‰ç«¯æŠ€æœ¯ç»†èŠ‚è§£æ</title>
    <link href="/2022/09/16/11-hi-miniprogram/"/>
    <url>/2022/09/16/11-hi-miniprogram/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><blockquote><p><a href="https://hi-plus.windstormlab.com/">Hiå·¥å¤§Pro</a> æ˜¯ä¸€æ¬¾æœåŠ¡äºå¤§å­¦ç”Ÿçš„æ ¡å›­ç”Ÿæ´»å¹³å°ï¼Œä½¿ç”¨äººæ•°è¾¾åˆ°æ•°ä¸‡äººï¼Œç”¨æˆ·ç²˜æ€§è¾ƒé«˜ï¼Œæ·±å—å¹¿å¤§ç”¨æˆ·å–œçˆ±ã€‚è¯¥é¡¹ç›®åŒ…å«è®ºå›ç¤¾äº¤ã€ä»Šæ—¥è¯¾è¡¨ã€æŸ¥è¯¾è¡¨ã€æŸ¥æˆç»©ã€æŸ¥ç©ºæ•™å®¤ã€å¤±ç‰©æ‹›é¢†ã€å¯»ç‰©å¯äº‹ã€æ ¡å›­å¤©æ°”æŸ¥è¯¢ç­‰ä¸€ç³»åˆ—åŠŸèƒ½ï¼Œå¹¶å…¨å±€é€‚é…æš—é»‘ä¸»é¢˜ï¼Œæ”¯æŒæ›´æ¢ä¸»é¢˜é…è‰²ã€‚å¯ä»¥æ‰«ç ä½“éªŒï¼ŒåŒ…å«å¾®ä¿¡å’ŒQQå°ç¨‹åºã€‚</p></blockquote><p><img src="https://image.origin-tec.com/img/c67e6379ad706b4237c6a27f52ab5ff9@860x860.jpg?x-oss-process=image/resize,w_256,h_256,m_fixed" alt="å¾®ä¿¡å°ç¨‹åº"></p><p><img src="https://image.origin-tec.com/img/1a7172ada8fbfb0aa35b1440b011e812@580x580.png?x-oss-process=image/resize,w_256,h_256,m_fixed" alt="QQå°ç¨‹åº"></p><h1 id="æŠ€æœ¯ç›¸å…³"><a href="#æŠ€æœ¯ç›¸å…³" class="headerlink" title="æŠ€æœ¯ç›¸å…³"></a>æŠ€æœ¯ç›¸å…³</h1><blockquote><p>æœ¬äººä½œä¸ºè¯¥é¡¹ç›®å›¢é˜ŸæŠ€æœ¯è´Ÿè´£äººï¼Œè´Ÿè´£è¯¥é¡¹ç›®æŠ€æœ¯æ ˆæ¶æ„é€‰å‹ã€å‰åç«¯å¼€å‘ã€é¡¹ç›®éƒ¨ç½²ã€ä»£ç è§„èŒƒçº¦æŸã€é¡¹ç›®UIè®¾è®¡ç­‰å·¥ä½œã€‚å…¶ä¸­è¯¥é¡¹ç›®80%å‰ç«¯å¼€å‘åŠ95%åç«¯å¼€å‘å‡ç”±æœ¬äººç‹¬ç«‹å®Œæˆã€‚</p></blockquote><h2 id="å‰ç«¯æŠ€æœ¯æ¶æ„"><a href="#å‰ç«¯æŠ€æœ¯æ¶æ„" class="headerlink" title="å‰ç«¯æŠ€æœ¯æ¶æ„"></a>å‰ç«¯æŠ€æœ¯æ¶æ„</h2><h3 id="ç‰ˆæœ¬è¿­ä»£"><a href="#ç‰ˆæœ¬è¿­ä»£" class="headerlink" title="ç‰ˆæœ¬è¿­ä»£"></a>ç‰ˆæœ¬è¿­ä»£</h3><h4 id="V1-x-V2-x-2020-3-2021-9"><a href="#V1-x-V2-x-2020-3-2021-9" class="headerlink" title="V1.x ~ V2.x (2020.3 ~ 2021.9)"></a>V1.x ~ V2.x (2020.3 ~ 2021.9)</h4><p>è¯¥ç‰ˆæœ¬å‰ç«¯æŠ€æœ¯æ ˆé‡‡ç”¨çš„æ˜¯åŸç”Ÿå°ç¨‹åºï¼Œé€šè¿‡Giteeå¹³å°è¿›è¡Œé¡¹ç›®ä»£ç ç®¡ç†ï¼Œæœ‰ä»£ç ç›¸åº”è§„èŒƒï¼Œä½†æœªé‡‡å–ç»Ÿä¸€çš„é›†æˆéƒ¨ç½²ï¼Œä»æ˜¯æ‰‹åŠ¨æ‰“åŒ…ä¸Šä¼ è‡³å¾®ä¿¡å†æ‰‹åŠ¨æäº¤å®¡æ ¸ã€‚</p><p>è¯¥ç‰ˆæœ¬è¿­ä»£ä¼˜åŒ–åï¼ŒåŒ…å«ä»Šæ—¥è¯¾è¡¨ã€æŸ¥è¯¾è¡¨ã€æŸ¥æˆç»©ã€æŸ¥ç©ºæ•™å®¤ã€ç»©ç‚¹é¢„è­¦ã€ç­‰çº§è€ƒè¯•ã€ç«èµ›é€šçŸ¥ã€æ ¡å›­å¤©æ°”ã€ç¤¾å›¢ç»„ç»‡ã€æ ¡è½¦æ ¡å†ã€å¤±ç‰©æ‹›é¢†ã€å¯»ç‰©å¯äº‹ã€è¶£ç©ï¼ˆè¶£å®šå‘æ‰“å¡åŠŸèƒ½ï¼‰ã€è¶£è·‘ï¼ˆå®ç°äº†å°ç¨‹åºç«¯çš„åœ¨çº¿è·‘æ­¥ï¼ŒåŒ…å«è¿åŠ¨è½¨è¿¹åœ°å›¾ã€é€Ÿåº¦å¡è·¯é‡Œæ ‡æ³¨ã€åœ¨çº¿æ’è¡Œæ¦œï¼‰ç­‰ç›¸åº”åŠŸèƒ½ã€‚</p><h4 id="V3-x-ï¼ˆ2021-9-è‡³ä»Šï¼‰"><a href="#V3-x-ï¼ˆ2021-9-è‡³ä»Šï¼‰" class="headerlink" title="V3.x ï¼ˆ2021.9 ~ è‡³ä»Šï¼‰"></a>V3.x ï¼ˆ2021.9 ~ è‡³ä»Šï¼‰</h4><p>åç»­åº”é¡¹ç›®éœ€è¦ï¼Œä¸ºå®ç°å¤šå¹³å°éƒ¨ç½²ï¼Œé™ä½å¼€å‘æˆæœ¬ï¼ˆå¦‚æ‰“åŒ…ä¸ºAndroidå’ŒiOSåº”ç”¨ï¼‰ã€‚é‚é‡‡å–UniAppæ¡†æ¶å¯¹é¡¹ç›®è¿›è¡Œé‡æ„ä¼˜åŒ–ï¼ˆå¯ä»¥å®ç°å¤šå¹³å°éƒ¨ç½²ï¼‰ï¼Œå¹¶åŠ å…¥äº† <strong>node_modulesåŒ…ç®¡ç†</strong> å’Œ <strong>Jenkinsé›†æˆéƒ¨ç½²</strong>ã€‚è¯¥é¡¹ç›®äº2021å¹´9æœˆåº•å¤§éƒ¨åˆ†é‡æ„å®Œæ¯•åï¼Œç»Ÿä¸€éƒ¨ç½²è‡³å¾®ä¿¡å’ŒQQå°ç¨‹åºç«¯ã€‚</p><p>è¯¥ç‰ˆæœ¬ä¸»è¦åŠ å…¥äº†è®ºå›ç¤¾äº¤æ¨¡å—ï¼Œæ”¯æŒæ‰‹æœºå·ã€å¾®ä¿¡ã€QQç™»å½•ï¼Œä¸”æ”¯æŒå¤šæ ¡å›­å¤šç³»ç»Ÿï¼ˆåç«¯å®ç°äº†å¤šä¸ªæ•™åŠ¡ç³»ç»Ÿçš„çˆ¬è™«ï¼‰é€‚é…ï¼Œå¹¶è¿­ä»£æ‰äº†éå¿…è¦çš„ç¤¾å›¢ç»„ç»‡ã€ç­‰çº§è€ƒè¯•ã€ç«èµ›é€šçŸ¥ã€è¶£ç©ã€è¶£è·‘ç­‰åŠŸèƒ½ã€‚</p><h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><p><img src="https://image.origin-tec.com/img/daec55b4f48bd0e728e525fd100ecd3b@251x796.png" alt="é¡¹ç›®ç»“æ„"></p><p>è¯¥é¡¹ç›®ä½¿ç”¨ Yarn ä½œä¸ºåŒ…ç®¡ç†å·¥å…·ã€‚å…¶ä¸­æœ€é‡è¦çš„æ˜¯ src ç›®å½•ä¸‹çš„ä¸€ç³»åˆ—æ–‡ä»¶ï¼Œå¦‚:</p><ul><li>assetsã€static: é™æ€æ–‡ä»¶ï¼Œå¦‚ css åŠ å›¾ç‰‡ ç­‰</li><li>ci: åŒ…å«å¾®ä¿¡åŠQQå°ç¨‹åºçš„é›†æˆéƒ¨ç½²ç›¸å…³æ“ä½œ</li><li>components: é¡¹ç›®ä¸­å¼•å…¥çš„ç»„ä»¶ï¼ŒåŒ…å«è‡ªå®šä¹‰å°è£…ç»„ä»¶ä¸å¤–éƒ¨ç»„ä»¶åº“ç­‰ã€‚</li><li>pages: é¡¹ç›®é¡µé¢ç›¸å…³æºä»£ç </li><li>private-key: ç»§æ‰¿éƒ¨ç½²éªŒè¯éœ€è¦çš„ç§é’¥æ–‡ä»¶</li><li>utils: é¡¹ç›®éœ€è¦çš„ä¸€äº›å·¥å…·ç±»åº“ç­‰</li></ul><h3 id="æŠ€æœ¯ç»†èŠ‚"><a href="#æŠ€æœ¯ç»†èŠ‚" class="headerlink" title="æŠ€æœ¯ç»†èŠ‚"></a>æŠ€æœ¯ç»†èŠ‚</h3><h4 id="å¦‚ä½•å®ç°çš„æš—é»‘ä¸»é¢˜ï¼ˆå¤šé…è‰²ï¼‰é€‚é…ï¼Ÿ"><a href="#å¦‚ä½•å®ç°çš„æš—é»‘ä¸»é¢˜ï¼ˆå¤šé…è‰²ï¼‰é€‚é…ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°çš„æš—é»‘ä¸»é¢˜ï¼ˆå¤šé…è‰²ï¼‰é€‚é…ï¼Ÿ"></a>å¦‚ä½•å®ç°çš„æš—é»‘ä¸»é¢˜ï¼ˆå¤šé…è‰²ï¼‰é€‚é…ï¼Ÿ</h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œæš—é»‘ä¸»é¢˜é€‚é…æœ‰ä¸¤ç§æ–¹æ¡ˆ : </p><ul><li>æ ¹æ® css ä¸­çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media/prefers-color-scheme">åª’ä½“æŸ¥è¯¢</a>ï¼Œ@media(prefers-color-scheme<br>: dark )</li><li>é€šè¿‡è°ƒç”¨APIè·å–ç³»ç»Ÿä¸­çš„å½“å‰ä¸»é¢˜å†åšå‡ºç›¸åº”cssä¿®æ”¹ã€‚</li></ul><p>æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®é‡‡å–çš„æ˜¯ç¬¬äºŒç§æ–¹æ³•ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸é‡‡å–ç¬¬ä¸€ç§æ–¹æ¡ˆå‘¢ï¼Ÿä¸æ˜¯æ›´æ–¹ä¾¿ä¸€äº›å—ï¼Œç”šè‡³éƒ½ä¸éœ€è¦å†™JSå±‚é¢çš„ä»£ç ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬åº”è¯¥çŸ¥é“å¦‚æœé€šè¿‡åª’ä½“æŸ¥è¯¢è¿›è¡Œé€‚é…æš—é»‘ä¸»é¢˜è‰²ï¼Œé‚£ä¹ˆå½“å‰åº”ç”¨çš„ä¸»é¢˜è‰²åªèƒ½å’Œç³»ç»Ÿä¿æŒä¸€è‡´ï¼Œè€Œæ— æ³•è¢«ç”¨æˆ·é€šè¿‡åº”ç”¨å†…çš„è®¾ç½®åšå‡ºç›¸åº”çš„ä¿®æ”¹ã€‚</p><p>è€Œå¦‚æœå½“æˆ‘ä»¬é‡‡å–APIè·å–ç³»ç»Ÿä¸»é¢˜æ–¹å¼ï¼Œå¯ä»¥è®©ç”¨æˆ·é€‰æ‹©æ˜¯å¦è·Ÿéšç³»ç»Ÿä¸»é¢˜ï¼Œè·å–åº”ç”¨å†…ç‹¬ç«‹è®¾ç½®å½“å‰ä¸»é¢˜é…è‰²ã€‚</p><p>å¯ä»¥çœ‹ä¸‹é¡¹ç›®ä¸­è¯¥éƒ¨åˆ†ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">loadTheme</span> = (<span class="hljs-params">that, isSetFrontColor = <span class="hljs-literal">true</span>, setTabbar = <span class="hljs-literal">false</span></span>) =&gt;  &#123;<br>    <span class="hljs-comment">// å…¶ä¸­ that æŒ‡å‘çš„æ˜¯è°ƒç”¨loadThemeå‡½æ•°çš„æŒ‡å®šåº”ç”¨å®ä¾‹</span><br>    <span class="hljs-comment">// isSetFrontColor è¡¨ç¤ºæ˜¯å¦éœ€è¦è®¾ç½®å‰æ™¯è‰²</span><br>    <span class="hljs-comment">// setTabbar è¡¨ç¤ºæ˜¯å¦éœ€è¦ä¿®æ”¹tabbarçš„ä¸»é¢˜è‰²</span><br>     uni.<span class="hljs-title function_">setBackgroundColor</span>(&#123;<br>       <span class="hljs-attr">backgroundColor</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">navbarColor</span>,<br>     &#125;);<br>     <span class="hljs-keyword">if</span> (isSetFrontColor || <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">type</span> == <span class="hljs-string">&quot;dark&quot;</span>) &#123;<br>       uni.<span class="hljs-title function_">setNavigationBarColor</span>(&#123;<br>         <span class="hljs-attr">frontColor</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">statusColor</span>,<br>         <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&quot;#ffffff&quot;</span>,<br>       &#125;);<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>       <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">type</span> == <span class="hljs-string">&quot;light&quot;</span>) &#123;<br>         uni.<span class="hljs-title function_">setNavigationBarColor</span>(&#123;<br>           <span class="hljs-attr">frontColor</span>: <span class="hljs-string">&quot;#000000&quot;</span>,<br>           <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&quot;#ffffff&quot;</span>,<br>         &#125;);<br>       &#125;<br>     &#125;<br>     <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">navbarColor</span> === <span class="hljs-string">&quot;undefined&quot;</span>) &#123;<br>       <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">navbarColor</span> =<br>         <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">backgroundColor</span>;<br>     &#125;<br>     <span class="hljs-keyword">let</span> themeType = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">type</span>;<br>     <span class="hljs-keyword">let</span> currentType = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">tabbar</span>.<span class="hljs-property">current</span>;<br><br>     <span class="hljs-keyword">if</span> (setTabbar) &#123;<br>       <span class="hljs-keyword">let</span> list = [];<br>       <span class="hljs-keyword">let</span> length = list.<span class="hljs-property">length</span>;<br>       <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">tabbar</span>.<span class="hljs-property">current</span> = themeType;<br>       <span class="hljs-keyword">if</span> (themeType === <span class="hljs-string">&quot;dark&quot;</span>) &#123;<br>         uni.<span class="hljs-title function_">setTabBarStyle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">tabbar</span>.<span class="hljs-property">dark</span>);<br>         list = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">tabbar</span>.<span class="hljs-property">dark</span>.<span class="hljs-property">list</span>;<br>         length = list.<span class="hljs-property">length</span>;<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>         uni.<span class="hljs-title function_">setTabBarStyle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">tabbar</span>.<span class="hljs-property">light</span>);<br>         list = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">tabbar</span>.<span class="hljs-property">light</span>.<span class="hljs-property">list</span>;<br>         length = list.<span class="hljs-property">length</span>;<br>       &#125;<br>       <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br>         <span class="hljs-comment">// å¯¹ tabbarä¸­çš„æ¯ä¸€ä¸ª item è¿›è¡Œéå†ï¼Œå¹¶è°ƒç”¨ setTabBarItem APIè¿›è¡Œç›¸åº”ä¿®æ”¹</span><br>         uni.<span class="hljs-title function_">setTabBarItem</span>(&#123;<br>           <span class="hljs-attr">index</span>: i,<br>           ...list[i],<br>         &#125;);<br>       &#125;<br>     &#125;<br>     <span class="hljs-comment">// æ­¤å¤„ä¸»é¢˜è‰²ä¿å­˜åœ¨å…¨å±€éå† theme ä¸­</span><br>     (that.<span class="hljs-property">themeType</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">type</span>),<br>       (that.<span class="hljs-property">statusColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">statusColor</span>),<br>       (that.<span class="hljs-property">navFontColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">navFontColor</span>),<br>       (that.<span class="hljs-property">fontColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">fontColor</span>),<br>       (that.<span class="hljs-property">navbarColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">navbarColor</span>),<br>       (that.<span class="hljs-property">bgColorTop</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">navbarColor</span>),<br>       (that.<span class="hljs-property">bgImage</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">bgImage</span>),<br>       (that.<span class="hljs-property">scheduleBgImage</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">scheduleBgImage</span>),<br>       (that.<span class="hljs-property">homeBgImage</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">homeBgImage</span>),<br>       (that.<span class="hljs-property">appImages</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">globalData</span>.<span class="hljs-property">appImages</span>);<br>   &#125;,<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨æŒ‡å®šé¡µé¢å®ä¾‹ä¸­ï¼ˆå¦‚pages&#x2F;index&#x2F;index.vueï¼‰ï¼Œæˆ‘ä»¬ä¼šåœ¨ onLoad è¿™ä¸ªHookå‡½æ•°ä¸­è°ƒç”¨å…¨å±€æä¾›çš„ loadTheme å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// æ­¤å¤„ app é€šè¿‡ getApp() è·å–çš„ï¼ŒæŒ‡å‘çš„æ˜¯å…¨å±€å®ä¾‹ã€‚</span><br><span class="hljs-keyword">if</span> (app.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">ready</span>) &#123;<br>app.<span class="hljs-title function_">loadTheme</span>(<span class="hljs-variable language_">this</span>, app.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">type</span> == <span class="hljs-string">&quot;dark&quot;</span>, <span class="hljs-literal">true</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ª callback å›è°ƒå‘¢ï¼Ÿ</span><br>    <span class="hljs-comment">// å› ä¸ºä¸»é¢˜è‰²é…ç½® app.globalData.theme æ˜¯åœ¨ localstorage ä¸­è¯»å–çš„ï¼Œè€Œ onLoad é’©å­å‡½æ•°è§¦å‘çš„äº‹ä»¶ä¸ä¸€å®šåœ¨é…ç½®å†…å®¹è¯»å–å®Œæ¯•ä¹‹åå‘ç”Ÿã€‚</span><br>    <span class="hljs-comment">// æ‰€ä»¥éœ€è¦ä¸€ä¸ªreadyçš„åˆ¤æ–­ï¼Œå¦‚æœæœªå®Œæˆè¯»å–ï¼Œåˆ™å¢åŠ ä¸€ä¸ªå›è°ƒï¼Œç­‰å¾…è¯»å–å®Œæ¯•åç›´æ¥è°ƒç”¨</span><br>    app.<span class="hljs-property">themeReadyCallback</span> = <span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>        app.<span class="hljs-title function_">loadTheme</span>(<span class="hljs-variable language_">this</span>, app.<span class="hljs-property">globalData</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">type</span> == <span class="hljs-string">&quot;dark&quot;</span>, <span class="hljs-literal">true</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆ loadTheme è°ƒç”¨å®Œæ¯•åï¼Œé¡µé¢ä¸Šä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ -&gt; ä¸»é¢˜ä¼šè¢«æ”¹å˜</p><p>ä¸»é¢˜æ˜¯å¦‚ä½•è¢«æ”¹å˜çš„å‘¢ï¼Œè¿™é‡Œå¯ä»¥å‚è€ƒä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;&#x27;theme-&#x27; + themeType&quot;</span>&gt;</span><br>        æ‰€æœ‰çš„pagesé¡µé¢æœ€å¤–å±‚å‡ä¼šåŒ…å«ä¸€ä¸ª themeTypeä¸»é¢˜ç±»å‹çš„å˜é‡ã€‚<br>        é€šè¿‡ä¿®æ”¹è¿™ä¸ªå˜é‡å†ç»“åˆVueçš„å“åº”å¼åŸç†ï¼Œé€šçŸ¥åˆ°ä½¿ç”¨åˆ°è¿™ä¸ªå˜é‡çš„åœ°æ–¹è¿›è¡Œç›¸åº”ä¿®æ”¹ã€‚<br>        ç„¶åæ ¹æ®ä¸åŒçš„ class ç±»é€‰æ‹©å™¨ï¼Œé¡µé¢åˆ™ä¼šæ¸²æŸ“ä¸åŒçš„æ ·å¼ã€‚<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å…¬å…±æš—é»‘ä¸»é¢˜æ ·å¼ï¼ˆassets&#x2F;css&#x2F;theme-dark.lessï¼‰</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-class">.theme-dark</span>&#123;<br><span class="hljs-selector-tag">input</span>,<span class="hljs-selector-tag">textarea</span>&#123;<br><span class="hljs-attribute">color</span>:var(--theme-dark-font)<span class="hljs-meta">!important</span>;<br>&#125;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå…¶å®è¿˜æ¶‰åŠåˆ°ä¸»é¢˜é…ç½®é¡¹è¯»å–çš„å‡½æ•°åŠä¸»é¢˜é…è‰²ä¿®æ”¹é¡µé¢çš„ä¸€äº›å‡½æ•°ï¼Œä½†å†…å®¹è¿‡å¤šï¼Œå°±ä¸è¿‡äºèµ˜è¿°äº†ã€‚</p><h4 id="é¡¹ç›®å›¾ç‰‡æ‡’åŠ è½½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#é¡¹ç›®å›¾ç‰‡æ‡’åŠ è½½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="é¡¹ç›®å›¾ç‰‡æ‡’åŠ è½½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"></a>é¡¹ç›®å›¾ç‰‡æ‡’åŠ è½½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h4><p>è¿™ä¸ªé¡¹ç›®ä¸­çš„ç»å¤§éƒ¨åˆ†å›¾ç‰‡ï¼ˆä¾‹å¦‚è®ºå›åŠ¨æ€ä¸­çš„å›¾ç‰‡ã€å¤´åƒç­‰ï¼‰éƒ½ç”¨ç»„ä»¶è¿›è¡Œå°è£…ï¼Œå¹¶åŠ å…¥äº†å›¾ç‰‡æ‡’åŠ è½½ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½å®Œæ¯•ï¼Œç¼“è§£CDNçš„å‹åŠ›ã€‚</p><p>æœ‰çš„å¯èƒ½çœ‹åˆ°å°±è§‰å¾—ï¼Œå›¾ç‰‡æ‡’åŠ è½½è¿˜ä¸ç®€å•ï¼Œæˆ‘å€’ç€éƒ½èƒ½å†™ï¼</p><p>å…¶å®å·®ä¸å¤šæ˜¯è¿™æ ·ï¼ŒæŠ€æœ¯å«é‡ä¸é«˜ï¼Œä½†å­˜åœ¨è®©æˆ‘ä»¬æ€è€ƒçš„ç»†èŠ‚ã€‚</p><!-- æˆ‘è¿™é‡Œä¹Ÿèƒ½æä¾›ä¸‰ç§å®ç°å›¾ç‰‡æ‡’åŠ è½½çš„æ–¹æ¡ˆï¼š --><p><strong>æœªå®Œå¾…ç»­</strong></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hiå·¥å¤§Pro</tag>
      
      <tag>è‡ªç ”é¡¹ç›®</tag>
      
      <tag>å°ç¨‹åº</tag>
      
      <tag>å‰ç«¯æŠ€æœ¯</tag>
      
      <tag>UniApp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Web Tracking å‰ç«¯åŸ‹ç‚¹æŠ€æœ¯æ¢ç©¶</title>
    <link href="/2022/07/25/10-web-tracking/"/>
    <url>/2022/07/25/10-web-tracking/</url>
    
    <content type="html"><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><blockquote><p>Web Trackingï¼ˆæ­¤å¤„ç»†åˆ†æ¥è¯´åº”è¯¥å« Web beaconï¼‰ã€‚Web beacon æ˜¯ä¸€ç§åœ¨ç½‘é¡µå’Œç”µå­é‚®ä»¶ä¸Šä½¿ç”¨çš„æŠ€æœ¯ï¼Œå¯ä»¥ä¸æ˜¾çœ¼åœ°ï¼ˆé€šå¸¸æ˜¯æ— å½¢çš„ï¼‰æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è®¿é—®äº†æŸäº›å†…å®¹ã€‚Web beacon é€šå¸¸ç”±ç¬¬ä¸‰æ–¹ç”¨äºç›‘æ§ç”¨æˆ·åœ¨ç½‘ç«™ä¸Šçš„æ´»åŠ¨ï¼Œä»¥è¿›è¡Œç½‘ç»œåˆ†ææˆ–é¡µé¢æ ‡è®°ã€‚å®ƒä»¬ä¹Ÿå¯ç”¨äºç”µå­é‚®ä»¶è·Ÿè¸ªã€‚å½“ä½¿ç”¨JavaScriptå®ç°æ—¶ï¼Œå®ƒä»¬å¯ä»¥è¢«ç§°ä¸ºJavaScriptæ ‡ç­¾ã€‚<br>ä½¿ç”¨æ­¤ç±»ä¿¡æ ‡ï¼Œå…¬å¸å’Œç»„ç»‡å¯ä»¥è·Ÿè¸ªç½‘ç»œç”¨æˆ·çš„åœ¨çº¿è¡Œä¸ºã€‚èµ·åˆï¼Œè¿›è¡Œæ­¤ç±»è·Ÿè¸ªçš„å…¬å¸ä¸»è¦æ˜¯å¹¿å‘Šå•†æˆ–ç½‘ç»œåˆ†æå…¬å¸;åæ¥çš„ç¤¾äº¤åª’ä½“ç½‘ç«™ä¹Ÿå¼€å§‹ä½¿ç”¨è¿™ç§è·Ÿè¸ªæŠ€æœ¯ï¼Œä¾‹å¦‚é€šè¿‡ä½¿ç”¨å……å½“è·Ÿè¸ªä¿¡æ ‡çš„æŒ‰é’®ã€‚<br>2017å¹´ï¼ŒW3Cå‘å¸ƒäº†Webå¼€å‘äººå‘˜å¯ç”¨äºåˆ›å»ºWebä¿¡æ ‡çš„æ¥å£çš„å€™é€‰è§„èŒƒã€‚</p></blockquote><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="lt-img-gt"><a href="#lt-img-gt" class="headerlink" title="&lt;img&gt;"></a><code>&lt;img&gt;</code></h3><blockquote><p>ä¾‹å¦‚å¦‚æœæˆ‘ä»¬å‘é€é‚®ä»¶åï¼Œæƒ³çŸ¥é“å¯¹æ–¹æ˜¯å¦å·²è¯»ï¼Œå°±éœ€è¦åœ¨é‚®ä»¶ä¸­åµŒå…¥ä¸€å¼ å›¾ç‰‡ï¼Œæˆ‘ä»¬å‘é€çš„getè¯·æ±‚å³æ˜¯å›¾ç‰‡çš„srcã€‚å½“æˆ‘ä»¬æ”¶åˆ°è¿™æ¬¡getè¯·æ±‚åï¼Œåœ¨æ¥å£ä¸­å†™ä¸‹é€»è¾‘å¤„ç†å‡½æ•°ç­‰ï¼Œå¤„ç†å®Œæ¯•éœ€è¦è¿”å›ä¸€å¼ å›¾ç‰‡ï¼ˆé€šå¸¸æƒ…å†µä¸‹æ˜¯ä¸€å¼ 1x1çš„GIFå›¾ç‰‡ï¼‰ã€‚</p></blockquote><p>ä¾‹å¦‚åµŒå…¥åœ¨ HTML ä¸­ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://api.toflying.com/report?from=test&amp;id=123&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">img</span>&gt;</span> <br></code></pre></td></tr></table></figure><p>åˆæˆ–è€…åµŒå…¥åˆ° JavaScript ä¸­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> image = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>()<br>image.<span class="hljs-property">src</span> =  <span class="hljs-string">&quot;http://api.toflying.com/report?from=test&amp;id=123&quot;</span><br><span class="hljs-comment">// è¿™é‡Œä¸éœ€è¦ appendChild æ’å…¥åˆ°é¡µé¢ä¸­åªéœ€è®¾ç½®srcå±æ€§å³å¯å‘é€Getè¯·æ±‚ã€‚</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ <code>http://api.toflying.com/report?from=test&amp;id=123</code> å°±æ˜¯API GETè¯·æ±‚çš„URLï¼Œå½“ç„¶çœŸå®æƒ…å†µä¸‹æ˜¯ä¸å­˜åœ¨çš„ã€‚æˆ‘ä»¬å¯ä»¥æºå¸¦ä»»æ„å‚æ•°ï¼ˆä¾‹å¦‚æ¥æºçš„å¹³å°ã€å½“å‰æ–‡ç« çš„IDç­‰ï¼‰ï¼Œå¹¶å¯ä»¥åœ¨åç«¯å¤„ç†ç›¸åº”é€»è¾‘ã€‚</p><p><strong>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ <code>&lt;img&gt;</code> æ ‡ç­¾ï¼Ÿ</strong></p><p>é‚£æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬çš„ <code>&lt;img&gt;</code> ç›¸å½“äºä¸€æ¬¡ <strong>GET</strong> è¯·æ±‚ï¼Œå¹¶ä¸”<strong>æ²¡æœ‰è·¨åŸŸ</strong>çš„é™åˆ¶ã€‚æ­£æ˜¯å› ä¸ºæ²¡æœ‰è·¨åŸŸé™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„ç½‘ç«™ï¼ˆæˆ–è€…åœ¨æˆ‘ä»¬å‘é€çš„é‚®ä»¶ä¸­ï¼‰åµŒå…¥è¯¥æ ‡ç­¾ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“è¿™äº›ç½‘ç«™é¡µé¢æˆ–è€…é‚®ä»¶è¢«äººé˜…è¯»çš„æƒ…å†µï¼Œç”šè‡³å¯ä»¥åˆ†æå¯¹æ–¹çš„è®¾å¤‡ã€IPã€æ„å›¾ç­‰ç­‰ã€‚</p><p><strong>é‚£ä¸ºä»€ä¹ˆä¸€å®šè¦è¿”å›ä¸€å¼ å›¾ç‰‡ï¼Ÿ</strong></p><p>å¦‚æœæˆ‘ä»¬è¿”å›çš„æ˜¯ä¸€æ®µæ–‡æœ¬æˆ–è€…è¯´æ˜¯JSONå­—ç¬¦ä¸²ï¼ˆè¿”å›å¤´ä¸­çš„ content-type: application&#x2F;json;ï¼‰ã€‚<code>&lt;img&gt;</code> æ ‡ç­¾ä¼šè§¦å‘ onerror äº‹ä»¶ï¼Œä¼šæŠ¥é”™ã€‚å¦‚æœè¿”å›ç©ºçš„è¯ä¹Ÿä¼šæŠ¥CORBçš„é—®é¢˜ï¼Œç„¶åé¡µé¢ä¸Šçš„é‚£å¼ å›¾ç‰‡ä¹Ÿä¼šè£‚å¼€ï¼ˆå¦‚æœæ ‡ç­¾å­˜åœ¨çš„è¯ï¼‰ã€‚æ‰€ä»¥æˆ‘ä»¬é€šå¸¸è¿”å›ä¸€å¼ å›¾ç‰‡ï¼ˆè¿”å›å¤´ä¸ºcontent-type: image&#x2F;*ï¼‰ã€‚</p><p><strong>ä¸ºä»€ä¹ˆå›¾ç‰‡æ˜¯ 1x1 GIF å›¾ç‰‡ï¼Ÿ</strong></p><p>åœ¨åŒæ ·å°ºå¯¸ä¸‹ï¼Œä¸åŒæ ¼å¼çš„å›¾ç‰‡GIFæ ¼å¼å ç”¨çš„å­˜å‚¨ç©ºé—´æ˜¯æœ€å°çš„ï¼Œä¹Ÿå¯ä»¥é™ä½æœåŠ¡å™¨çš„ä¼ è¾“å‹åŠ›ã€‚</p><h3 id="navigator-sendBeacon"><a href="#navigator-sendBeacon" class="headerlink" title="navigator.sendBeacon"></a><code>navigator.sendBeacon</code></h3><blockquote><p><code>navigator.sendBeacon()</code> æ–¹æ³•å¯ç”¨äºé€šè¿‡ HTTP <strong>POST</strong> å°†å°‘é‡æ•°æ® å¼‚æ­¥ ä¼ è¾“åˆ° Web æœåŠ¡å™¨ã€‚å®ƒä¸»è¦ç”¨äºå°†ç»Ÿè®¡æ•°æ®å‘é€åˆ° Web æœåŠ¡å™¨ï¼ŒåŒæ—¶é¿å…äº†ç”¨ä¼ ç»ŸæŠ€æœ¯ï¼ˆå¦‚ï¼šXMLHttpRequestï¼‰å‘é€åˆ†ææ•°æ®çš„ä¸€äº›é—®é¢˜ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">navigator.<span class="hljs-title function_">sendBeacon</span>(url, data);<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼šurl æ˜¯ POST è¯·æ±‚çš„åœ°å€ã€‚è€Œ data å¯é€‰ï¼Œæ˜¯è¯·æ±‚é™„å¸¦çš„æ•°æ®ï¼ˆ ArrayBufferã€ArrayBufferViewã€Blobã€DOMStringã€FormData æˆ– URLSearchParamsï¼‰</p><p>å½“ç”¨æˆ·ä»£ç†æˆåŠŸæŠŠæ•°æ®åŠ å…¥ä¼ è¾“é˜Ÿåˆ—æ—¶ï¼Œ<code>sendBeacon()</code> æ–¹æ³•å°†ä¼šè¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</p><p>ç›¸è¾ƒäºå›¾ç‰‡çš„srcï¼Œè¿™ç§æ–¹å¼çš„æ›´æœ‰ä¼˜åŠ¿ï¼š</p><ul><li>ä¸ä¼šå’Œä¸»è¦ä¸šåŠ¡ä»£ç æŠ¢å èµ„æºï¼Œè€Œæ˜¯åœ¨æµè§ˆå™¨ç©ºé—²æ—¶å»åšå‘é€ï¼›</li><li>å¹¶ä¸”åœ¨é¡µé¢å¸è½½æ—¶ä¹Ÿèƒ½ä¿è¯è¯·æ±‚æˆåŠŸå‘é€ï¼Œä¸é˜»å¡é¡µé¢åˆ·æ–°å’Œè·³è½¬ï¼›</li></ul><p>ç°åœ¨çš„åŸ‹ç‚¹ç›‘æ§å·¥å…·é€šå¸¸ä¼šä¼˜å…ˆä½¿ç”¨sendBeaconï¼Œä½†ç”±äºæµè§ˆå™¨å…¼å®¹æ€§ï¼Œè¿˜æ˜¯éœ€è¦ç”¨å›¾ç‰‡çš„srcå…œåº•ã€‚</p><p>ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> url = <span class="hljs-string">&quot;http://api.toflying.com/report&quot;</span><br><span class="hljs-keyword">const</span> data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>()<br>data.<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>)<br>data.<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;from&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>)<br>navigator.<span class="hljs-title function_">sendBeacon</span>(url, data)<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ä¹Ÿæ²¡æœ‰è¿™ä¹ˆç®€å•ã€‚</p><p>è¿‡å»ï¼Œè®¸å¤šç½‘ç«™ä½¿ç”¨ <code>unload</code> æˆ– <code>beforeunload</code> äº‹ä»¶ä»¥åœ¨ä¼šè¯ç»“æŸæ—¶å‘é€ç»Ÿè®¡æ•°æ®ã€‚ç„¶è€Œè¿™æ˜¯ä¸å¯é çš„ï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼ˆå°¤å…¶æ˜¯ç§»åŠ¨è®¾å¤‡ï¼‰æµè§ˆå™¨ä¸ä¼šäº§ç”Ÿ <code>unload</code>ã€<code>beforeunload</code> æˆ– <code>pagehide</code> äº‹ä»¶ã€‚ä¸‹é¢åˆ—å‡ºäº†ä¸€ç§ä¸è§¦å‘ä¸Šè¿°äº‹ä»¶çš„æƒ…å†µï¼š</p><ul><li>ç”¨æˆ·åŠ è½½äº†ç½‘é¡µå¹¶ä¸å…¶äº¤äº’ã€‚</li><li>å®Œæˆæµè§ˆåï¼Œç”¨æˆ·åˆ‡æ¢åˆ°äº†å…¶å®ƒåº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯å…³é—­é€‰é¡¹å¡ã€‚</li><li>éšåï¼Œç”¨æˆ·é€šè¿‡æ‰‹æœºçš„åº”ç”¨ç®¡ç†å™¨å…³é—­äº†æµè§ˆå™¨åº”ç”¨ã€‚</li></ul><p>æ­¤å¤–ï¼Œ<code>unload</code> äº‹ä»¶ä¸ç°ä»£æµè§ˆå™¨å®ç°çš„å¾€è¿”ç¼“å­˜ï¼ˆbfcacheï¼‰ä¸å…¼å®¹ã€‚åœ¨éƒ¨åˆ†æµè§ˆå™¨ï¼ˆå¦‚ï¼šFirefoxï¼‰é€šè¿‡åœ¨ bfcache ä¸­æ’é™¤åŒ…å« <code>unload</code> äº‹ä»¶å¤„ç†å™¨çš„é¡µé¢æ¥è§£å†³ä¸å…¼å®¹é—®é¢˜ï¼Œä½†è¿™å­˜åœ¨æ€§èƒ½æŸå¤±ã€‚</p><p>å…¶å®ƒæµè§ˆå™¨ï¼Œä¾‹å¦‚ Safari å’Œ Android ä¸Šçš„ Chrome æµè§ˆå™¨åˆ™é‡‡å–ç”¨æˆ·åœ¨åŒä¸€æ ‡ç­¾é¡µä¸‹å¯¼èˆªè‡³å…¶å®ƒé¡µé¢æ—¶ä¸è§¦å‘ <code>unload</code> äº‹ä»¶çš„æ–¹æ³•æ¥è§£å†³ä¸å…¼å®¹é—®é¢˜ã€‚</p><p>Firefox ä¹Ÿä¼šåœ¨ bfcache ä¸­æ’é™¤åŒ…å« <code>beforeunload</code> äº‹ä»¶å¤„ç†å™¨çš„é¡µé¢ã€‚</p><p>åœ¨ä¼šè¯ç»“æŸæ—¶å‘é€ç»Ÿè®¡æ•°æ®<br>ç½‘ç«™é€šå¸¸å¸Œæœ›åœ¨ç”¨æˆ·å®Œæˆé¡µé¢æµè§ˆåå‘æœåŠ¡å™¨å‘é€åˆ†ææˆ–è¯Šæ–­æ•°æ®ï¼Œæœ€å¯é çš„æ–¹æ³•æ˜¯åœ¨ <code>visibilitychange</code> äº‹ä»¶å‘ç”Ÿæ—¶å‘é€æ•°æ®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;visibilitychange&#x27;</span>, <span class="hljs-keyword">function</span> <span class="hljs-title function_">report</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">visibilityState</span> === <span class="hljs-string">&#x27;hidden&#x27;</span>) &#123;<br>    <span class="hljs-keyword">const</span> url = <span class="hljs-string">&quot;http://api.toflying.com/report&quot;</span><br>    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>()<br>    data.<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>)<br>    data.<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;from&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>)<br>    navigator.<span class="hljs-title function_">sendBeacon</span>(url, data)<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>å¯ä½¿ç”¨ <code>pagehide</code> ä»¶æ¥ä»£æ›¿éƒ¨åˆ†æµè§ˆå™¨æœªå®ç°çš„ <code>visibilitychange</code> äº‹ä»¶ã€‚å’Œ <code>beforeunload</code> ä¸ <code>unload</code> äº‹ä»¶ç±»ä¼¼ï¼Œè¿™ä¸€äº‹ä»¶ä¸ä¼šè¢«å¯é åœ°è§¦å‘ï¼ˆç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šï¼‰ï¼Œä½†å®ƒä¸ <code>bfcache</code> å…¼å®¹ã€‚</p><p><strong>æµè§ˆå™¨å…¼å®¹æ€§</strong></p><p><img src="https://image.origin-tec.com/img/af53a3d7d4a46f5f9f373ad6ed2703ba@798x357.png" alt="æµè§ˆå™¨å…¼å®¹æ€§"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šå¸¸ <code>&lt;img&gt;</code> æ ‡ç­¾å‡ºç°çš„éœ€è¦è·¨åŸŸçš„åœºæ™¯ä¸­ã€‚è€Œ <code>navigator.sendBeacon</code> å¯ä»¥åœ¨è‡ªå·±ç½‘ç«™ä½¿ç”¨ï¼Œå½“ç„¶å¦‚æœä½¿ç”¨ä¸äº†ï¼ˆä¾‹å¦‚IEæµè§ˆå™¨ï¼‰å¯ä»¥ç”¨ <code>&lt;img&gt;</code>ã€‚</p><p><strong>æœªå®Œå¾…ç»­</strong></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://en.wikipedia.org/wiki/Web_tracking">Web Tracking - Wikipedia</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Navigator/sendBeacon">Navigator.sendBeacon - Web API æ¥å£å‚è€ƒ | MDN</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>WebTracking</tag>
      
      <tag>WebBeacon</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€šè¿‡requestAnimationFrameå®ç°ä¸€ä¸ªå®šæ—¶å™¨</title>
    <link href="/2022/07/19/9-requestAnimationFrame-api/"/>
    <url>/2022/07/19/9-requestAnimationFrame-api/</url>
    
    <content type="html"><![CDATA[<h2 id="MDNè§£é‡Š"><a href="#MDNè§£é‡Š" class="headerlink" title="MDNè§£é‡Š"></a>MDNè§£é‡Š</h2><p><code>window.requestAnimationFrame()</code> å‘Šè¯‰æµè§ˆå™¨â€”â€”ä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œã€‚</p><blockquote><p>å¤‡æ³¨ï¼š è‹¥ä½ æƒ³åœ¨æµè§ˆå™¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰ç»§ç»­æ›´æ–°ä¸‹ä¸€å¸§åŠ¨ç”»ï¼Œé‚£ä¹ˆå›è°ƒå‡½æ•°è‡ªèº«å¿…é¡»å†æ¬¡è°ƒç”¨ <code>window.requestAnimationFrame()</code></p></blockquote><p>å½“ä½ å‡†å¤‡æ›´æ–°åŠ¨ç”»æ—¶ä½ åº”è¯¥è°ƒç”¨æ­¤æ–¹æ³•ã€‚è¿™å°†ä½¿æµè§ˆå™¨åœ¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨ä½ ä¼ å…¥ç»™è¯¥æ–¹æ³•çš„åŠ¨ç”»å‡½æ•° (å³ä½ çš„å›è°ƒå‡½æ•°)ã€‚å›è°ƒå‡½æ•°æ‰§è¡Œæ¬¡æ•°é€šå¸¸æ˜¯æ¯ç§’ 60 æ¬¡ï¼Œä½†åœ¨å¤§å¤šæ•°éµå¾ª W3C å»ºè®®çš„æµè§ˆå™¨ä¸­ï¼Œå›è°ƒå‡½æ•°æ‰§è¡Œæ¬¡æ•°é€šå¸¸ä¸æµè§ˆå™¨å±å¹•åˆ·æ–°æ¬¡æ•°ç›¸åŒ¹é…ã€‚</p><p>å¦å¤–ä¸ºäº†æé«˜æ€§èƒ½å’Œç”µæ± å¯¿å‘½ï¼Œåœ¨å¤§å¤šæ•°æµè§ˆå™¨é‡Œï¼Œå½“ <code>requestAnimationFrame()</code> è¿è¡Œåœ¨åå°æ ‡ç­¾é¡µæˆ–è€…éšè—çš„ <code>&lt;iframe&gt;</code> é‡Œæ—¶ï¼Œ<code>requestAnimationFrame()</code> ä¼šè¢«æš‚åœè°ƒç”¨ä»¥æå‡æ€§èƒ½å’Œç”µæ± å¯¿å‘½ã€‚</p><p>å›è°ƒå‡½æ•°ä¼šè¢«ä¼ å…¥ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DOMHighResTimeStamp">DOMHighResTimeStamp</a> å‚æ•°ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DOMHighResTimeStamp">DOMHighResTimeStamp</a> æŒ‡ç¤ºå½“å‰è¢« <code>requestAnimationFrame()</code> æ’åºçš„å›è°ƒå‡½æ•°è¢«è§¦å‘çš„æ—¶é—´ã€‚åœ¨åŒä¸€ä¸ªå¸§ä¸­çš„å¤šä¸ªå›è°ƒå‡½æ•°ï¼Œå®ƒä»¬æ¯ä¸€ä¸ªéƒ½ä¼šæ¥å—åˆ°ä¸€ä¸ªç›¸åŒçš„æ—¶é—´æˆ³ï¼Œå³ä½¿åœ¨è®¡ç®—ä¸Šä¸€ä¸ªå›è°ƒå‡½æ•°çš„å·¥ä½œè´Ÿè½½æœŸé—´å·²ç»æ¶ˆè€—äº†ä¸€äº›æ—¶é—´ã€‚è¯¥æ—¶é—´æˆ³æ˜¯ä¸€ä¸ªåè¿›åˆ¶æ•°ï¼Œå•ä½æ¯«ç§’ï¼Œæœ€å°ç²¾åº¦ä¸º 1ms(1000Î¼s)ã€‚</p><div class="note note-warning">            <p><strong>æé†’ï¼š</strong> è¯·ç¡®ä¿æ€»æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•° (æˆ–å…¶å®ƒè·å¾—å½“å‰æ—¶é—´çš„æ–¹æ³•) è®¡ç®—æ¯æ¬¡è°ƒç”¨ä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œå¦åˆ™åŠ¨ç”»åœ¨é«˜åˆ·æ–°ç‡çš„å±å¹•ä¸­ä¼šè¿è¡Œå¾—æ›´å¿«ã€‚è¯·å‚è€ƒä¸‹é¢ä¾‹å­çš„åšæ³•ã€‚  </p>          </div><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(callback);<br></code></pre></td></tr></table></figure><h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><p><code>callback</code></p><p>ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ›´æ–°åŠ¨ç”»å¸§æ‰€è°ƒç”¨çš„å‡½æ•° (å³ä¸Šé¢æ‰€è¯´çš„å›è°ƒå‡½æ•°)ã€‚è¯¥å›è°ƒå‡½æ•°ä¼šè¢«ä¼ å…¥ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DOMHighResTimeStamp">DOMHighResTimeStamp</a> å‚æ•°ï¼Œè¯¥å‚æ•°ä¸ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Performance/now">performance.now()</a> çš„è¿”å›å€¼ç›¸åŒï¼Œå®ƒè¡¨ç¤º <code>requestAnimationFrame()</code> å¼€å§‹å»æ‰§è¡Œå›è°ƒå‡½æ•°çš„æ—¶åˆ»ã€‚</p><h3 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h3><p>ä¸€ä¸ª long æ•´æ•°ï¼Œè¯·æ±‚ ID ï¼Œæ˜¯å›è°ƒåˆ—è¡¨ä¸­å”¯ä¸€çš„æ ‡è¯†ã€‚æ˜¯ä¸ªéé›¶å€¼ï¼Œæ²¡åˆ«çš„æ„ä¹‰ã€‚ä½ å¯ä»¥ä¼ è¿™ä¸ªå€¼ç»™ <code>window.cancelAnimationFrame()</code> ä»¥å–æ¶ˆå›è°ƒå‡½æ•°ã€‚</p><h2 id="å®šæ—¶å™¨å®ç°"><a href="#å®šæ—¶å™¨å®ç°" class="headerlink" title="å®šæ—¶å™¨å®ç°"></a>å®šæ—¶å™¨å®ç°</h2><h3 id="setInterval"><a href="#setInterval" class="headerlink" title="setInterval"></a>setInterval</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">setMyInterval</span> = (<span class="hljs-params">options</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> requestAnimationFrame = <span class="hljs-variable language_">window</span>.<span class="hljs-property">requestAnimationFrame</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">mozRequestAnimationFrame</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">webkitRequestAnimationFrame</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">msRequestAnimationFrame</span><br>    <span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">let</span> count = <span class="hljs-number">1</span><br>    options.<span class="hljs-property">timer</span> = options.<span class="hljs-property">timer</span> || <span class="hljs-literal">null</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">loop</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>        options.<span class="hljs-property">timer</span> = <span class="hljs-title function_">requestAnimationFrame</span>(loop)<br>        <span class="hljs-keyword">if</span>(i % <span class="hljs-number">60</span> === <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-comment">// æ­¤å¤„ 60 ä»£è¡¨å±å¹•åˆ·æ–°ç‡ä¸º60HZï¼Œå³ä»£è¡¨æ­¤å¤„æ¯éš”ä¸€ç§’æ‰§è¡Œä¸€æ¬¡</span><br>            timeout = options.<span class="hljs-property">timeout</span> || <span class="hljs-number">1000</span><br>            <span class="hljs-keyword">if</span>(count % <span class="hljs-built_in">parseInt</span>(timeout / <span class="hljs-number">1000</span>) === <span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-comment">// æ¯éš”å¤šå°‘ç§’è°ƒç”¨ä¸€æ¬¡å›è°ƒå‡½æ•°ï¼Œæ­¤å¤„timeoutåº”ä¸º1000çš„å€æ•°</span><br>                options.<span class="hljs-property">callback</span> &amp;&amp; options.<span class="hljs-title function_">callback</span>()<br>            &#125;<br>            count++<br>        &#125;<br>        i++<br>    &#125;<br>    options.<span class="hljs-property">timer</span> = <span class="hljs-title function_">requestAnimationFrame</span>(loop)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="setTimeout"><a href="#setTimeout" class="headerlink" title="setTimeout"></a>setTimeout</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">setMyTimeout</span> = (<span class="hljs-params">options</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> requestAnimationFrame = <span class="hljs-variable language_">window</span>.<span class="hljs-property">requestAnimationFrame</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">mozRequestAnimationFrame</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">webkitRequestAnimationFrame</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">msRequestAnimationFrame</span><br>    <span class="hljs-keyword">const</span> cancelAnimationFrame = <span class="hljs-variable language_">window</span>.<span class="hljs-property">cancelAnimationFrame</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">mozCancelAnimationFrame</span><br>    <span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">let</span> count = <span class="hljs-number">1</span><br>    options.<span class="hljs-property">timer</span> = options.<span class="hljs-property">timer</span> || <span class="hljs-literal">null</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">loop</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>        options.<span class="hljs-property">timer</span> = <span class="hljs-title function_">requestAnimationFrame</span>(loop)<br>        <span class="hljs-keyword">if</span>(i % <span class="hljs-number">60</span> === <span class="hljs-number">0</span>)&#123;<br>            timeout = options.<span class="hljs-property">timeout</span> || <span class="hljs-number">1000</span><br>            <span class="hljs-keyword">if</span>(count % <span class="hljs-built_in">parseInt</span>(timeout / <span class="hljs-number">1000</span>) === <span class="hljs-number">0</span>)&#123;<br>                options.<span class="hljs-property">callback</span> &amp;&amp; options.<span class="hljs-title function_">callback</span>()<br>                <span class="hljs-title function_">cancelAnimationFrame</span>(options.<span class="hljs-property">timer</span>)<br>            &#125;<br>            count++<br>        &#125;<br>        i++<br>    &#125;<br>    options.<span class="hljs-property">timer</span> = <span class="hljs-title function_">requestAnimationFrame</span>(loop)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="clearInterval-x2F-clearTimeout"><a href="#clearInterval-x2F-clearTimeout" class="headerlink" title="clearInterval &#x2F; clearTimeout"></a>clearInterval &#x2F; clearTimeout</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">clearMyInterval</span> = (<span class="hljs-params">timer</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> cancelAnimationFrame = <span class="hljs-variable language_">window</span>.<span class="hljs-property">cancelAnimationFrame</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">mozCancelAnimationFrame</span><br>    <span class="hljs-title function_">cancelAnimationFrame</span>(timer)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> options = &#123;<br>    <span class="hljs-attr">timer</span>: <span class="hljs-literal">null</span>,<br>    <span class="hljs-attr">callback</span>: <span class="hljs-literal">null</span>,<br>    <span class="hljs-attr">timeout</span>: <span class="hljs-number">1000</span><br>&#125;<br><br>options.<span class="hljs-property">timeout</span> = <span class="hljs-number">3000</span><br><br>options.<span class="hljs-property">callback</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleString</span>())<br>&#125;<br><br><span class="hljs-title function_">setMyInterval</span>(options)<br><br><span class="hljs-title function_">setMyTimeout</span>(&#123;<br>  <span class="hljs-attr">timer</span>: <span class="hljs-literal">null</span>,<br>  <span class="hljs-attr">callback</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;setMyTimeout&#x27;</span>)<br>    <span class="hljs-title function_">clearMyInterval</span>(options.<span class="hljs-property">timer</span>)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;cancel&quot;</span>)<br>  &#125;,<br>  <span class="hljs-attr">timeout</span>: <span class="hljs-number">6000</span><br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="åœ¨çº¿ç¤ºä¾‹"><a href="#åœ¨çº¿ç¤ºä¾‹" class="headerlink" title="åœ¨çº¿ç¤ºä¾‹"></a>åœ¨çº¿ç¤ºä¾‹</h3><p><a href="https://codepen.io/kingcheni/pen/ZExeKyQ?editors=0012">CodePen.io</a></p><h2 id="é¢˜å¤–è¯ï¼šå¦‚ä½•é€šè¿‡JSè·å–å±å¹•å¸§æ•°"><a href="#é¢˜å¤–è¯ï¼šå¦‚ä½•é€šè¿‡JSè·å–å±å¹•å¸§æ•°" class="headerlink" title="é¢˜å¤–è¯ï¼šå¦‚ä½•é€šè¿‡JSè·å–å±å¹•å¸§æ•°"></a>é¢˜å¤–è¯ï¼šå¦‚ä½•é€šè¿‡JSè·å–å±å¹•å¸§æ•°</h2><div class="note note-primary">            <p>æˆ‘ä»¬çŸ¥é“å¾ªç¯è°ƒç”¨<code>requestAnimationFrame</code> å…¶é¢‘ç‡<strong>é€šå¸¸æƒ…å†µä¸‹</strong>ä¼šå’Œå±å¹•å¸§æ•°ä¿æŒä¸€è‡´ï¼Œæ‰€ä»¥è¿™ä¸ªå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>requestAnimationFrame</code> æ¥å®ç°ã€‚</p>          </div><p><strong>ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getScreenFrames</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">let</span> startTime = <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">let</span> endTime = <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>;<br>    (<span class="hljs-keyword">function</span> <span class="hljs-title function_">loop</span>(<span class="hljs-params"></span>) &#123;<br>      timer = <span class="hljs-title function_">requestAnimationFrame</span>(loop);<br>      startTime = startTime === <span class="hljs-literal">null</span> ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>() : startTime;<br>      endTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();<br>      <span class="hljs-keyword">if</span> (endTime - startTime &gt; <span class="hljs-number">1000</span>) &#123;<br>        <span class="hljs-title function_">cancelAnimationFrame</span>(timer);<br>        <span class="hljs-title function_">resolve</span>(i - <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">return</span>;<br>      &#125;<br>      i++;<br>    &#125;)();<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="åœ¨çº¿ç¤ºä¾‹-1"><a href="#åœ¨çº¿ç¤ºä¾‹-1" class="headerlink" title="åœ¨çº¿ç¤ºä¾‹"></a>åœ¨çº¿ç¤ºä¾‹</h3><div id="app">  <span class="fps" style="font-size: 18px;line-height: 60px;">FPS: Loading...</span>ï¼ˆè¿™ä¸ªæ˜¯å®æ—¶å˜åŒ–çš„~ï¼‰</div><p><a href="https://codepen.io/kingcheni/pen/yLKbaNv">CodePen.io</a></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><script src="../../../../js/getScreenFrame.js"></script><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame">window.requestAnimationFrame - Web API æ¥å£å‚è€ƒ | MDN</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>å®šæ—¶å™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ‰‹å†™ä¸€ä¸ªVueåŒå‘ç»‘å®šå®ç°çš„Demo</title>
    <link href="/2022/07/14/8-vue-demo/"/>
    <url>/2022/07/14/8-vue-demo/</url>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨ <a href="https://toflying.com/2022/07/08/6-talk-about-es6-proxy/">æµ…è°ˆ ES6 ä¸­çš„ Proxy ç”¨æ³•</a> ä¸­æˆ‘ä»¬æåˆ°ï¼Œåœ¨ Vue2 ä¸­ä½¿ç”¨ <code>Object.defineProperty</code> å’Œ Vue3 ä¸­ä½¿ç”¨ <code>Proxy</code> å®ç°äº†åŒå‘ç»‘å®šã€‚é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å…·ä½“å®ç°çš„ï¼Ÿä»¥ä¸‹ï¼Œæˆ‘ä»¬ä¾¿æ¢è®¨å¦‚ä½•è‡ªå·±æ‰‹å†™ä¸€ä¸ªåŒå‘ç»‘å®šã€‚</p></blockquote><h2 id="Object-defineProperty"><a href="#Object-defineProperty" class="headerlink" title="Object.defineProperty"></a>Object.defineProperty</h2><p>é¦–å…ˆæˆ‘ä»¬çš„ HTML ä¸­æ¸²æŸ“ä¸€ä¸ª <code>&lt;p&gt;</code>æ ‡ç­¾ å’Œä¸€ä¸ª <code>&lt;input&gt;</code> æ ‡ç­¾ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title-1&quot;</span>&gt;</span>Vue Demo: Object.defineProperty()<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;input-1&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬é€šè¿‡ <code>Object.defineProperty</code> æ¥å®ç°åŒå‘ç»‘å®šï¼Œæˆ‘ä»¬éœ€è¦é‡å†™ <code>data</code> ä¸­çš„ <code>get</code> å’Œ <code>set</code> æ–¹æ³•ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// æ­¤å¤„æˆ‘ä»¬å°† data.content çš„å€¼ç»‘å®šè‡³ p å’Œ input ä¸Šã€‚</span><br><span class="hljs-keyword">let</span> data = &#123;<br>    <span class="hljs-attr">content</span>: <span class="hljs-string">&#x27;&#x27;</span><br>&#125;<br><br><span class="hljs-keyword">let</span> el = &#123;<br>    <span class="hljs-attr">title</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.title-1&#x27;</span>),<br>    <span class="hljs-attr">input</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.input-1&#x27;</span>)<br>&#125;<br><br><span class="hljs-comment">// åœ¨ Vue2 ä¸­å®é™…æ˜¯å¯¹ data è¿›è¡Œäº†ä¸€ä¸ª Object.keys() éå†åå†é‡å†™çš„æ–¹æ³•ã€‚è¿™é‡Œæˆ‘ä»¬ç®€å†™å³å¯ã€‚</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(data,<span class="hljs-string">&#x27;content&#x27;</span>,&#123;<br>    <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-keyword">return</span> el.<span class="hljs-property">title</span>.<span class="hljs-property">innerHTML</span><br>    &#125;,<br>    <span class="hljs-title function_">set</span>(<span class="hljs-params">val</span>)&#123;<br>        el.<span class="hljs-property">input</span>.<span class="hljs-property">value</span> = val<br>        el.<span class="hljs-property">title</span>.<span class="hljs-property">innerHTML</span> = val<br>    &#125;<br>&#125;)<br><br></code></pre></td></tr></table></figure><p>ä½†è¿™è¿˜ä¸å¤Ÿï¼Œæ—¢ç„¶æ˜¯åŒå‘ç»‘å®šï¼Œé‚£å½“æˆ‘ä»¬è¾“å…¥å€¼çš„æ—¶å€™ï¼Œè¾“å…¥æ¡†é‡Œé¢çš„å€¼æ›´æ”¹ä¹Ÿä¼šå½±å“åˆ° <code>data.content</code> çš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—å¯¹ <code>input</code> åŠ å…¥ä¸€ä¸ª <code>keyup</code>æˆ–è€… <code>input</code> çš„ç›‘å¬äº‹ä»¶ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">el.<span class="hljs-property">input</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;keyup&#x27;</span>,<span class="hljs-function">(<span class="hljs-params">e</span>)=&gt;</span>&#123;<br>    data.<span class="hljs-property">content</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span><br>&#125;)<br><span class="hljs-comment">// æ­¤å¤–ï¼Œåœ¨ Vue ä¸­çš„ v-model å®é™…æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå®ç°äº† :value=&quot;myVal&quot; å’Œ @input=&quot;myVal=$event.target.value&quot;</span><br></code></pre></td></tr></table></figure><p><strong>åœ¨çº¿ç¤ºä¾‹</strong></p><p><a href="https://codepen.io/kingcheni/pen/jOzVPyr">CodePen.io</a></p><p>å…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š</p><div>    <p class="title-1" style="display:block;height:20px">Vue Demo: Object.defineProperty()</p>    <input class="input-1" /></div> <h2 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h2><p>ç„¶åæˆ‘ä»¬ä½¿ç”¨ <code>Proxy</code> æ¥å®ç°è¿™ä¸ªåŒå‘ç»‘å®šã€‚åŒç†ï¼Œæˆ‘ä»¬åœ¨é¡µé¢æ¸²æŸ“ä¸€ä¸ª <code>&lt;p&gt;</code> æ ‡ç­¾å’Œä¸€ä¸ª <code>&lt;input&gt;</code> æ ‡ç­¾ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title-2&quot;</span>&gt;</span>Vue Demo: Proxy<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;input-2&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>jsä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> data = &#123;<br>    <span class="hljs-attr">content</span>: <span class="hljs-string">&#x27;&#x27;</span><br>&#125;<br><br><span class="hljs-keyword">let</span> el = &#123;<br>  <span class="hljs-attr">title</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.title-2&#x27;</span>),<br>  <span class="hljs-attr">input</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.input-2&#x27;</span>)<br>&#125;<br><br>data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(data,&#123;<br>    <span class="hljs-title function_">get</span>(<span class="hljs-params">target,property,receiver</span>)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target,property,receiver)<br>    &#125;,<br>    <span class="hljs-title function_">set</span>(<span class="hljs-params">target,property,value,receiver</span>)&#123;<br>        el.<span class="hljs-property">input</span>.<span class="hljs-property">value</span> = value<br>        el.<span class="hljs-property">title</span>.<span class="hljs-property">innerHTML</span> = value<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(...<span class="hljs-variable language_">arguments</span>)<br>    &#125;<br>&#125;)<br><br>el.<span class="hljs-property">input</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;keyup&#x27;</span>,<span class="hljs-function">(<span class="hljs-params">e</span>)=&gt;</span>&#123;<br>  data.<span class="hljs-property">content</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span><br>&#125;)<br></code></pre></td></tr></table></figure><p><strong>åœ¨çº¿ç¤ºä¾‹</strong></p><p><a href="https://codepen.io/kingcheni/pen/ExENjmQ">CodePen.io</a></p><p>å…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š</p><div id="app">  <p class="title-2" style="display:block;height:20px">Vue Demo: Proxy</p>  <input class="input-2" /></div><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>ä»¥ä¸Šåªæ˜¯å¼€èƒƒèœï¼Œç°åœ¨æˆ‘ä»¬è¿˜å®ç°ä¸€ä¸ªç¨å¾®å®Œæ•´ç‚¹çš„Demoã€‚åŒ…å« <code>v-bind</code> <code>v-model</code> <code>@click</code> ç­‰ã€‚</p><p>HTMLä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">&quot;count&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;count&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;reduce&quot;</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;reset&quot;</span>&gt;</span>Reset<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>jsä»£ç å¦‚ä¸‹ï¼š</p><p><strong>Vueç±»</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vue</span>&#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>)&#123;<br>    <span class="hljs-keyword">const</span> vm = <span class="hljs-variable language_">this</span><br>    vm.<span class="hljs-property">$el</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(options.<span class="hljs-property">el</span>)<br>    vm.<span class="hljs-property">$methods</span> = options.<span class="hljs-property">methods</span><br>    <span class="hljs-keyword">let</span> data = options.<span class="hljs-property">data</span><br>    data = vm.<span class="hljs-property">_data</span> = <span class="hljs-keyword">typeof</span> data === <span class="hljs-string">&quot;function&quot;</span> ? data.<span class="hljs-title function_">call</span>(vm,vm) : data || &#123;&#125;<br>    vm.<span class="hljs-property">_binding</span> = &#123;&#125;<br>    vm.<span class="hljs-title function_">_observer</span>(data)<br>    vm.<span class="hljs-title function_">_compile</span>(vm.<span class="hljs-property">$el</span>)<br>  &#125;<br>  <span class="hljs-title function_">_pushWatcher</span>(<span class="hljs-params">watcher</span>)&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_binding</span>[watcher.<span class="hljs-property">key</span>])&#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_binding</span>[watcher.<span class="hljs-property">key</span>] = []<br>    &#125;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_binding</span>[watcher.<span class="hljs-property">key</span>].<span class="hljs-title function_">push</span>(watcher)<br>  &#125;<br>  <span class="hljs-title function_">_observer</span>(<span class="hljs-params">data</span>)&#123;<br>    <span class="hljs-keyword">const</span> vm = <span class="hljs-variable language_">this</span><br>    <span class="hljs-keyword">const</span> handler = &#123;<br>      <span class="hljs-title function_">set</span>(<span class="hljs-params">target,property,value</span>)&#123;<br>        <span class="hljs-keyword">const</span> res = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(...<span class="hljs-variable language_">arguments</span>)<br>        vm.<span class="hljs-property">_binding</span>[property].<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>          <span class="hljs-comment">// è°ƒç”¨æŒ‡å®šæ–¹æ³•ï¼Œæ›´æ–°è§†å›¾</span><br>          item.<span class="hljs-title function_">update</span>()<br>        &#125;)<br>        <span class="hljs-keyword">return</span> res<br>      &#125;<br>    &#125;<br>    <span class="hljs-comment">// åˆ©ç”¨ Proxy å®ç°çš„åŒå‘ç»‘å®š</span><br>    vm.<span class="hljs-property">_data</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(data,handler)<br>  &#125;<br>  <span class="hljs-title function_">_compile</span>(<span class="hljs-params">root</span>)&#123;<br>    <span class="hljs-keyword">const</span> nodes = [...root.<span class="hljs-property">children</span>]<br>    <span class="hljs-keyword">const</span> data = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_data</span><br>    nodes.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">node</span> =&gt;</span> &#123;<br>        <span class="hljs-comment">// éå†æ ¹å…ƒç´ èŠ‚ç‚¹ä¸‹çš„å­å…ƒç´ </span><br>      <span class="hljs-keyword">if</span>(node.<span class="hljs-property">children</span> &amp;&amp; node.<span class="hljs-property">children</span>.<span class="hljs-property">length</span>)&#123;<br>        <span class="hljs-comment">// å¦‚æœå­å…ƒç´ ä¸‹ä»ç„¶åŒ…å«å­å…ƒç´ ï¼Œåˆ™é€’å½’éå†</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_compile</span>(node.<span class="hljs-property">children</span>)<br>      &#125;<br>      <span class="hljs-keyword">const</span> $input = node.<span class="hljs-property">tagName</span>.<span class="hljs-title function_">toLowerCase</span>() === <span class="hljs-string">&#x27;input&#x27;</span><br>      <span class="hljs-keyword">const</span> $textarea = node.<span class="hljs-property">tagName</span>.<span class="hljs-title function_">toLowerCase</span>() === <span class="hljs-string">&#x27;textarea&#x27;</span><br>      <span class="hljs-keyword">const</span> $vmodel = node.<span class="hljs-title function_">hasAttribute</span>(<span class="hljs-string">&#x27;v-model&#x27;</span>)<br>      <span class="hljs-keyword">if</span>($vmodel &amp;&amp; ($input || $textarea))&#123;<br>        <span class="hljs-comment">// æ­¤å¤„åˆ¤æ–­è¯¥ input æˆ– textarea å…ƒç´ æ˜¯å¦å«æœ‰ v-model åŒå‘ç»‘å®šç›¸å…³çš„å±æ€§ã€‚å¦‚æœæœ‰åˆ™æ·»åŠ  Watcher å’Œäº‹ä»¶ç›‘å¬</span><br>         <span class="hljs-keyword">const</span> key = node.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;v-model&#x27;</span>)<br>         <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_pushWatcher</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(node,<span class="hljs-string">&#x27;value&#x27;</span>,data,key))<br>         node.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;input&#x27;</span>,<span class="hljs-function">() =&gt;</span>&#123;<br>            data[key] = node.<span class="hljs-property">value</span><br>         &#125;)<br>      &#125;<br>      <span class="hljs-keyword">if</span>(node.<span class="hljs-title function_">hasAttribute</span>(<span class="hljs-string">&#x27;v-bind&#x27;</span>))&#123;<br>        <span class="hljs-comment">// æ­¤å¤„åˆ¤æ–­æŒ‡å®šèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ v-bindã€‚è‹¥å­˜åœ¨åˆ™æ·»åŠ  Watcher</span><br>         <span class="hljs-keyword">const</span> key = node.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;v-bind&#x27;</span>)<br>         <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_pushWatcher</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(node,<span class="hljs-string">&#x27;innerHTML&#x27;</span>,data,key))<br>      &#125;<br>      <span class="hljs-keyword">if</span>(node.<span class="hljs-title function_">hasAttribute</span>(<span class="hljs-string">&#x27;@click&#x27;</span>))&#123;<br>        <span class="hljs-comment">// æ­¤å¤„åˆ¤æ–­æŒ‡å®šèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ @clickã€‚è‹¥å­˜åœ¨åˆ™æ·»åŠ ç›¸å…³äº‹ä»¶ç»‘å®šã€‚</span><br>        <span class="hljs-keyword">const</span> name = node.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;@click&#x27;</span>)<br>        <span class="hljs-keyword">const</span> method = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$methods</span>[name].<span class="hljs-title function_">bind</span>(data)<br>        node.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>,method)<br>      &#125;<br>    &#125;)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Watcherç±»</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Watcher</span>&#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">node,attr,data,key</span>)&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span> = node<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">attr</span> = attr<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = data<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = key<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">update</span>() <span class="hljs-comment">// å°†è§†å›¾åˆå§‹åŒ–</span><br>  &#125;<br>  <span class="hljs-title function_">update</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-comment">// æ­¤å¤„å®é™…ä¸Šå°±æ˜¯æ›´æ–°è§†å›¾çš„ã€‚æ“ä½œç±»ä¼¼äº el.value = newVal / el.innerHTML = newVal</span><br>    <span class="hljs-keyword">let</span> value = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span>)<br>    <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">attr</span>,value)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Vueå®ä¾‹</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> count = <span class="hljs-number">99</span><br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-comment">// ä¸ºä»€ä¹ˆ data æ˜¯ä¸€ä¸ªå‡½æ•°è€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚</span><br>    <span class="hljs-comment">// å› ä¸º Vue ä¸­å¯ä»¥ä¼šå­˜åœ¨å¤šä¸ªå®ä¾‹ï¼Œå¦‚æœå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¼šå¯¼è‡´æ‰€æœ‰çš„å®ä¾‹å…¬ç”¨ä¸€ä¸ªå¯¹è±¡ã€‚ä»è€Œä¼šå¯¼è‡´æ•°æ®å‡ºç°æ··ä¹±çš„æƒ…å†µã€‚</span><br>    <span class="hljs-comment">// è€Œä½¿ç”¨å‡½æ•°ï¼Œæ¯æ¬¡å®ä¾‹åŒ–ä¸€ä¸ªVueéƒ½ä¼šè¿”å›ä¸€ä¸ªå…¨æ–°çš„dataï¼Œä¸ä¼šå¯¼è‡´æ•°æ®å‡ºç°æ··ä¹±çš„æƒ…å†µã€‚</span><br>    <span class="hljs-keyword">return</span>&#123;<br>      <span class="hljs-attr">count</span>: count<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">methods</span>:&#123;<br>    <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>)&#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++<br>    &#125;,<br>    <span class="hljs-title function_">reduce</span>(<span class="hljs-params"></span>)&#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--<br>    &#125;,<br>    <span class="hljs-title function_">reset</span>(<span class="hljs-params"></span>)&#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = count<br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p><strong>åœ¨çº¿ç¤ºä¾‹</strong></p><p><a href="https://codepen.io/kingcheni/pen/abYmEWp">CodePen.io</a></p><p>å…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š</p><div id="my-app">  <p v-bind="count" style="display:block;height:20px">Vue Demo</p>  <input type="text" v-model="count">  <button @click="add">+</button>  <button @click="reduce">-</button>  <button @click="reset">Reset</button></div><h2 id="THE-END"><a href="#THE-END" class="headerlink" title="THE END"></a>THE END</h2><p>ç»¼ä¸Šä¾¿æ˜¯ä¸€ä¸ª Vue åŒå‘ç»‘å®šçš„ Demo å®ç°ã€‚å®é™…ä¸Š Vue çš„æºç å±‚é¢è¿˜æ˜¯ç¨å¾®æœ‰ç‚¹å¤æ‚çš„ï¼Œåœ¨æ•´ä¸ªå®ä¾‹åˆ›å»ºè¿‡ç¨‹ä¸­è¿˜æ¶‰åŠåˆ°è™šæ‹ŸDOMã€ç”Ÿå‘½å‘¨æœŸï¼ˆHookå‡½æ•°ï¼‰ç­‰ç­‰æ“ä½œã€‚æœ‰å…´è¶£å¯ä»¥ç›´æ¥å‰å¾€ Vue ä»“åº“æŸ¥çœ‹å…·ä½“ä»£ç å®ç°ã€‚</p><script src="../../../../js/vue-demo.js"></script>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitalkï¼šä¸€æ¬¾æ ¹æ®Github Issueså¼€å‘çš„è¯„è®ºæ’ä»¶</title>
    <link href="/2022/07/11/7-share-gitalk/"/>
    <url>/2022/07/11/7-share-gitalk/</url>
    
    <content type="html"><![CDATA[<div class="note note-success">            <p class="title title-success">Gitalk</p><p>Gitalk æ˜¯ä¸€ä¸ªåŸºäº GitHub Issue å’Œ Preact å¼€å‘çš„è¯„è®ºæ’ä»¶ã€‚</p><p>æˆ‘å¯¹å…¶è¿›è¡Œäº†äºŒæ¬¡å¼€å‘ï¼ŒåŠ å…¥äº†å›¾ç‰‡ä¸Šä¼ çš„åŠŸèƒ½ï¼Œå¯ä»¥ <a href="https://github.com/KingCheni/gitalk">ç‚¹å‡»æ­¤å¤„</a> æŸ¥çœ‹è¯¥ä»“åº“ã€‚</p><p>ä¹Ÿå°±æ˜¯æ‚¨æµè§ˆçš„è¿™ä¸ªç½‘ç«™æ­£åœ¨ä½¿ç”¨çš„æ’ä»¶ï¼Œå¯ä»¥å°†æ»šåŠ¨æ¡æ‹–åŠ¨è‡³åº•éƒ¨æŸ¥çœ‹ã€‚</p>          </div><h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><ul><li>ä½¿ç”¨ GitHub ç™»å½•</li><li>æ”¯æŒå¤šè¯­è¨€ [en, zh-CN, zh-TW, es-ES, fr, ru, de, pl, ko, fa, ja]</li><li>æ”¯æŒä¸ªäººæˆ–ç»„ç»‡</li><li>æ— å¹²æ‰°æ¨¡å¼ï¼ˆè®¾ç½® distractionFreeMode ä¸º true å¼€å¯ï¼‰</li><li>å¿«æ·é”®æäº¤è¯„è®º ï¼ˆcmd|ctrl + enterï¼‰</li><li><strong>æ”¯æŒå›¾ç‰‡ä¸Šä¼ </strong> ï¼ˆæ³¨ï¼šæˆ‘è‡ªå·± fork äº†åŸä»“åº“ï¼ŒåŠ å…¥çš„åŠŸèƒ½ã€‚å®˜æ–¹æš‚æ— ï¼Œå·²æäº¤PRã€‚ï¼‰</li></ul><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p><strong>åŠ å…¥äº†æ–°åŠŸèƒ½çš„ç‰ˆæœ¬ï¼š</strong></p><p>è®¿é—®è¯¥ <a href="https://github.com/KingCheni/gitalk">URL</a>ï¼ŒæŸ¥çœ‹å³ä¾§å‘è¡Œçš„æœ€æ–°ç‰ˆæœ¬ï¼Œä¸‹è½½ <code>gitalk.min.js</code> å’Œ <code>gitalk.css</code> å¯¼å…¥è¿›æ‚¨çš„é¡¹ç›®ä¸­ä½¿ç”¨å³å¯ã€‚</p><p>OR</p><p><strong>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨<a href="https://github.com/gitalk/gitalk">å®˜æ–¹ç‰ˆæœ¬</a>ï¼š</strong></p><ul><li>ç›´æ¥å¼•å…¥</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- or --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://unpkg.com/gitalk/dist/gitalk.css&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://unpkg.com/gitalk/dist/gitalk.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>npm å®‰è£…</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">npm i --save gitalk<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;gitalk/dist/gitalk.css&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Gitalk</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;gitalk&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>é¦–å…ˆï¼Œæ‚¨éœ€è¦é€‰æ‹©ä¸€ä¸ªå…¬å…±githubå­˜å‚¨åº“ï¼ˆå·²å­˜åœ¨æˆ–åˆ›å»ºä¸€ä¸ªæ–°çš„githubå­˜å‚¨åº“ï¼‰ç”¨äºå­˜å‚¨è¯„è®ºï¼Œ</p><p>ç„¶åéœ€è¦åˆ›å»º <strong>GitHub Application</strong>ï¼Œå¦‚æœæ²¡æœ‰ <a href="https://github.com/settings/applications/new">ç‚¹å‡»è¿™é‡Œç”³è¯·</a>ï¼Œ<code>Authorization callback URL</code> å¡«å†™å½“å‰ä½¿ç”¨æ’ä»¶é¡µé¢çš„åŸŸåã€‚</p><p>æœ€å, æ‚¨å¯ä»¥é€‰æ‹©å¦‚ä¸‹çš„å…¶ä¸­ä¸€ç§æ–¹å¼åº”ç”¨åˆ°é¡µé¢ï¼š</p><h3 id="æ–¹å¼1"><a href="#æ–¹å¼1" class="headerlink" title="æ–¹å¼1"></a>æ–¹å¼1</h3><p>æ·»åŠ ä¸€ä¸ªå®¹å™¨ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;gitalk-container&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç”¨ä¸‹é¢çš„ Javascript ä»£ç æ¥ç”Ÿæˆ gitalk æ’ä»¶ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> gitalk = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gitalk</span>(&#123;<br>  <span class="hljs-attr">clientID</span>: <span class="hljs-string">&#x27;GitHub Application Client ID&#x27;</span>,<br>  <span class="hljs-attr">clientSecret</span>: <span class="hljs-string">&#x27;GitHub Application Client Secret&#x27;</span>,<br>  <span class="hljs-attr">repo</span>: <span class="hljs-string">&#x27;GitHub repo&#x27;</span>,<br>  <span class="hljs-attr">owner</span>: <span class="hljs-string">&#x27;GitHub repo owner&#x27;</span>,<br>  <span class="hljs-attr">admin</span>: [<span class="hljs-string">&#x27;GitHub repo owner and collaborators, only these guys can initialize github issues&#x27;</span>],<br>  <span class="hljs-attr">id</span>: location.<span class="hljs-property">pathname</span>,      <span class="hljs-comment">// Ensure uniqueness and length less than 50</span><br>  <span class="hljs-attr">distractionFreeMode</span>: <span class="hljs-literal">false</span>  <span class="hljs-comment">// Facebook-like distraction free mode</span><br>&#125;)<br><br>gitalk.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;gitalk-container&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="æ–¹å¼2ï¼šåœ¨Reactä½¿ç”¨"><a href="#æ–¹å¼2ï¼šåœ¨Reactä½¿ç”¨" class="headerlink" title="æ–¹å¼2ï¼šåœ¨Reactä½¿ç”¨"></a>æ–¹å¼2ï¼šåœ¨Reactä½¿ç”¨</h3><p>ä½¿ç”¨ä»¥ä¸‹ä»£ç å¼•å…¥Gitalkç»„ä»¶</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">GitalkComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;gitalk/dist/gitalk-component&quot;</span>;<br></code></pre></td></tr></table></figure><p>æŒ‰ä»¥ä¸‹æ–¹å¼åœ¨Reactä¸­ä½¿ç”¨Gitalkç»„ä»¶</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">GitalkComponent</span> options=&#123;&#123;<br>  <span class="hljs-attr">clientID</span>: <span class="hljs-string">&quot;...&quot;</span>,<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-comment">// è®¾ç½®é¡¹</span><br>&#125;&#125; /&gt;<br></code></pre></td></tr></table></figure><h2 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h2><ul><li><p><strong>clientID</strong> <code>String</code> </p><p><strong>å¿…é¡»</strong>. GitHub Application Client ID.</p></li><li><p><strong>clientSecret</strong> <code>String</code> </p><p><strong>å¿…é¡»</strong>. GitHub Application Client Secret.</p></li><li><p><strong>repo</strong> <code>String</code> </p><p><strong>å¿…é¡»</strong>. GitHub repository.</p></li><li><p><strong>owner</strong> <code>String</code> </p><p><strong>å¿…é¡»</strong>. GitHub repository æ‰€æœ‰è€…ï¼Œå¯ä»¥æ˜¯ä¸ªäººæˆ–è€…ç»„ç»‡ã€‚</p></li><li><p><strong>admin</strong> <code>Array</code> </p><p><strong>å¿…é¡»</strong>. GitHub repository çš„æ‰€æœ‰è€…å’Œåˆä½œè€… (å¯¹è¿™ä¸ª repository æœ‰å†™æƒé™çš„ç”¨æˆ·)ã€‚</p></li><li><p><strong>id</strong> <code>String</code> </p><p>Default: <code>location.href</code>.</p><p>é¡µé¢çš„å”¯ä¸€æ ‡è¯†ã€‚é•¿åº¦å¿…é¡»å°äº50ã€‚</p></li><li><p><strong>number</strong> <code>Number</code> </p><p>Default: <code>-1</code>.</p><p>é¡µé¢çš„ issue ID æ ‡è¯†ï¼Œè‹¥æœªå®šä¹‰<code>number</code>å±æ€§åˆ™ä¼šä½¿ç”¨<code>id</code>è¿›è¡Œå®šä½ã€‚</p></li><li><p><strong>labels</strong> <code>Array</code> </p><p>Default: <code>[&#39;Gitalk&#39;]</code>.</p><p>GitHub issue çš„æ ‡ç­¾ã€‚</p></li><li><p><strong>title</strong> <code>String</code> </p><p>Default: <code>document.title</code>.</p><p>GitHub issue çš„æ ‡é¢˜ã€‚</p></li><li><p><strong>body</strong> <code>String</code> </p><p>Default: <code>location.href + header.meta[description]</code>.</p><p>GitHub issue çš„å†…å®¹ã€‚</p></li><li><p><strong>language</strong> <code>String</code> </p><p>Default: <code>navigator.language || navigator.userLanguage</code>.</p><p>è®¾ç½®è¯­è¨€ï¼Œæ”¯æŒ [en, zh-CN, zh-TW, es-ES, fr, ru, de, pl, ko, fa, ja]ã€‚</p></li><li><p><strong>perPage</strong> <code>Number</code> </p><p>Default: <code>10</code>.</p><p>æ¯æ¬¡åŠ è½½çš„æ•°æ®å¤§å°ï¼Œæœ€å¤š 100ã€‚</p></li><li><p><strong>distractionFreeMode</strong> <code>Boolean</code> </p><p>Default: falseã€‚</p><p>ç±»ä¼¼Facebookè¯„è®ºæ¡†çš„å…¨å±é®ç½©æ•ˆæœ.</p></li><li><p><strong>pagerDirection</strong> <code>String</code></p><p>Default: â€˜lastâ€™</p><p>è¯„è®ºæ’åºæ–¹å¼ï¼Œ <code>last</code>ä¸ºæŒ‰è¯„è®ºåˆ›å»ºæ—¶é—´å€’å™ï¼Œ<code>first</code>ä¸ºæŒ‰åˆ›å»ºæ—¶é—´æ­£åºã€‚</p></li><li><p><strong>createIssueManually</strong> <code>Boolean</code> </p><p>Default: <code>false</code>.</p><p>å¦‚æœå½“å‰é¡µé¢æ²¡æœ‰ç›¸åº”çš„ isssue ä¸”ç™»å½•çš„ç”¨æˆ·å±äº adminï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»º issueã€‚å¦‚æœè®¾ç½®ä¸º <code>true</code>ï¼Œåˆ™æ˜¾ç¤ºä¸€ä¸ªåˆå§‹åŒ–é¡µé¢ï¼Œåˆ›å»º issue éœ€è¦ç‚¹å‡» <code>init</code> æŒ‰é’®ã€‚</p></li><li><p><strong>proxy</strong> <code>String</code> </p><p>Default: <code>https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token</code>.</p><p> GitHub oauth è¯·æ±‚åˆ°åå‘ä»£ç†ï¼Œä¸ºäº†æ”¯æŒ CORSã€‚ <a href="https://github.com/isaacs/github/issues/330">ä¸ºä»€ä¹ˆè¦è¿™æ ·?</a></p></li><li><p><strong>flipMoveOptions</strong> <code>Object</code> </p><p>Default:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">staggerDelayBy</span>: <span class="hljs-number">150</span>,<br>  <span class="hljs-attr">appearAnimation</span>: <span class="hljs-string">&#x27;accordionVertical&#x27;</span>,<br>  <span class="hljs-attr">enterAnimation</span>: <span class="hljs-string">&#x27;accordionVertical&#x27;</span>,<br>  <span class="hljs-attr">leaveAnimation</span>: <span class="hljs-string">&#x27;accordionVertical&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯„è®ºåˆ—è¡¨çš„åŠ¨ç”»ã€‚ <a href="https://github.com/joshwcomeau/react-flip-move/blob/master/documentation/enter_leave_animations.md">å‚è€ƒ</a></p></li><li><p><strong>enableHotKey</strong> <code>Boolean</code> </p><p>Default: <code>true</code>.</p><p>å¯ç”¨å¿«æ·é”®(cmd|ctrl + enter) æäº¤è¯„è®º.</p></li></ul><div class="note note-warning">            <p><strong>æ³¨ï¼š</strong> å®˜æ–¹ç‰ˆæœ¬æš‚æ—  <code>upload</code> å‚æ•°</p>          </div><ul><li><p><strong>upload</strong> <code>Object</code> </p><p>Default:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">enable</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// é»˜è®¤å…³é—­ä¸Šä¼ åŠŸèƒ½</span><br>  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-comment">// ä¸Šä¼ çš„URL</span><br>  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-comment">// è¯·æ±‚æ–¹å¼</span><br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-comment">// ä¸Šä¼ è¡¨å•å¯¹åº”çš„åç§°</span><br>  <span class="hljs-attr">headers</span>: &#123; <span class="hljs-comment">// è¯·æ±‚å¤´</span><br>    <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;multipart/form-data&#x27;</span><br>  &#125;,<br>  <span class="hljs-attr">responseType</span>: <span class="hljs-string">&#x27;json&#x27;</span>, <span class="hljs-comment">// å“åº”æ ¼å¼</span><br>  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>, <span class="hljs-comment">// è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ¯«ç§’</span><br>  <span class="hljs-attr">multiple</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// æ–‡ä»¶ä¸Šä¼ æ˜¯å¦å¯ä»¥å¤šé€‰</span><br>  <span class="hljs-attr">accept</span>: <span class="hljs-string">&#x27;image/*&#x27;</span>, <span class="hljs-comment">// å¯æ¥å—æ–‡ä»¶çš„ç±»å‹</span><br>  <span class="hljs-attr">fileMaxSize</span>: <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">10</span>, <span class="hljs-comment">// æ–‡ä»¶é™åˆ¶å¤§å°</span><br>  <span class="hljs-attr">successCode</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// ä¸Šä¼ æˆåŠŸç </span><br>  <span class="hljs-attr">successCodeKey</span>: [<span class="hljs-string">&#x27;code&#x27;</span>], <span class="hljs-comment">// ä¸Šä¼ æˆåŠŸå¯¹åº”çš„å­—æ®µï¼Œæ•°ç»„è¡¨ç¤ºå–è¿”å›å†…å®¹ï¼ˆresï¼‰=&gt; res.code</span><br>  <span class="hljs-attr">errorMsgKey</span>: [<span class="hljs-string">&#x27;msg&#x27;</span>], <span class="hljs-comment">// ä¸Šä¼ å¤±è´¥å¯¹åº”çš„å­—æ®µ ï¼ˆresï¼‰=&gt; res.msg</span><br>  <span class="hljs-attr">errorMsg</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-comment">// é»˜è®¤é”™è¯¯ä¿¡æ¯ï¼Œä¸å¡«å†™åˆ™å±•ç¤ºâ€œä¸Šä¼ å¤±è´¥â€</span><br>  <span class="hljs-attr">successUrlKey</span>: [<span class="hljs-string">&#x27;data&#x27;</span>,<span class="hljs-string">&#x27;url&#x27;</span>], <span class="hljs-comment">//ä¸Šä¼ æˆåŠŸå¯¹åº”çš„å›¾ç‰‡URLã€‚ä¾‹å¦‚ res.data.url</span><br>  <span class="hljs-attr">proxy</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-comment">// ä»£ç†åœ°å€ï¼ˆä¾¿äºè·¨åŸŸï¼‰ï¼Œå¯å¡«å†™ https://cors-anywhere.azm.workers.dev/ , çœŸå®è¯·æ±‚åœ°å€ä¸º https://cors-anywhere.azm.workers.dev/APIURL ï¼ˆå…¶ä¸­APIURLæŒ‡çš„ä¸Šé¢å¡«å†™çš„urlï¼‰</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h2 id="å®ä¾‹æ–¹æ³•"><a href="#å®ä¾‹æ–¹æ³•" class="headerlink" title="å®ä¾‹æ–¹æ³•"></a>å®ä¾‹æ–¹æ³•</h2><ul><li><p><strong>render(String&#x2F;HTMLElement)</strong></p><p>åˆå§‹åŒ–æ¸²æŸ“å¹¶æŒ‚è½½æ’ä»¶ã€‚</p></li></ul><h2 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h2><p>å·²ç»åŒ…æ‹¬äº†é…ç½®é¡¹å’ŒGitalkç±»çš„ç±»å‹å®šä¹‰ï¼Œä¸åŒ…æ‹¬Reactç»„ä»¶çš„ç±»å‹å®šä¹‰ã€‚</p><h2 id="è®¸å¯"><a href="#è®¸å¯" class="headerlink" title="è®¸å¯"></a>è®¸å¯</h2><p>MIT LICENSE</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Github</tag>
      
      <tag>Gitalk</tag>
      
      <tag>æ’ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµ…è°ˆ ES6 ä¸­çš„ Proxy ç”¨æ³•</title>
    <link href="/2022/07/08/6-talk-about-es6-proxy/"/>
    <url>/2022/07/08/6-talk-about-es6-proxy/</url>
    
    <content type="html"><![CDATA[<div class="note note-warning">            <p class="title title-warning">WARNING</p><p>æ­¤å¤„ <code>Proxy</code> æŒ‡çš„æ˜¯ES6ä¸­çš„è¯­æ³•ï¼Œè€Œé <a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/proxy">FireFox proxy</a> ä¸ <a href="https://developer.chrome.com/docs/extensions/reference/proxy/">Chrome proxy</a> WebExtensionsã€‚è¯·æ³¨æ„ï¼Œå‰è€…æ˜¯æ ‡å‡†è¯­æ³•ï¼ŒPå¤§å†™ï¼›è€Œåè€…æ˜¯å¯¹åº”å‚å•†çš„ç§æœ‰æŠ€æœ¯ï¼Œpå°å†™ã€‚</p>          </div><h2 id="Proxy-ä»‹ç»"><a href="#Proxy-ä»‹ç»" class="headerlink" title="Proxy ä»‹ç»"></a>Proxy ä»‹ç»</h2><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">MDN</a> ä¸­çš„æè¿°ï¼š<code>Proxy</code> å¯¹è±¡ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå®ç°åŸºæœ¬æ“ä½œçš„æ‹¦æˆªå’Œè‡ªå®šä¹‰ï¼ˆå¦‚å±æ€§æŸ¥æ‰¾ã€èµ‹å€¼ã€æšä¸¾ã€å‡½æ•°è°ƒç”¨ç­‰ï¼‰ã€‚å…¶å®é€šä¿—æ¥è®²ï¼Œ<code>Proxy</code> ç›¸å½“äºåœ¨åŸç”Ÿæ–¹æ³•ï¼ˆä¾‹å¦‚ <code>get</code> è®¿é—®Objectçš„ä¸­çš„å±æ€§æˆ–æ–¹æ³•ã€<code>set</code> ä¿®æ”¹Objectä¸­çš„å±æ€§æˆ–æ–¹æ³•ã€<code>has</code> æ‹¦æˆªâ€inæ“ä½œç¬¦åˆ¤æ–­å±æ€§æˆ–æ–¹æ³•æ˜¯å¦å­˜åœ¨Objectæˆ–å…¶åŸå‹é“¾ä¸Šâ€ç­‰ç­‰ï¼‰ä¹‹ä¸Šçš„ä¸€å±‚æ•è·å™¨ï¼Œå¯ä»¥è¿›è¡Œæ‹¦æˆªã€ä¿®æ”¹ç­‰å¤šç§æ“ä½œã€‚<br><code>Proxy</code> å¸¸è§ç”¨æ³•æœ‰å¾ˆå¤šï¼ŒåŒ…æ‹¬ <a href="https://hackernoon.com/introducing-javascript-es6-proxies-1327419ab413">è¿ç®—ç¬¦é‡è½½</a>ï¼Œ<a href="https://en.wikipedia.org/wiki/Mock_object">å¯¹è±¡æ¨¡æ‹Ÿ</a>ï¼Œ<a href="https://medium.com/dailyjs/how-to-use-javascript-proxies-for-fun-and-profit-365579d4a9f8">ç®€æ´è€Œçµæ´»çš„APIåˆ›å»º</a>ï¼Œ<a href="https://github.com/sindresorhus/on-change">å¯¹è±¡æ›´æ”¹äº‹ä»¶</a> ç­‰ç­‰ã€‚<br>åˆæ¯”å¦‚åœ¨ <a href="https://cn.vuejs.org/">Vue2</a> ä¸­æ˜¯é€šè¿‡ <code>Object.defineProperty()</code> æ¥åŠ«æŒå„ä¸ªå±æ€§çš„<code>setter</code>ã€<code>getter</code> æ¥å®ç°çš„åŒå‘ç»‘å®šï¼Œè€Œåœ¨ <a href="https://v3.cn.vuejs.org/">Vue3</a> ä¸­ä½¿ç”¨çš„æ­£æ˜¯ <code>Proxy</code> æ¥å®ç°çš„åŒå‘ç»‘å®šã€‚</p></blockquote><div class="note note-info">            <p><code>Proxy</code> ç”¨äºä¿®æ”¹æŸäº›æ“ä½œçš„é»˜è®¤è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚æ‹¦æˆªï¼Œå¤–éƒ¨æ‰€æœ‰çš„è®¿é—®éƒ½å¿…é¡»å…ˆé€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œå› æ­¤æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥å¯¹å¤–éƒ¨çš„è®¿é—®è¿›è¡Œè¿‡æ»¤å’Œä¿®æ”¹ã€‚è¿™ä¸ªè¯çš„åŸç†ä¸ºä»£ç†ï¼Œåœ¨è¿™é‡Œå¯ä»¥è¡¨ç¤ºç”±å®ƒæ¥â€œä»£ç†â€æŸäº›æ“ä½œï¼Œè¯‘ä¸ºâ€œä»£ç†å™¨â€ã€‚</p>          </div><h3 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h3><ul><li><code>handler</code> åŒ…å«æ•æ‰å™¨ï¼ˆtrapï¼‰çš„å ä½ç¬¦å¯¹è±¡ï¼Œå¯è¯‘ä¸ºå¤„ç†å™¨å¯¹è±¡ã€‚</li><li><code>traps</code> æä¾›å±æ€§è®¿é—®çš„æ–¹æ³•ã€‚è¿™ç±»ä¼¼äºæ“ä½œç³»ç»Ÿä¸­æ•è·å™¨çš„æ¦‚å¿µã€‚ </li><li><code>target</code> è¢« <code>Proxy</code> ä»£ç†è™šæ‹ŸåŒ–çš„å¯¹è±¡ã€‚å®ƒå¸¸è¢«ä½œä¸ºä»£ç†çš„å­˜å‚¨åç«¯ã€‚æ ¹æ®ç›®æ ‡éªŒè¯å…³äºå¯¹è±¡ä¸å¯æ‰©å±•æ€§æˆ–ä¸å¯é…ç½®å±æ€§çš„ä¸å˜é‡ï¼ˆä¿æŒä¸å˜çš„è¯­ä¹‰ï¼‰ã€‚</li></ul><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><blockquote><p>ES6 åŸç”Ÿæä¾›äº† <code>Proxy</code> æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ <code>Proxy</code> å®ä¾‹ã€‚</p></blockquote><ul><li><code>target</code> è¦ä½¿ç”¨ Proxy åŒ…è£…çš„ <strong>ç›®æ ‡å¯¹è±¡</strong> <code>Object</code>ï¼ˆå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬åŸç”Ÿæ•°ç»„ï¼Œå‡½æ•°ï¼Œç”šè‡³å¦ä¸€ä¸ªä»£ç†ï¼‰ã€‚</li><li><code>handler</code> ä¸€ä¸ªé€šå¸¸ä»¥å‡½æ•°ä½œä¸ºå±æ€§çš„å¯¹è±¡ï¼Œå„å±æ€§ä¸­çš„å‡½æ•°åˆ†åˆ«å®šä¹‰äº†åœ¨æ‰§è¡Œå„ç§æ“ä½œæ—¶ä»£ç†çš„è¡Œä¸ºã€‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> proxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, handler);<br></code></pre></td></tr></table></figure><div class="note note-warning">            <p><strong>æ³¨æ„ï¼š</strong> <code>target</code> å¿…é¡»æ˜¯ <code>Object</code> ç±»å‹ï¼Œè€Œä¸èƒ½æ˜¯å…¶ä»–ç±»å‹ã€‚</p>          </div><p><code>Proxy</code> å¯¹è±¡çš„æ‰€æœ‰ç”¨æ³•ï¼Œéƒ½æ˜¯ä¸Šé¢çš„è¿™ç§å½¢å¼ã€‚ä¸åŒçš„åªæ˜¯ <code>handler</code> å‚æ•°çš„å†™æ³•ã€‚å…¶ä¸­ <code>new Proxy</code> ç”¨æ¥ç”Ÿæˆ <code>Proxy</code> å®ä¾‹ï¼Œ<code>target</code> æ˜¯è¡¨ç¤ºæ‰€è¦æ‹¦æˆªçš„å¯¹è±¡(Object)ï¼Œ<code>handler</code> æ˜¯ç”¨æ¥å®šåˆ¶æ‹¦æˆªè¡Œä¸ºçš„å¯¹è±¡ã€‚</p><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>ä¸‹é¢æ˜¯ <code>Proxy</code> æœ€ç®€å•çš„ä¾‹å­æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰æ•æ‰å™¨çš„ä»£ç†ï¼Œä¸€ä¸ª <code>get</code> æ•æ‰å™¨ï¼Œæ€»æ˜¯è¿”å› <code>42</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> target = &#123;<br>  <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>,<br>  <span class="hljs-attr">y</span>: <span class="hljs-number">20</span><br>&#125;<br><br><span class="hljs-keyword">let</span> handler = &#123;<br>  <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">obj, prop</span>) =&gt;</span> <span class="hljs-number">42</span><br>&#125;<br><br>target = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, handler)<br><br>target.<span class="hljs-property">x</span> <span class="hljs-comment">// 42</span><br>target.<span class="hljs-property">y</span> <span class="hljs-comment">// 42</span><br>target.<span class="hljs-property">x</span> <span class="hljs-comment">// 42</span><br></code></pre></td></tr></table></figure><p>ç»“æœæ˜¯ä¸€ä¸ªå¯¹è±¡å°†ä¸ºä»»ä½•å±æ€§è®¿é—®æ“ä½œéƒ½è¿”å›â€œ42â€ã€‚ è¿™åŒ…æ‹¬ <code>target.x</code>ï¼Œ<code>target[&#39;x&#39;]</code>ï¼Œ<code>Reflect.get(target, &#39;x&#39;)</code> ç­‰ã€‚</p><h3 id="handler-å¯¹è±¡çš„æ–¹æ³•"><a href="#handler-å¯¹è±¡çš„æ–¹æ³•" class="headerlink" title="handler å¯¹è±¡çš„æ–¹æ³•"></a>handler å¯¹è±¡çš„æ–¹æ³•</h3><p><code>handler</code> å¯¹è±¡æ˜¯ä¸€ä¸ªå®¹çº³ä¸€æ‰¹ç‰¹å®šå±æ€§çš„å ä½ç¬¦å¯¹è±¡ã€‚å®ƒåŒ…å«æœ‰ <code>Proxy</code> çš„å„ä¸ªæ•è·å™¨ï¼ˆtrapï¼‰ã€‚</p><p>æ‰€æœ‰çš„æ•æ‰å™¨æ˜¯å¯é€‰çš„ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰æŸä¸ªæ•æ‰å™¨ï¼Œé‚£ä¹ˆå°±ä¼šä¿ç•™æºå¯¹è±¡çš„é»˜è®¤è¡Œä¸ºã€‚</p><ul><li><code>getPrototypeOf()</code> ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/GetPrototypeOf">Object.getPrototypeOf</a> æ–¹æ³•çš„æ•æ‰å™¨ã€‚</li><li><code>setPrototypeOf()</code> ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf">Object.setPrototypeOf</a> æ–¹æ³•çš„æ•æ‰å™¨ã€‚</li><li><code>isExtensible()</code> ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/isExtensible">Object.isExtensible</a> æ–¹æ³•çš„æ•æ‰å™¨ã€‚</li><li><code>preventExtensions()</code> ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/preventExtensions">Object.preventExtensions</a> æ–¹æ³•çš„æ•æ‰å™¨ã€‚</li><li><code>getOwnPropertyDescriptor()</code> ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor">Object.getOwnPropertyDescriptor</a> æ–¹æ³•çš„æ•æ‰å™¨ã€‚</li><li><code>defineProperty()</code>ï¼š <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">Object.defineProperty</a> æ–¹æ³•çš„æ•æ‰å™¨ã€‚</li><li><code>has()</code> ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/in">in</a> æ“ä½œç¬¦çš„æ•æ‰å™¨ã€‚</li><li><code>get()</code> ï¼šå±æ€§è¯»å–æ“ä½œçš„æ•æ‰å™¨ã€‚</li><li><code>set()</code> ï¼šå±æ€§è®¾ç½®æ“ä½œçš„æ•æ‰å™¨ã€‚</li><li><code>deleteProperty()</code> ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/delete">delete</a> æ“ä½œç¬¦çš„æ•æ‰å™¨ã€‚</li><li><code>ownKeys()</code> ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames">Object.getOwnPropertyNames</a> æ–¹æ³•å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols">Object.getOwnPropertySymbols</a> æ–¹æ³•çš„æ•æ‰å™¨ã€‚</li><li><code>apply()</code> ï¼šå‡½æ•°è°ƒç”¨æ“ä½œçš„æ•æ‰å™¨ã€‚</li><li><code>construct()</code> ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new">new</a> æ“ä½œç¬¦çš„æ•æ‰å™¨ã€‚</li></ul><p>æ­¤å¤–ï¼Œä¸€äº›ä¸æ ‡å‡†çš„æ•æ‰å™¨å·²ç»è¢«<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Deprecated_and_obsolete_features#proxy">åºŸå¼ƒå¹¶ä¸”ç§»é™¤</a>äº†ã€‚</p><h2 id="Proxy-ä¾‹å­"><a href="#Proxy-ä¾‹å­" class="headerlink" title="Proxy ä¾‹å­"></a>Proxy ä¾‹å­</h2><h3 id="é»˜è®¤å€¼-x2F-â€œé›¶å€¼â€"><a href="#é»˜è®¤å€¼-x2F-â€œé›¶å€¼â€" class="headerlink" title="é»˜è®¤å€¼&#x2F;â€œé›¶å€¼â€"></a>é»˜è®¤å€¼&#x2F;â€œé›¶å€¼â€</h3><blockquote><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œæœ‰é›¶å€¼(nil)çš„æ¦‚å¿µï¼Œé›¶å€¼æ˜¯ç‰¹å®šäºç±»å‹çš„éšå¼é»˜è®¤ç»“æ„å€¼ã€‚å…¶æ€æƒ³æ˜¯æä¾›ç±»å‹å®‰å…¨çš„é»˜è®¤åŸºå…ƒå€¼ï¼Œæˆ–è€…ç”¨gopherçš„è¯è¯´ï¼Œç»™ç»“æ„ä¸€ä¸ªæœ‰ç”¨çš„é›¶å€¼ã€‚</p></blockquote><p>è™½ç„¶ä¸åŒçš„åˆ›å»ºæ¨¡å¼æ”¯æŒç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½† Javascript æ— æ³•ç”¨éšå¼åˆå§‹å€¼åŒ…è£…å¯¹è±¡ã€‚Javascript ä¸­æœªè®¾ç½®å±æ€§çš„é»˜è®¤å€¼æ˜¯ <code>undefined</code>ã€‚ä½† <code>Proxy</code> å¯ä»¥æ”¹å˜è¿™ç§æƒ…å†µã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">withZeroValue</span> = (<span class="hljs-params">target, zeroValue</span>) =&gt; <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, &#123;<br>        <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">obj, prop</span>) =&gt;</span> (prop <span class="hljs-keyword">in</span> obj) ? obj[prop] : zeroValue<br>    &#125;)<br></code></pre></td></tr></table></figure><p>å‡½æ•° <code>withZeroValue</code> ç”¨æ¥åŒ…è£…ç›®æ ‡å¯¹è±¡ã€‚ å¦‚æœè®¾ç½®äº†å±æ€§ï¼Œåˆ™è¿”å›å±æ€§å€¼ã€‚ å¦åˆ™ï¼Œå®ƒè¿”å›ä¸€ä¸ªé»˜è®¤çš„ â€œé›¶å€¼â€ ã€‚</p><p>ä»æŠ€æœ¯ä¸Šè®²ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿä¸æ˜¯éšå«çš„ï¼Œä½†å¦‚æœæˆ‘ä»¬æ‰©å±• <code>withZeroValue</code>ï¼Œä»¥ <code>Boolean (false)</code>, <code>Number (0)</code>, <code>String (&quot;&quot;)</code>, <code>Object (&#123;&#125;)</code>ï¼Œ<code>Array ([])</code>ç­‰å¯¹åº”çš„é›¶å€¼ï¼Œåˆ™å¯èƒ½æ˜¯éšå«çš„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> pos = &#123;<br>  <span class="hljs-attr">x</span>: <span class="hljs-number">4</span>,<br>  <span class="hljs-attr">y</span>: <span class="hljs-number">19</span><br>&#125;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(pos.<span class="hljs-property">x</span>, pos.<span class="hljs-property">y</span>, pos.<span class="hljs-property">z</span>) <span class="hljs-comment">// 4, 19, undefined</span><br><br>pos = <span class="hljs-title function_">withZeroValue</span>(pos, <span class="hljs-number">0</span>)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(pos.<span class="hljs-property">z</span>, pos.<span class="hljs-property">y</span>, pos.<span class="hljs-property">z</span>) <span class="hljs-comment">// 4, 19, 0</span><br></code></pre></td></tr></table></figure><p>æ­¤åŠŸèƒ½å¯èƒ½æœ‰ç”¨çš„ä¸€ä¸ªåœ°æ–¹æ˜¯åæ ‡ç³»ã€‚ ç»˜å›¾åº“å¯ä»¥åŸºäºæ•°æ®çš„å½¢çŠ¶è‡ªåŠ¨æ”¯æŒ2Då’Œ3Dæ¸²æŸ“ã€‚ ä¸æ˜¯åˆ›å»ºä¸¤ä¸ªå•ç‹¬çš„æ¨¡å‹ï¼Œè€Œæ˜¯å§‹ç»ˆå°†zé»˜è®¤ä¸º 0 è€Œä¸æ˜¯ <code>undefined</code>ï¼Œè¿™å¯èƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚</p><h3 id="è´Ÿç´¢å¼•æ•°ç»„"><a href="#è´Ÿç´¢å¼•æ•°ç»„" class="headerlink" title="è´Ÿç´¢å¼•æ•°ç»„"></a>è´Ÿç´¢å¼•æ•°ç»„</h3><blockquote><p>åœ¨JSä¸­è·å–æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ æ–¹å¼é€šè¿‡å†™çš„å¾ˆå†—é•¿ä¸”é‡å¤ï¼Œä¹Ÿå®¹æ˜“å‡ºé”™ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰ä¸€ä¸ªTC39ææ¡ˆå®šä¹‰äº†ä¸€ä¸ªä¾¿åˆ©å±æ€§ <code>Array.lastItem</code> æ¥è·å–å’Œè®¾ç½®æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p></blockquote><p>å…¶ä»–è¯­è¨€ï¼Œå¦‚ Python å’Œ Rubyï¼Œä½¿ç”¨è´Ÿç»„ç´¢å¼•æ›´å®¹æ˜“è®¿é—®æœ€åé¢çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç®€å•åœ°ä½¿ç”¨ <code>arr[-1]</code> æ›¿ä»£ <code>arr[arr.length-1]</code> è®¿é—®æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p><p>ä½¿ç”¨ <code>Proxy</code> ä¹Ÿå¯ä»¥åœ¨ Javascript ä¸­ä½¿ç”¨è´Ÿç´¢å¼•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">negativeArray</span> = (<span class="hljs-params">els</span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(els, &#123;<br>  <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">target, property, receiver</span>) =&gt;</span> <br>    <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(<br>        target,<br>        ( +property &lt; <span class="hljs-number">0</span>) ? <span class="hljs-title class_">String</span>( target.<span class="hljs-property">length</span> + +property ) : property, <br>        receiver<br>    )<br>&#125;);<br></code></pre></td></tr></table></figure><ul><li><code>target</code> : ç›®æ ‡å¯¹è±¡ã€‚</li><li><code>property</code> : è¢«è·å–çš„å±æ€§åã€‚</li><li><code>receiver</code> : <code>Proxy</code> æˆ–è€…ç»§æ‰¿ <code>Proxy</code> çš„å¯¹è±¡</li></ul><div class="note note-info">            <p><code>Reflect</code> æ˜¯ä¸€ä¸ªå†…ç½®çš„å¯¹è±¡ï¼Œå®ƒæä¾›æ‹¦æˆª JavaScript æ“ä½œçš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ä¸ <code>Proxy handlers</code> çš„æ–¹æ³•ç›¸åŒã€‚<code>Reflect</code> ä¸æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œå› æ­¤å®ƒæ˜¯ä¸å¯æ„é€ çš„ã€‚<br>ä¸å¤§å¤šæ•°å…¨å±€å¯¹è±¡ä¸åŒ <code>Reflect</code> å¹¶éä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ‰€ä»¥<strong>ä¸èƒ½</strong>é€šè¿‡ <code>new</code> è¿ç®—ç¬¦å¯¹å…¶è¿›è¡Œè°ƒç”¨ï¼Œæˆ–è€…å°† <code>Reflect</code> å¯¹è±¡ä½œä¸ºä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨ã€‚<code>Reflect</code> çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼ˆå°±åƒ <code>Math</code> å¯¹è±¡ï¼‰ã€‚<br><a style="color: var(--post-link-color);" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">ç‚¹å‡»å¯æŸ¥çœ‹MDNè§£é‡Š</a></p>          </div><p>ä¸€ä¸ªé‡è¦çš„æ³¨æ„äº‹é¡¹æ˜¯åŒ…å« <code>get</code> çš„æ•æ‰å™¨ï¼ˆtrapï¼‰å­—ç¬¦ä¸²åŒ–æ‰€æœ‰å±æ€§ã€‚ å¯¹äºæ•°ç»„è®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦å°†å±æ€§åç§°å¼ºåˆ¶è½¬æ¢ä¸º <code>Numbers</code>ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨åŠ è¿ç®—ç¬¦ï¼ˆéšå¼è½¬æ¢ï¼‰ç®€æ´åœ°å®Œæˆã€‚</p><p>ç°åœ¨ <code>arr[-1]</code> è®¿é—®æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ<code>arr[-2]</code> è®¿é—®å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> arr = <span class="hljs-title function_">negativeArray</span>([<span class="hljs-string">&#x27;ğŸš€&#x27;</span>, <span class="hljs-string">&#x27;ğŸ“š&#x27;</span>, <span class="hljs-string">&#x27;ğŸŒˆ&#x27;</span>]);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr[-<span class="hljs-number">1</span>]) <span class="hljs-comment">// &#x27;ğŸŒˆ&#x27;</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr[-<span class="hljs-number">2</span>]) <span class="hljs-comment">// &#x27;ğŸ“š&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="éšè—å±æ€§"><a href="#éšè—å±æ€§" class="headerlink" title="éšè—å±æ€§"></a>éšè—å±æ€§</h3><blockquote><p>ä¼—æ‰€å‘¨çŸ¥ JS æ²¡æœ‰ç§æœ‰å±æ€§ã€‚ <code>Symbol</code> æœ€åˆæ˜¯ä¸ºäº†å¯ç”¨ç§æœ‰å±æ€§è€Œå¼•å…¥çš„ï¼Œä½†åæ¥ä½¿ç”¨åƒ <code>Object.getOwnPropertySymbols</code> è¿™æ ·çš„åå°„æ–¹æ³•è¿›è¡Œäº†æ·¡åŒ–ï¼Œè¿™ä½¿å¾—å®ƒä»¬å¯ä»¥è¢«å…¬å¼€å‘ç°ã€‚é•¿æœŸä»¥æ¥çš„æƒ¯ä¾‹æ˜¯å°†ç§æœ‰å±æ€§å‘½åä¸ºå‰ä¸‹åˆ’çº¿ <code>_</code> ï¼Œæœ‰æ•ˆåœ°æ ‡è®°å®ƒä»¬â€œä¸è¦è®¿é—®â€ã€‚<code>Proxy</code> æä¾›äº†ä¸€ç§ç¨å¾®æ›´å¥½çš„æ–¹æ³•æ¥å±è”½è¿™äº›å±æ€§ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">hide</span> = (<span class="hljs-params">target, prefix = <span class="hljs-string">&#x27;_&#x27;</span></span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, &#123;<br>  <span class="hljs-attr">has</span>: <span class="hljs-function">(<span class="hljs-params">obj, prop</span>) =&gt;</span> (!prop.<span class="hljs-title function_">startsWith</span>(prefix) &amp;&amp; prop <span class="hljs-keyword">in</span> obj),<br>  <span class="hljs-attr">ownKeys</span>: <span class="hljs-function">(<span class="hljs-params">obj</span>) =&gt;</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(obj)<br>    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">prop</span> =&gt;</span> (<span class="hljs-keyword">typeof</span> prop !== <span class="hljs-string">&quot;string&quot;</span> || !prop.<span class="hljs-title function_">startsWith</span>(prefix))),<br>  <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">obj, prop, rec</span>) =&gt;</span> (prop <span class="hljs-keyword">in</span> rec) ? obj[prop] : <span class="hljs-literal">undefined</span><br>&#125;)<br></code></pre></td></tr></table></figure><p><code>hide</code> å‡½æ•°åŒ…è£…ç›®æ ‡å¯¹è±¡ï¼Œå¹¶ä½¿å¾—ä» <code>in</code> è¿ç®—ç¬¦å’Œ <code>Object.getOwnPropertyNames</code> ç­‰æ–¹æ³•æ— æ³•è®¿é—®å¸¦æœ‰ä¸‹åˆ’çº¿çš„å±æ€§ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> userData = <span class="hljs-title function_">hide</span>(&#123;<br>  <span class="hljs-attr">firstName</span>: <span class="hljs-string">&#x27;Tom&#x27;</span>,<br>  <span class="hljs-attr">mediumHandle</span>: <span class="hljs-string">&#x27;@tbarrasso&#x27;</span>,<br>  <span class="hljs-attr">_favoriteRapper</span>: <span class="hljs-string">&#x27;Drake&#x27;</span><br>&#125;)<br><br>userData.<span class="hljs-property">_favoriteRapper</span>        <span class="hljs-comment">// undefined</span><br>(<span class="hljs-string">&#x27;_favoriteRapper&#x27;</span> <span class="hljs-keyword">in</span> userData) <span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure><p>æ›´å®Œæ•´çš„å®ç°è¿˜åŒ…æ‹¬è¯¸å¦‚ <code>deleteProperty</code> å’Œ <code>defineProperty</code> ä¹‹ç±»çš„æ•æ‰å™¨ã€‚ é™¤äº†é—­åŒ…ä¹‹å¤–ï¼Œè¿™å¯èƒ½æ˜¯æœ€æ¥è¿‘çœŸæ­£ç§æœ‰å±æ€§çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬æ— æ³•é€šè¿‡æšä¸¾ï¼Œå…‹éš†ï¼Œè®¿é—®æˆ–ä¿®æ”¹æ¥è®¿é—®ã€‚</p><h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><p>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´åŒæ­¥çŠ¶æ€æ—¶é‡åˆ°å›°éš¾å¹¶ä¸ç½•è§ã€‚æ•°æ®å¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå‘ç”Ÿå˜åŒ–ï¼Œå¾ˆéš¾ç¡®åˆ‡åœ°çŸ¥é“ä½•æ—¶é‡æ–°åŒæ­¥çš„é€»è¾‘ã€‚</p><p><code>Proxy</code> å¯ç”¨äº†ä¸€ç§æ–°æ–¹æ³•ï¼šæ ¹æ®éœ€è¦å°†å¯¹è±¡åŒ…è£…ä¸ºæ— æ•ˆï¼ˆå’Œé‡æ–°åŒæ­¥ï¼‰å±æ€§ã€‚ æ‰€æœ‰è®¿é—®å±æ€§çš„å°è¯•éƒ½é¦–å…ˆæ£€æŸ¥ç¼“å­˜ç­–ç•¥ï¼Œè¯¥ç­–ç•¥å†³å®šè¿”å›å½“å‰åœ¨å†…å­˜ä¸­çš„å†…å®¹è¿˜æ˜¯é‡‡å–å…¶ä»–ä¸€äº›æ“ä½œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">ephemeral</span> = (<span class="hljs-params">target, ttl = <span class="hljs-number">60</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CREATED_AT</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">isExpired</span> = (<span class="hljs-params"></span>) =&gt; (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-variable constant_">CREATED_AT</span>) &gt; (ttl * <span class="hljs-number">1000</span>)<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, &#123;<br>    <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">obj, prop</span>) =&gt;</span> <span class="hljs-title function_">isExpired</span>() ? <span class="hljs-literal">undefined</span> : <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(obj, prop)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°è¿‡äºç®€åŒ–äº†: å®ƒä½¿å¯¹è±¡ä¸Šçš„æ‰€æœ‰å±æ€§åœ¨ä¸€æ®µæ—¶é—´åéƒ½æ— æ³•è®¿é—®ã€‚ç„¶è€Œï¼Œå°†æ­¤æ–¹æ³•æ‰©å±•ä¸ºæ ¹æ®æ¯ä¸ªå±æ€§è®¾ç½®ç”Ÿå­˜æ—¶é—´(TTL)ï¼Œå¹¶åœ¨ä¸€å®šçš„æŒç»­æ—¶é—´æˆ–è®¿é—®æ¬¡æ•°ä¹‹åæ›´æ–°å®ƒå¹¶ä¸å›°éš¾ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> bankAccount = <span class="hljs-title function_">ephemeral</span>(&#123;<br>  <span class="hljs-attr">balance</span>: <span class="hljs-number">14.93</span><br>&#125;, <span class="hljs-number">10</span>)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bankAccount.<span class="hljs-property">balance</span>)    <span class="hljs-comment">// 14.93</span><br><br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bankAccount.<span class="hljs-property">balance</span>)  <span class="hljs-comment">// undefined</span><br>&#125;, <span class="hljs-number">10</span> * <span class="hljs-number">1000</span>)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç¤ºä¾‹ç®€å•åœ°ä½¿é“¶è¡Œå¸æˆ·ä½™é¢åœ¨10ç§’åæ— æ³•è®¿é—®ã€‚</p><h3 id="è¿ç®—ç¬¦é‡è½½"><a href="#è¿ç®—ç¬¦é‡è½½" class="headerlink" title="è¿ç®—ç¬¦é‡è½½"></a>è¿ç®—ç¬¦é‡è½½</h3><p>ä¹Ÿè®¸ä»è¯­æ³•ä¸Šè®²ï¼Œæœ€å¸å¼•äººçš„ <code>Proxy</code> ç”¨ä¾‹æ˜¯é‡è½½æ“ä½œç¬¦çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ä½¿ç”¨ <code>handler.has</code> çš„ <code>in</code> æ“ä½œç¬¦ã€‚</p><p><code>in</code> æ“ä½œç¬¦ç”¨äºæ£€æŸ¥æŒ‡å®šçš„å±æ€§æ˜¯å¦ä½äºæŒ‡å®šçš„å¯¹è±¡æˆ–å…¶åŸå‹é“¾ä¸­ã€‚ä½†å®ƒä¹Ÿæ˜¯è¯­æ³•ä¸Šæœ€ä¼˜é›…çš„é‡è½½æ“ä½œç¬¦ã€‚è¿™ä¸ªä¾‹å­å®šä¹‰äº†ä¸€ä¸ªè¿ç»­rangeå‡½æ•°æ¥æ¯”è¾ƒæ•°å­—ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">range</span> = (<span class="hljs-params">min, max</span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>), &#123;<br>  <span class="hljs-attr">has</span>: <span class="hljs-function">(<span class="hljs-params">_, prop</span>) =&gt;</span> (+prop &gt;= min &amp;&amp; +prop &lt;= max)<br>&#125;)<br></code></pre></td></tr></table></figure><p>ä¸Pythonä¸åŒï¼ŒPythonä½¿ç”¨ç”Ÿæˆå™¨ä¸æœ‰é™çš„æ•´æ•°åºåˆ—è¿›è¡Œæ¯”è¾ƒï¼Œè¿™ç§æ–¹æ³•æ”¯æŒåè¿›åˆ¶æ¯”è¾ƒï¼Œå¯ä»¥æ‰©å±•ä¸ºæ”¯æŒå…¶ä»–æ•°å€¼èŒƒå›´ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> X = <span class="hljs-number">10.5</span><br><span class="hljs-keyword">const</span> nums = [<span class="hljs-number">1</span>, <span class="hljs-number">5</span>, X, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>]<br><br><span class="hljs-keyword">if</span> (X <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>)) &#123; <span class="hljs-comment">// true</span><br>  <span class="hljs-comment">// ...</span><br>&#125;<br><br>nums.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)) <span class="hljs-comment">// [1, 5]</span><br></code></pre></td></tr></table></figure><p>å°½ç®¡è¿™ä¸ªç”¨ä¾‹ä¸èƒ½è§£å†³å¤æ‚çš„é—®é¢˜ï¼Œä½†å®ƒç¡®å®æä¾›äº†å¹²å‡€ã€å¯è¯»å’Œå¯é‡ç”¨çš„ä»£ç ã€‚</p><p>é™¤äº† <code>in</code> è¿ç®—ç¬¦ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é‡è½½ <code>delete</code> å’Œ <code>new</code>ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><strong>ä¸ºä»€ä¹ˆè¦ç”¨ Proxy ?</strong></p><p>å°±æ‹¿ Vue ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ Vue2 ä¸­å½“ä¸€ä¸ª Vue å®ä¾‹åˆ›å»ºæ—¶ï¼ŒVue ä¼šéå† <code>data</code> ä¸­çš„å±æ€§ï¼Œç”¨ <code>Object.defineProperty</code> å°†å®ƒä»¬è½¬ä¸º <code>getter/setter</code>ï¼Œå¹¶ä¸”åœ¨å†…éƒ¨è¿½è¸ªç›¸å…³ä¾èµ–ï¼Œåœ¨å±æ€§è¢«è®¿é—®å’Œä¿®æ”¹æ—¶é€šçŸ¥å˜åŒ–ã€‚ æ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½æœ‰ç›¸åº”çš„ <code>watcher</code> ç¨‹åºå®ä¾‹ï¼Œå®ƒä¼šåœ¨ç»„ä»¶æ¸²æŸ“çš„è¿‡ç¨‹ä¸­æŠŠå±æ€§è®°å½•ä¸ºä¾èµ–ï¼Œä¹‹åå½“ä¾èµ–é¡¹çš„ <code>setter</code> è¢«è°ƒç”¨æ—¶ï¼Œä¼šé€šçŸ¥ <code>watcher</code> é‡æ–°è®¡ç®—ï¼Œä»è€Œè‡´ä½¿å®ƒå…³è”çš„ç»„ä»¶å¾—ä»¥æ›´æ–°ã€‚</p><p>è€Œè¿™æ ·ä¸€ä¸ªä¸ªéå†å¯¹ <code>data</code> è¿›è¡Œä¿®æ”¹æ˜¾ç„¶æ˜¯ä¸é«˜æ•ˆçš„ï¼Œæ‰€ä»¥åœ¨ Vue3 ä¸­ä½¿ç”¨äº† Proxy æ¥è¿›è¡Œæ•°æ®åŠ«æŒã€‚</p><p>Vue3 ä½¿ç”¨ Proxy æ¥ç›‘æ§æ•°æ®çš„å˜åŒ–ã€‚å°±æœ¬æ–‡ä»¥ä¸Šæ‰€è¯´ï¼ŒProxy æ˜¯ ES6 ä¸­æä¾›çš„åŠŸèƒ½ï¼Œå…¶ä½œç”¨ä¸ºï¼šç”¨äºå®šä¹‰åŸºæœ¬æ“ä½œçš„è‡ªå®šä¹‰è¡Œä¸ºï¼ˆå¦‚å±æ€§æŸ¥æ‰¾ï¼Œèµ‹å€¼ï¼Œæšä¸¾ï¼Œå‡½æ•°è°ƒç”¨ç­‰ï¼‰ã€‚ç›¸å¯¹äº <code>Object.defineProperty()</code>ï¼Œå…¶æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li><code>Proxy</code> ç›´æ¥ä»£ç†æ•´ä¸ªå¯¹è±¡è€Œéå¯¹è±¡å±æ€§ï¼Œè¿™æ ·åªéœ€åšä¸€å±‚ä»£ç†å°±å¯ä»¥ç›‘å¬åŒçº§ç»“æ„ä¸‹çš„æ‰€æœ‰å±æ€§å˜åŒ–ï¼ŒåŒ…æ‹¬æ–°å¢å±æ€§å’Œåˆ é™¤å±æ€§ã€‚</li><li><code>Proxy</code> å¯ä»¥ç›‘å¬æ•°ç»„çš„å˜åŒ–ã€‚(åœ¨ Vue2 ä¸­æ˜¯é‡å†™äº†æ•°ç»„ä¸­çš„å„ç§æ–¹æ³•æ‰è¾¾åˆ°ç›‘å¬çš„ç›®çš„ï¼Œå¦‚ <code>push</code>ã€<code>pop</code>ã€<code>shift</code>ã€<code>unshift</code>ã€<code>splice</code>ã€<code>sort</code>ã€<code>reverse</code> ç­‰)</li></ol><p>åœ¨ Vue2 ä¸­ï¼Œ<code>Object.defineProperty</code> ä¼šæ”¹å˜åŸå§‹æ•°æ®ï¼Œè€Œ <code>Proxy</code> æ˜¯åˆ›å»ºå¯¹è±¡çš„è™šæ‹Ÿè¡¨ç¤ºï¼Œå¹¶æä¾› <code>set</code> ã€<code>get</code> å’Œ <code>deleteProperty</code> ç­‰å¤„ç†å™¨ï¼Œè¿™äº›å¤„ç†å™¨å¯åœ¨è®¿é—®æˆ–ä¿®æ”¹åŸå§‹å¯¹è±¡ä¸Šçš„å±æ€§æ—¶è¿›è¡Œæ‹¦æˆªï¼Œæœ‰ä»¥ä¸‹ç‰¹ç‚¹âˆ¶</p><ul><li>ä¸éœ€ç”¨ä½¿ç”¨ <code>Vue.$set</code> æˆ– <code>Vue.$delete</code> è§¦å‘å“åº”å¼ã€‚</li><li>å…¨æ–¹ä½çš„æ•°ç»„å˜åŒ–æ£€æµ‹ï¼Œæ¶ˆé™¤äº† Vue2 æ— æ•ˆçš„è¾¹ç•Œæƒ…å†µã€‚</li><li>æ”¯æŒ <code>Map</code>ï¼Œ<code>Set</code>ï¼Œ<code>WeakMap</code> å’Œ <code>WeakSet</code>ã€‚</li></ul><p>Vue3 ä¸­ <code>Proxy</code> å®ç°çš„å“åº”å¼åŸç†ä¸ Vue2 çš„å®ç°åŸç†ç›¸åŒï¼Œå®ç°æ–¹å¼å¤§åŒå°å¼‚âˆ¶ </p><ul><li><code>get</code> æ”¶é›†ä¾èµ–ï¼›</li><li><code>set</code>ã€<code>delete</code> ç­‰è§¦å‘ä¾èµ–ï¼›</li><li>å¯¹äºé›†åˆç±»å‹ï¼Œå°±æ˜¯å¯¹é›†åˆå¯¹è±¡çš„æ–¹æ³•åšä¸€å±‚åŒ…è£…ï¼šåŸæ–¹æ³•æ‰§è¡Œåæ‰§è¡Œä¾èµ–ç›¸å…³çš„æ”¶é›†æˆ–è§¦å‘é€»è¾‘ï¼›</li></ul><p><strong>THE END</strong></p><p><code>Proxy</code> æä¾›è™šæ‹ŸåŒ–æ¥å£æ¥æ§åˆ¶ä»»ä½•ç›®æ ‡ <code>Object</code> çš„è¡Œä¸ºã€‚ è¿™æ ·åšå¯ä»¥åœ¨ç®€å•æ€§å’Œå®ç”¨æ€§ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œè€Œä¸ä¼šç‰ºç‰²å…¼å®¹æ€§ã€‚</p><p>ä¹Ÿè®¸ä½¿ç”¨ <code>Proxy</code> çš„æœ€ä»¤äººä¿¡æœçš„ç†ç”±æ˜¯ï¼Œä¸Šé¢çš„è®¸å¤šç¤ºä¾‹åªæœ‰å‡ è¡Œï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾ç»„åˆä»¥åˆ›å»ºå¤æ‚çš„åŠŸèƒ½ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://segmentfault.com/a/1190000019725835?utm_source=sf-similar-article">Proxy çš„å·§ç”¨ - æ€å¦</a> ç¿»è¯‘è‡ª <a href="https://blog.bitsrc.io/a-practical-guide-to-es6-proxy-229079c3c2f0">A practical guide to Javascript Proxy | by Thomas Barrasso | Bits and Pieces</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy - JavaScript | MDN</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>JavaScript</tag>
      
      <tag>ES6</tag>
      
      <tag>Proxy</tag>
      
      <tag>Object</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘ç«™å¦‚ä½•é˜²æ­¢è¢«iframeå¼•ç”¨</title>
    <link href="/2022/07/06/5-website-block-iframe/"/>
    <url>/2022/07/06/5-website-block-iframe/</url>
    
    <content type="html"><![CDATA[<h2 id="X-Frame-Options"><a href="#X-Frame-Options" class="headerlink" title="X-Frame-Options"></a>X-Frame-Options</h2><p><code>X-Frame-Options</code> é€šå¸¸å­˜åœ¨ä¸‰ä¸ªå€¼ï¼Œè¢«è®¾ç½®åœ¨æœåŠ¡ç«¯è¿”å›å¤´ï¼ˆResponse Headerï¼‰ä¸­ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">X-Frame-Options: DENY<br>X-Frame-Options: SAMEORIGIN<br>X-Frame-Options: ALLOW-FROM uri #æ­¤ç”¨æ³•è¢«å¼ƒç”¨ï¼Œå¯èƒ½ä¸è¢«æ”¯æŒ<br></code></pre></td></tr></table></figure><p>å¦‚æœè®¾ç½®ä¸º <code>DENY</code>ï¼Œä¸å…‰åœ¨åˆ«äººçš„ç½‘ç«™ frame åµŒå…¥æ—¶ä¼šæ— æ³•åŠ è½½ï¼Œåœ¨åŒåŸŸåé¡µé¢ä¸­åŒæ ·ä¼šæ— æ³•åŠ è½½ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœè®¾ç½®ä¸º <code>SAMEORIGIN</code>ï¼Œé‚£ä¹ˆé¡µé¢å°±å¯ä»¥åœ¨åŒåŸŸåé¡µé¢çš„ frame ä¸­åµŒå¥—ã€‚</p><p><code>DENY</code></p><blockquote><p>è¡¨ç¤ºè¯¥é¡µé¢ä¸å…è®¸åœ¨ frame ä¸­å±•ç¤ºï¼Œå³ä¾¿æ˜¯åœ¨ç›¸åŒåŸŸåçš„é¡µé¢ä¸­åµŒå¥—ä¹Ÿä¸å…è®¸ã€‚</p></blockquote><p><code>SAMEORIGIN</code></p><blockquote><p>è¡¨ç¤ºè¯¥é¡µé¢å¯ä»¥åœ¨ç›¸åŒåŸŸåé¡µé¢çš„ frame ä¸­å±•ç¤ºã€‚è§„èŒƒè®©æµè§ˆå™¨å‚å•†å†³å®šæ­¤é€‰é¡¹æ˜¯å¦åº”ç”¨äºé¡¶å±‚ã€çˆ¶çº§æˆ–æ•´ä¸ªé“¾ï¼Œæœ‰äººè®¤ä¸ºè¯¥é€‰é¡¹ä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œé™¤éæ‰€æœ‰çš„ç¥–å…ˆé¡µé¢éƒ½å±äºåŒä¸€æ¥æºï¼ˆoriginï¼‰ã€‚å‚è§<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Frame-Options#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7">æµè§ˆå™¨å…¼å®¹æ€§</a>ä»¥è·å–è¯¦ç»†çš„å…¼å®¹æ€§ä¿¡æ¯ã€‚</p></blockquote><p><code>ALLOW-FROM uri</code> <strong>å·²å¼ƒç”¨</strong></p><blockquote><p>è¿™æ˜¯ä¸€ä¸ªè¢«å¼ƒç”¨çš„æŒ‡ä»¤ï¼Œä¸å†é€‚ç”¨äºç°ä»£æµè§ˆå™¨ï¼Œè¯·ä¸è¦ä½¿ç”¨å®ƒã€‚åœ¨æ”¯æŒæ—§ç‰ˆæµè§ˆå™¨æ—¶ï¼Œé¡µé¢å¯ä»¥åœ¨æŒ‡å®šæ¥æºçš„ frame ä¸­å±•ç¤ºã€‚è¯·æ³¨æ„ï¼Œåœ¨æ—§ç‰ˆ Firefox ä¸Šï¼Œå®ƒä¼šé‡åˆ°ä¸ <code>SAMEORIGIN</code> ç›¸åŒçš„é—®é¢˜â€”â€”å®ƒä¸ä¼šæ£€æŸ¥ frame æ‰€æœ‰çš„ç¥–å…ˆé¡µé¢æ¥ç¡®å®šä»–ä»¬æ˜¯å¦æ˜¯åŒä¸€æ¥æºã€‚<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy">Content-Security-Policy</a> HTTP é¦–éƒ¨æœ‰ä¸€ä¸ª <code>frame-ancestors</code> æŒ‡ä»¤ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸€æŒ‡ä»¤æ¥ä»£æ›¿ã€‚</p></blockquote><div class="note note-danger">            <p><strong>å¤‡æ³¨ï¼š</strong> ä½¿ç”¨ <code>&lt;meta&gt;</code> æ ‡ç­¾æ¥è®¾ç½® <code>X-Frame-Options</code> æ˜¯æ— æ•ˆçš„ï¼ä¾‹å¦‚ <code>&lt;meta http-equiv=&quot;X-Frame-Options&quot; content=&quot;deny&quot;&gt;</code> æ²¡æœ‰ä»»ä½•æ•ˆæœã€‚ä¸è¦è¿™æ ·ç”¨ï¼åªæœ‰å½“åƒä¸‹é¢ç¤ºä¾‹é‚£æ ·è®¾ç½® HTTP å¤´ <code>X-Frame-Options </code>æ‰ä¼šç”Ÿæ•ˆã€‚</p>          </div><h2 id="CSP-frame-ancestors"><a href="#CSP-frame-ancestors" class="headerlink" title="CSP: frame-ancestors"></a>CSP: frame-ancestors</h2><p>HTTP å¤´éƒ¨ <code>Content-Security-Policy</code> (CSP) æŒ‡ä»¤æŒ‡å®šäº†ä¸€ä¸ªå¯ä»¥åŒ…å«<code>&lt;frame&gt;</code>ï¼Œ<code>&lt;iframe&gt;</code>ï¼Œ<code>&lt;object&gt;</code>ï¼Œ<code>&lt;embed&gt;</code>ï¼Œor <code>&lt;applet&gt;</code>ç­‰å…ƒç´ çš„æœ‰æ•ˆçˆ¶çº§ã€‚</p><p>å½“ <code>frame-ancestors</code> è¢«è®¾ç½®æˆ <code>none</code> æ—¶ï¼Œç±»ä¼¼äº <code>X-Frame-Options: DENY</code> ã€‚</p><div class="note note-warning">            <p>è¯¥æŒ‡ä»¤ä¸æ”¯æŒé€šè¿‡ <code>&lt;meta&gt;</code> å…ƒç´ æˆ–é€šè¿‡ <code>Content-Security-policy-Report-Only</code> å¤´åŸŸæ‰€æŒ‡å®šã€‚</p>          </div><p><code>frame-ancestors</code> ç­–ç•¥å¯ä»¥è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªæº <code>&lt;source&gt;</code>ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">Content-Security-Policy: frame-ancestors &lt;source&gt;;<br>Content-Security-Policy: frame-ancestors &lt;source&gt; &lt;source&gt;;<br></code></pre></td></tr></table></figure><source> å¯ä»¥æ˜¯å¦‚ä¸‹å†…å®¹ï¼š<p><code>&lt;host-source&gt;</code></p><blockquote><p>ä¸€ä¸ª Internet ä¸»æœºçš„åç§°æˆ– IP åœ°å€ï¼Œä»¥åŠä¸€ä¸ªå¯é€‰çš„URL schemeå’Œï¼æˆ–ç«¯å£å·ã€‚è¿™äº›ç«™ç‚¹çš„åœ°å€å¯ä»¥åŒ…å«ä¸€ä¸ªå¯é€‰çš„å¼•å¯¼é€šé…ç¬¦ï¼ˆæ˜Ÿå·ï¼Œ â€˜*â€˜ï¼‰ï¼Œæˆ–è€…ä½ å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼ˆåŒæ ·è¿˜æ˜¯ï¼Œ â€˜*â€˜ï¼‰ä½œä¸ºç«¯å£åœ°å€ï¼Œä»¥ç¤ºè¿™ä¸ªæºçš„æ‰€æœ‰åˆæ³•ç«¯å£åœ°å€éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚<br>ä¾‹å­ï¼š</p></blockquote><ul><li>http:&#x2F;&#x2F;*.example.com: åŒ¹é…æ‰€æœ‰ä½¿ç”¨ http:URL scheme å¹¶æ¥å¯¹äº example.com åŠå…¶å­åŸŸåçš„åŠ è½½æ„å›¾ã€‚</li><li>mail.example.com:443: åŒ¹é…æ‰€æœ‰å¯¹äº mail.example.com åœ¨ 443 ç«¯å£çš„è®¿é—®æ„å›¾ã€‚</li><li><a href="https://store.example.com/">https://store.example.com</a>: åŒ¹é…æ‰€æœ‰ä½¿ç”¨ https:è®¿é—® store.example.com çš„æ„å›¾ã€‚</li></ul><p><code>&lt;scheme-source&gt;</code></p><blockquote><p>ä¸€ä¸ª schema é…ç½®ï¼Œæ¯”å¦‚â€™http:â€™æˆ–â€™https:â€™ã€‚æ³¨æ„ï¼Œå†’å·æ˜¯å¿…è¦çš„ã€‚ä½ åŒæ ·ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ª data schemaï¼ˆä½†å¹¶ä¸æ¨èï¼‰ã€‚</p></blockquote><ul><li><code>&#39;data:&#39;</code> å…è®¸ data: URIs ä½œä¸ºå†…å®¹æºã€‚ è¿™æ˜¯ä¸å®‰å…¨çš„ï¼Œæ”»å‡»è€…å¯ä»¥ç”¨æ­¤æ¥æ³¨å…¥æ¶æ„ä»£ç ã€‚è¯·è°¨æ…ä½¿ç”¨ï¼Œå¹¶ä¸è¦ä»¤å…¶ä½œç”¨äºè„šæœ¬ã€‚</li><li><code>&#39;mediastream:&#39;</code> å…è®¸ mediastream: URIs ä½œä¸ºå†…å®¹æºã€‚</li><li><code>&#39;blob:&#39;</code> å…è®¸ blob: URIs ä½œä¸ºå†…å®¹æºã€‚</li><li><code>&#39;filesystem:&#39;</code> å…è®¸ filesystem: URIs ä½œä¸ºå†…å®¹æºã€‚</li></ul><p><code>&#39;self&#39;</code></p><blockquote><p>æŒ‡å‘ä¸€ä¸ªè¯¥å—ä¿æŠ¤æ–‡æ¡£æ‰€åœ¨çš„æºï¼ŒåŒ…å«åŒæ ·çš„ URL schema å’Œç«¯å£å·ã€‚å¿…é¡»ç”¨å•å¼•å·è®¾ç½®ã€‚æœ‰äº›æµè§ˆå™¨ä¼šä»æºæŒ‡ä»¤ä¸­æ’é™¤ blobå’Œfilesystemã€‚éœ€è¦å…è®¸è¿™äº›å†…å®¹ç±»å‹çš„ç«™ç‚¹å¯ä»¥é€šè¿‡ Data å±æ€§æŒ‡å®šå®ƒä»¬ã€‚</p></blockquote><p><code>&#39;none&#39;</code></p><blockquote><p>æŒ‡å‘ä¸€ä¸ªç©ºé›†ï¼Œæ„å‘³ç€æ²¡æœ‰ URL ä¼šè¢«åŒ¹é…ã€‚ä¹Ÿéœ€è¦å•å¼•å·åŒ…è£¹è®¾ç½®ã€‚</p></blockquote><div class="note note-success">            <p>ä¸€èˆ¬æ¥è¯´ï¼Œå»ºè®®å°† <code>X-Frame-Options: &lt;value&gt;</code> ä¸ <code>Content-Security-Policy: frame-ancestors &lt;source&gt;</code> è”åˆä½¿ç”¨ã€‚å› ä¸º <code>X-Frame-Options</code> æ˜¯ä¸€ç§éæ ‡å‡†çš„å†™æ³•ï¼ˆå½“ç„¶ï¼Œæµè§ˆå™¨ä¹Ÿæ”¯æŒè¿™ç§å†™æ³•ï¼‰ã€‚ä½†æ˜¯ç›¸å¯¹CSPæ ‡å‡†è€Œè¨€ï¼Œåœ¨IEæµè§ˆå™¨ä¸‹ä¸æ”¯æŒ <code>frame-ancestors</code>ï¼Œä»…æ”¯æŒ <code>X-Frame-Options</code>ã€‚ç›¸å¯¹äºChromeä¸FireFoxæ¥è®²ï¼Œè‹¥ä¸¤è€…å‡å­˜åœ¨ï¼Œä¼šä¼˜å…ˆè¯»å– <code>frame-ancestors</code>çš„å€¼ã€‚æ‰€ä»¥å°†äºŒè€…åŒæ—¶ä½¿ç”¨æ˜¯ä¸€ä¸ªæ›´å¥½çš„æ“ä½œã€‚</p>          </div><h2 id="JSä»£ç åˆ¤æ–­"><a href="#JSä»£ç åˆ¤æ–­" class="headerlink" title="JSä»£ç åˆ¤æ–­"></a>JSä»£ç åˆ¤æ–­</h2><div class="note note-warning">            <p>å½“ç„¶ï¼ŒJSä»£ç ä¹Ÿå¯ä»¥åˆ¤æ–­å½“å‰é¡µé¢æ˜¯å¦è¢«å¦ä¸€é¡µé¢è¿›è¡ŒiframeåµŒå¥—ã€‚ä½†æ˜¯é€šå¸¸æƒ…å†µä¸‹ï¼Œå¹¶ä¸èµæˆé€šè¿‡JSä»£ç æ¥è¿›è¡Œåˆ¤æ–­ã€‚</p>          </div><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">top</span> !== <span class="hljs-variable language_">window</span>.<span class="hljs-property">self</span>)&#123;<br>    <span class="hljs-comment">// todo next</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Frame-Options">X-Frame-Options - HTTP | MDN</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors">CSP: frame-ancestors - HTTP | MDN</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯æŠ€æœ¯</category>
      
      <category>WEBå®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>WEBå®‰å…¨</tag>
      
      <tag>CSP</tag>
      
      <tag>X-Frame-Options</tag>
      
      <tag>frame-ancestors</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nodeä¸æµè§ˆå™¨ä¸­EventLoopæœ‰ä»€ä¹ˆåŒºåˆ«</title>
    <link href="/2022/07/04/4-js-event-loop/"/>
    <url>/2022/07/04/4-js-event-loop/</url>
    
    <content type="html"><![CDATA[<h2 id="æµè§ˆå™¨ä¸­çš„EventLoop"><a href="#æµè§ˆå™¨ä¸­çš„EventLoop" class="headerlink" title="æµè§ˆå™¨ä¸­çš„EventLoop"></a>æµè§ˆå™¨ä¸­çš„EventLoop</h2><blockquote><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ <code>JS</code> æ˜¯å•çº¿ç¨‹è¿è¡Œçš„ï¼Œåœ¨ä»£ç æ‰§è¡Œæ—¶ï¼Œé€šè¿‡å°†ä¸åŒå‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å‹å…¥æ‰§è¡Œæ ˆä¸­æ¥ä¿è¯ä»£ç çš„æœ‰åºæ‰§è¡Œã€‚åœ¨æ‰§è¡Œ <code>åŒæ­¥ä»£ç </code> æ—¶ï¼Œå¦‚æœé‡åˆ° <code>å¼‚æ­¥äº‹ä»¶</code>ï¼Œ<code>JS</code> å¼•æ“å¹¶ä¸ä¼šä¸€ç›´ç­‰å¾…å…¶è¿”å›ç»“æœï¼Œè€Œæ˜¯ä¼šå°†è¿™ä¸ªäº‹ä»¶æŒ‚èµ·ï¼Œç»§ç»­æ‰§è¡Œæ‰§è¡Œæ ˆä¸­çš„å…¶ä»–ä»»åŠ¡ã€‚å½“ <code>å¼‚æ­¥äº‹ä»¶</code> æ‰§è¡Œå®Œæ¯•åï¼Œå†å°† <code>å¼‚æ­¥äº‹ä»¶</code> å¯¹åº”çš„å›è°ƒåŠ å…¥åˆ°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œã€‚è¯¥å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—å¯ä»¥åˆ†ä¸º <code>å®ä»»åŠ¡é˜Ÿåˆ—</code> å’Œ <code>å¾®ä»»åŠ¡é˜Ÿåˆ—</code> ï¼Œå½“å½“å‰æ‰§è¡Œæ ˆä¸­çš„äº‹ä»¶æ‰§è¡Œå®Œæ¯•åï¼Œ<code>JS</code> å¼•æ“é¦–å…ˆä¼šåˆ¤æ–­<code>å¾®ä»»åŠ¡é˜Ÿåˆ—</code>ä¸­æ˜¯å¦æœ‰ä»»åŠ¡å¯ä»¥æ‰§è¡Œï¼Œå¦‚æœæœ‰å°±å°†<code>å¾®ä»»åŠ¡é˜Ÿé¦–</code>çš„äº‹ä»¶å‹å…¥æ ˆä¸­æ‰§è¡Œã€‚å½“<code>å¾®ä»»åŠ¡é˜Ÿåˆ—</code>ä¸­çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆåå†å»æ‰§è¡Œ<code>å®ä»»åŠ¡é˜Ÿåˆ—</code>ä¸­çš„ä»»åŠ¡ã€‚</p></blockquote><p><img src="https://image.origin-tec.com/img/62fb0ea6cfeaef749c59f6626a69f9c5@1053x424.png" alt="EventLoop"></p><p><strong>Event Loop æ‰§è¡Œé¡ºåºå¦‚ä¸‹æ‰€ç¤ºï¼š</strong></p><ul><li>æ•´ä½“scriptä»£ç è¿›å…¥æ‰§è¡Œæ ˆæ‰§è¡Œï¼Œä¾æ¬¡æ‰§è¡Œæ‰€æœ‰åŒæ­¥ä»£ç ã€‚</li><li>ç„¶åå¼€å§‹æ‰§è¡Œå¼‚æ­¥ä»£ç ï¼Œå°†é‡åˆ°çš„å¼‚æ­¥ä»£ç åˆ†ä¸º<strong>å®ä»»åŠ¡</strong>(macro-task)ã€<strong>å¾®ä»»åŠ¡</strong>(micro-stak)ï¼Œå„è‡ªäº§ç”Ÿçš„å›è°ƒåˆ†åˆ«æ”¾å…¥å„è‡ªçš„é˜Ÿåˆ—ï¼ˆå®ä»»åŠ¡é˜Ÿåˆ—å¾®ä»»åŠ¡é˜Ÿåˆ—æ˜¯ä¸åŒçš„é˜Ÿåˆ—ï¼‰ã€‚</li><li>æ­¤æ—¶ç­‰å¾…ä¸»çº¿æ‰§è¡Œæ ˆæ‰§è¡ŒåŒæ­¥ä»£ç ç»“æŸåï¼Œå¼€å§‹ä¾æ¬¡æ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ä»£ç ç›´åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œå†æ‰§è¡Œå®ä»»åŠ¡é˜Ÿåˆ—ä¸­ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼Œä¾æ¬¡å¾ªç¯ã€‚</li></ul><p class="note note-warning">æ³¨æ„ï¼šå®ä»»åŠ¡ã€å¾®ä»»åŠ¡ä¸­åˆå¯èƒ½åŒ…æ‹¬å®ã€å¾®ä»»åŠ¡ï¼Œä»ç„¶æŒ‰ç…§ä»¥ä¸Šè§„åˆ™å¤„ç†ï¼Œé¡ºåºä¸èƒ½ä¹±ã€‚</p><h3 id="å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡"><a href="#å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡" class="headerlink" title="å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡"></a>å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡</h3><h4 id="å®ä»»åŠ¡"><a href="#å®ä»»åŠ¡" class="headerlink" title="å®ä»»åŠ¡"></a>å®ä»»åŠ¡</h4><table><thead><tr><th>#</th><th align="center">æµè§ˆå™¨</th><th align="center">Node</th></tr></thead><tbody><tr><td>I&#x2F;O</td><td align="center">âœ…</td><td align="center">âœ…</td></tr><tr><td>setTimeout</td><td align="center">âœ…</td><td align="center">âœ…</td></tr><tr><td>setInterval</td><td align="center">âœ…</td><td align="center">âœ…</td></tr><tr><td>setImmediate</td><td align="center">âŒ</td><td align="center">âœ…</td></tr><tr><td>requestAnimationFrame</td><td align="center">âœ…</td><td align="center">âŒ</td></tr></tbody></table><h4 id="å¾®ä»»åŠ¡"><a href="#å¾®ä»»åŠ¡" class="headerlink" title="å¾®ä»»åŠ¡"></a>å¾®ä»»åŠ¡</h4><table><thead><tr><th>#</th><th align="center">æµè§ˆå™¨</th><th align="center">Node</th></tr></thead><tbody><tr><td>process.nextTick</td><td align="center">âŒ</td><td align="center">âœ…</td></tr><tr><td>MutationObserver</td><td align="center">âœ…</td><td align="center">âŒ</td></tr><tr><td>Promise.then catch finally</td><td align="center">âœ…</td><td align="center">âœ…</td></tr></tbody></table><h3 id="async-x2F-await"><a href="#async-x2F-await" class="headerlink" title="async&#x2F;await"></a>async&#x2F;await</h3><h4 id="async"><a href="#async" class="headerlink" title="async"></a>async</h4><p>å½“æˆ‘ä»¬åœ¨å‡½æ•°å‰ä½¿ç”¨ <code>async</code> çš„æ—¶å€™ï¼Œä½¿å¾—è¯¥å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª <code>Promise</code> å¯¹è±¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>   <span class="hljs-comment">// asyncçš„å‡½æ•°ä¼šåœ¨è¿™é‡Œå¸®æˆ‘ä»¬éšå¼ä½¿ç”¨Promise.resolve(1)</span><br>&#125;<br><span class="hljs-comment">// ç­‰ä»·äºä¸‹é¢çš„ä»£ç </span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>) &#123;<br>   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) &#123;<br>       <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>)<br>   &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯è§ <code>async</code> åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œåªæ˜¯å¸®åŠ©æˆ‘ä»¬è¿”å›ä¸€ä¸ª <code>Promise</code> è€Œå·²</p><h4 id="await"><a href="#await" class="headerlink" title="await"></a>await</h4><p><code>await</code> è¡¨ç¤ºç­‰å¾…ï¼Œæ˜¯å³ä¾§ã€Œè¡¨è¾¾å¼ã€çš„ç»“æœï¼Œè¿™ä¸ªè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœå¯ä»¥æ˜¯ <code>Promise</code> å¯¹è±¡çš„å€¼æˆ–è€…ä¸€ä¸ªå‡½æ•°çš„å€¼ï¼ˆæ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ²¡æœ‰ç‰¹æ®Šé™å®šï¼‰ã€‚å¹¶ä¸”åªèƒ½åœ¨å¸¦æœ‰ <code>async</code> çš„å†…éƒ¨ä½¿ç”¨</p><p>ä½¿ç”¨ <code>await</code> æ—¶ï¼Œä¼šä»å³å¾€å·¦æ‰§è¡Œï¼Œå½“é‡åˆ° <code>await</code> æ—¶ï¼Œä¼šé˜»å¡å‡½æ•°å†…éƒ¨å¤„äºå®ƒåé¢çš„ä»£ç ï¼Œå»æ‰§è¡Œè¯¥å‡½æ•°å¤–éƒ¨çš„åŒæ­¥ä»£ç ï¼Œå½“å¤–éƒ¨åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå†å›åˆ°è¯¥å‡½æ•°å†…éƒ¨æ‰§è¡Œå‰©ä½™çš„ä»£ç , å¹¶ä¸”å½“ <code>await</code> æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œ<strong>ä¼šå…ˆå¤„ç†å¾®ä»»åŠ¡é˜Ÿåˆ—çš„ä»£ç </strong>ã€‚</p><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸ªæ —å­:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">async1</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;async1 start&#x27;</span>)<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">async2</span>()<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;async1 end&#x27;</span>)<br>&#125;<br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">async2</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;async2&#x27;</span>)<br>&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;script start&#x27;</span>)<br><span class="hljs-built_in">setTimeout</span>( <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;setTimeout&#x27;</span>)<br>&#125;, <span class="hljs-number">0</span> )<br><span class="hljs-title function_">async1</span>();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>( <span class="hljs-keyword">function</span> (<span class="hljs-params"> resolve </span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;promise1&#x27;</span>)<br>    <span class="hljs-title function_">resolve</span>();<br>&#125; ).<span class="hljs-title function_">then</span>( <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;promise2&#x27;</span>)<br>&#125; )<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;script end&#x27;</span>)<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨äº‹ä»¶å¾ªç¯æœºåˆ¶åˆ†æ:</strong></p><ul><li>é¦–å…ˆæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œæ‰§è¡Œ<code>console.log(&#39;script start&#39;)</code></li><li>é‡åˆ° <code>setTimeout</code> ï¼Œä¼šè¢«æ¨å…¥å®ä»»åŠ¡é˜Ÿåˆ—</li><li>æ‰§è¡Œ <code>async1()</code>ï¼Œ å®ƒä¹Ÿæ˜¯åŒæ­¥çš„ï¼Œåªæ˜¯è¿”å›å€¼æ˜¯<code>Promise</code>ï¼Œåœ¨å†…éƒ¨é¦–å…ˆæ‰§è¡Œ<code>console.log(&#39;async1 start&#39;)</code></li><li>ç„¶åæ‰§è¡Œ<code>async2()</code>ï¼Œ ç„¶åä¼šæ‰“å° <code>console.log(&#39;async2&#39;)</code></li><li>ä»å³åˆ°å·¦ä¼šæ‰§è¡Œï¼Œ å½“é‡åˆ°<code>await</code>çš„æ—¶å€™ï¼Œé˜»å¡åé¢çš„ä»£ç ï¼Œä¼šå°†<code>console.log(&#39;async1 end&#39;)</code>æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç„¶åå»å¤–éƒ¨æ‰§è¡ŒåŒæ­¥ä»£ç </li><li>è¿›å…¥ <code>new Promise</code>ï¼Œæ‰“å° <code>console.log(&#39;promise1&#39;)</code></li><li>å°†<code>.then</code>æ”¾å…¥äº‹ä»¶å¾ªç¯çš„å¾®ä»»åŠ¡é˜Ÿåˆ—</li><li>ç»§ç»­æ‰§è¡Œï¼Œæ‰“å°<code>console.log(&#39;script end&#39;)</code></li><li>å¤–éƒ¨åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œæ¥ç€å›åˆ°<code>async1()</code>å†…éƒ¨ï¼Œ ç”±äº<code>async2()</code>å…¶å®æ˜¯è¿”å›ä¸€ä¸ª<code>Promise</code>ï¼Œ <code>await - async2()</code>ç›¸å½“äºè·å–å®ƒçš„å€¼ï¼Œå…¶å®å°±ç›¸å½“äºè¿™æ®µä»£ç <code>Promise.resolve(undefined).then((undefined) =&gt; &#123;&#125;)</code>ï¼Œæ‰€ä»¥<code>.then</code>ä¼šè¢«æ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚æ¥ä¸‹æ¥å¤„ç†å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¾æ¬¡æ‰“å°<code>async1 end</code>å’Œ<code>promise2</code>ï¼Œåé¢ä¸€ä¸ª<code>.then</code>ä¸ä¼šæœ‰ä»»ä½•æ‰“å°ï¼Œä½†æ˜¯ä¼šæ‰§è¡Œ</li><li>è¿›å…¥ç¬¬äºŒæ¬¡äº‹ä»¶å¾ªç¯ï¼Œæ‰§è¡Œå®ä»»åŠ¡é˜Ÿåˆ—ï¼Œ æ‰“å°<code>console.log(&#39;setTimeout&#39;)</code></li></ul><p>æµè§ˆå™¨ä¸­çš„æ‰§è¡Œç»“æœï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">script start<br>async1 start<br>async2<br>promise1<br>script end<br>async1 end<br>promise2<br>undefined<br>setTimeout<br></code></pre></td></tr></table></figure><h2 id="Node-ä¸­çš„-EventLoop"><a href="#Node-ä¸­çš„-EventLoop" class="headerlink" title="Node ä¸­çš„ EventLoop"></a>Node ä¸­çš„ EventLoop</h2><blockquote><p><code>Node</code> ä¸­çš„ EventLoop å’Œæµè§ˆå™¨ä¸­çš„æ˜¯å®Œå…¨ä¸ç›¸åŒçš„ä¸œè¥¿ã€‚<br><code>Node</code> çš„ EventLoop åˆ†ä¸º <strong>6</strong> ä¸ªé˜¶æ®µï¼Œå®ƒä»¬ä¼šæŒ‰ç…§é¡ºåºåå¤è¿è¡Œã€‚æ¯å½“è¿›å…¥æŸä¸€ä¸ªé˜¶æ®µçš„æ—¶å€™ï¼Œéƒ½ä¼šä»å¯¹åº”çš„å›è°ƒé˜Ÿåˆ—ä¸­å–å‡ºå‡½æ•°å»æ‰§è¡Œã€‚å½“é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…æ‰§è¡Œçš„å›è°ƒå‡½æ•°æ•°é‡åˆ°è¾¾ç³»ç»Ÿè®¾å®šçš„é˜ˆå€¼ï¼Œå°±ä¼šè¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚</p></blockquote><ol><li><strong>Timersï¼ˆè®¡æ—¶å™¨é˜¶æ®µï¼‰</strong>ï¼šåˆæ¬¡è¿›å…¥äº‹ä»¶å¾ªç¯ï¼Œä¼šä»è®¡æ—¶å™¨é˜¶æ®µå¼€å§‹ã€‚æ­¤é˜¶æ®µä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿‡æœŸçš„è®¡æ—¶å™¨å›è°ƒï¼ˆåŒ…å« <code>setTimeout</code> å’Œ <code>setInterval</code> ï¼‰ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¼šæ‰§è¡Œæ‰€æœ‰è¿‡æœŸçš„è®¡æ—¶å™¨å›è°ƒï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœå›è°ƒä¸­è§¦å‘äº†ç›¸åº”çš„å¾®ä»»åŠ¡ï¼Œä¼šæ¥ç€æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œå¾®ä»»åŠ¡åå†è¿›å…¥ Pending callbacks é˜¶æ®µã€‚</li><li><strong>Pending callbacks</strong>ï¼šæ‰§è¡Œæ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ªå¾ªç¯è¿­ä»£çš„I &#x2F; Oå›è°ƒï¼ˆç³»ç»Ÿè°ƒç”¨ç›¸å…³çš„å›è°ƒï¼‰ã€‚</li><li><strong>Idle&#x2F;Prepare</strong>ï¼šä»…ä¾›å†…éƒ¨ä½¿ç”¨ã€‚</li><li><strong>Pollï¼ˆè½®è¯¢é˜¶æ®µï¼‰</strong>ï¼š<ul><li>å½“å›è°ƒé˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶ï¼šä¼šæ‰§è¡Œå›è°ƒï¼Œè‹¥å›è°ƒä¸­è§¦å‘äº†ç›¸åº”çš„å¾®ä»»åŠ¡ï¼Œè¿™é‡Œçš„å¾®ä»»åŠ¡æ‰§è¡Œæ—¶æœºå’Œå…¶ä»–åœ°æ–¹æœ‰æ‰€ä¸åŒï¼Œä¸ä¼šç­‰åˆ°æ‰€æœ‰å›è°ƒæ‰§è¡Œå®Œæ¯•åæ‰æ‰§è¡Œï¼Œè€Œæ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªå›è°ƒæ‰§è¡Œå®Œæ¯•åï¼Œå°±æ‰§è¡Œç›¸åº”å¾®ä»»åŠ¡ã€‚æ‰§è¡Œå®Œæ‰€æœ‰çš„å›è°ƒåï¼Œå˜ä¸ºä¸‹é¢çš„æƒ…å†µã€‚</li><li>å½“å›è°ƒé˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ˆæ²¡æœ‰å›è°ƒæˆ–æ‰€æœ‰å›è°ƒæ‰§è¡Œå®Œæ¯•ï¼‰ï¼šä½†å¦‚æœå­˜åœ¨æœ‰è®¡æ—¶å™¨ï¼ˆ <code>setTimeout</code> ã€ <code>setInterval</code> å’Œ <code>setImmediate</code> ï¼‰æ²¡æœ‰æ‰§è¡Œï¼Œä¼šç»“æŸè½®è¯¢é˜¶æ®µï¼Œè¿›å…¥ Check é˜¶æ®µã€‚å¦åˆ™ä¼šé˜»å¡å¹¶ç­‰å¾…ä»»ä½•æ­£åœ¨æ‰§è¡Œçš„I&#x2F;Oæ“ä½œå®Œæˆï¼Œå¹¶é©¬ä¸Šæ‰§è¡Œç›¸åº”çš„å›è°ƒï¼Œç›´åˆ°æ‰€æœ‰å›è°ƒæ‰§è¡Œå®Œæ¯•ã€‚</li></ul></li><li><strong>Checkï¼ˆæŸ¥è¯¢é˜¶æ®µï¼‰</strong>ï¼šä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ <code>setImmediate</code> ç›¸å…³çš„å›è°ƒï¼Œå¦‚æœå­˜åœ¨åˆ™æ‰§è¡Œæ‰€æœ‰å›è°ƒï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœå›è°ƒä¸­è§¦å‘äº†ç›¸åº”çš„å¾®ä»»åŠ¡ï¼Œä¼šæ¥ç€æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œå¾®ä»»åŠ¡åå†è¿›å…¥ Close callbacks é˜¶æ®µã€‚</li><li><strong>Close callbacks</strong>ï¼šæ‰§è¡Œä¸€äº›å…³é—­å›è°ƒï¼Œæ¯”å¦‚socket.on(â€˜closeâ€™, â€¦)ç­‰ã€‚</li></ol><h3 id="setTimeout-å’Œ-setImmediate"><a href="#setTimeout-å’Œ-setImmediate" class="headerlink" title="setTimeout å’Œ setImmediate"></a>setTimeout å’Œ setImmediate</h3><p>äºŒè€…éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«ä¸»è¦åœ¨äºè°ƒç”¨æ—¶æœºä¸åŒã€‚</p><ul><li><code>setImmediate</code> è®¾è®¡åœ¨ poll é˜¶æ®µå®Œæˆæ—¶æ‰§è¡Œï¼Œå³ check é˜¶æ®µï¼›</li><li><code>setTimeout</code> è®¾è®¡åœ¨ poll é˜¶æ®µä¸ºç©ºé—²æ—¶ï¼Œä¸”è®¾å®šæ—¶é—´åˆ°è¾¾åæ‰§è¡Œï¼Œä½†å®ƒåœ¨ timer é˜¶æ®µæ‰§è¡Œ</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;setTimeout&#x27;</span>)<br>&#125;, <span class="hljs-number">0</span>)<br><span class="hljs-title function_">setImmediate</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;setImmediate&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><p>å¯¹äºä»¥ä¸Šä»£ç æ¥è¯´ï¼Œ<code>setTimeout</code> å¯èƒ½æ‰§è¡Œåœ¨å‰ï¼Œä¹Ÿå¯èƒ½æ‰§è¡Œåœ¨å</p><ul><li>é¦–å…ˆ <code>setTimeout(fn, 0) === setTimeout(fn, 1)</code>ï¼Œè¿™æ˜¯ç”±æºç å†³å®šçš„</li><li>è¿›å…¥äº‹ä»¶å¾ªç¯ä¹Ÿæ˜¯éœ€è¦æˆæœ¬çš„ï¼Œå¦‚æœåœ¨å‡†å¤‡æ—¶å€™èŠ±è´¹äº†å¤§äº 1ms çš„æ—¶é—´ï¼Œé‚£ä¹ˆåœ¨ timer é˜¶æ®µå°±ä¼šç›´æ¥æ‰§è¡Œ <code>setTimeout</code> å›è°ƒ</li><li>é‚£ä¹ˆå¦‚æœå‡†å¤‡æ—¶é—´èŠ±è´¹å°äº 1msï¼Œé‚£ä¹ˆå°±æ˜¯ <code>setImmediate</code> å›è°ƒå…ˆæ‰§è¡Œäº†</li></ul><p>å½“ç„¶åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä»–ä»¬çš„æ‰§è¡Œé¡ºåºä¸€å®šæ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br>fs.<span class="hljs-title function_">readFile</span>(__filename, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;timeout&#x27;</span>);<br>    &#125;, <span class="hljs-number">0</span>)<br>    <span class="hljs-title function_">setImmediate</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;immediate&#x27;</span>)<br>    &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>setImmediate</code> æ°¸è¿œå…ˆæ‰§è¡Œã€‚å› ä¸ºä¸¤ä¸ªä»£ç å†™åœ¨ IO å›è°ƒä¸­ï¼ŒIO å›è°ƒæ˜¯åœ¨ poll é˜¶æ®µæ‰§è¡Œï¼Œå½“å›è°ƒæ‰§è¡Œå®Œæ¯•åé˜Ÿåˆ—ä¸ºç©ºï¼Œå‘ç°å­˜åœ¨ <code>setImmediate</code> å›è°ƒï¼Œæ‰€ä»¥å°±ç›´æ¥è·³è½¬åˆ° check é˜¶æ®µå»æ‰§è¡Œå›è°ƒäº†ã€‚</p><p>ä¸Šé¢éƒ½æ˜¯ å®ä»»åŠ¡ çš„æ‰§è¡Œæƒ…å†µï¼Œå¯¹äº å¾®ä»»åŠ¡ æ¥è¯´ï¼Œå®ƒä¼šåœ¨ä»¥ä¸Šæ¯ä¸ªé˜¶æ®µå®Œæˆå‰ <strong>æ¸…ç©º</strong> å¾®ä»»åŠ¡ é˜Ÿåˆ—ï¼Œä¸‹å›¾ä¸­çš„ Tick å°±ä»£è¡¨äº† å¾®ä»»åŠ¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;timer&#x27;</span>)<br>&#125;, <span class="hljs-number">0</span>)<br><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;promise&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><p>å¯¹äºä»¥ä¸Šä»£ç æ¥è¯´ï¼Œå…¶å®å’Œæµè§ˆå™¨ä¸­çš„è¾“å‡ºæ˜¯ä¸€æ ·çš„ï¼Œå¾®ä»»åŠ¡microtask æ°¸è¿œæ‰§è¡Œåœ¨ å®ä»»åŠ¡macrotask å‰é¢ã€‚</p><h3 id="process-nextTick"><a href="#process-nextTick" class="headerlink" title="process.nextTick"></a>process.nextTick</h3><p>æœ€åæ¥çœ‹ Node ä¸­çš„ <code>process.nextTick</code>ï¼Œè¿™ä¸ªå‡½æ•°å…¶å®æ˜¯ç‹¬ç«‹äº EventLoop ä¹‹å¤–çš„ï¼Œå®ƒæœ‰ä¸€ä¸ªè‡ªå·±çš„é˜Ÿåˆ—ï¼Œå½“æ¯ä¸ªé˜¶æ®µå®Œæˆåï¼Œå¦‚æœå­˜åœ¨ nextTick é˜Ÿåˆ—ï¼Œå°±ä¼šæ¸…ç©ºé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”ä¼˜å…ˆäºå…¶ä»– å¾®ä»»åŠ¡microtask æ‰§è¡Œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;timer1&#x27;</span>)<br> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;promise1&#x27;</span>)<br> &#125;)<br>&#125;, <span class="hljs-number">0</span>)<br>process.<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;nextTick&#x27;</span>)<br> process.<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;nextTick&#x27;</span>)<br>   process.<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;nextTick&#x27;</span>)<br>     process.<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;nextTick&#x27;</span>)<br>     &#125;)<br>   &#125;)<br> &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><p>å¯¹äºä»¥ä¸Šä»£ç ï¼Œæ°¸è¿œéƒ½æ˜¯å…ˆæŠŠ nextTick å…¨éƒ¨æ‰“å°å‡ºæ¥ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.yuque.com/cuggz/interview/browser">å‰ç«¯é¢è¯•é¢˜ä¹‹æµè§ˆå™¨åŸç†ç¯‡ - è¯­é›€</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://www.wangt.cc/2021/09/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E3%80%81%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5%E3%80%81%E5%AE%8F%E4%BB%BB%E5%8A%A1%E5%BE%AE%E4%BB%BB%E5%8A%A1/">äº‹ä»¶å¾ªç¯ã€åŒæ­¥å¼‚æ­¥ã€å®ä»»åŠ¡å¾®ä»»åŠ¡ - ç¨‹åºå‘˜ç¯å¡”</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://segmentfault.com/a/1190000017554062">jsäº‹ä»¶å¾ªç¯æœºåˆ¶ï¼ˆæµè§ˆå™¨ç«¯Event Loop) ä»¥åŠasync&#x2F;awaitçš„ç†è§£ - æ€å¦</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Node</tag>
      
      <tag>æµè§ˆå™¨</tag>
      
      <tag>EventLoop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµè§ˆå™¨æ¸²æŸ“é¡µé¢çš„åŸç†</title>
    <link href="/2022/07/04/3-how-browser-render/"/>
    <url>/2022/07/04/3-how-browser-render/</url>
    
    <content type="html"><![CDATA[<h2 id="1-æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹"><a href="#1-æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹" class="headerlink" title="1. æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹"></a>1. æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹</h2><p>æµè§ˆå™¨æ¸²æŸ“ä¸»è¦æœ‰ä»¥ä¸‹æ­¥éª¤ï¼š</p><ul><li>é¦–å…ˆè§£ææ”¶åˆ°çš„æ–‡æ¡£ï¼Œæ ¹æ®æ–‡æ¡£å®šä¹‰æ„å»ºä¸€æ£µ <code>DOM</code> (Document Object Model) æ ‘ï¼Œ<code>DOM</code> æ ‘æ˜¯ç”± <code>DOM</code> å…ƒç´ åŠå±æ€§èŠ‚ç‚¹ç»„æˆçš„ã€‚</li><li>ç„¶åå¯¹ <code>CSS</code> è¿›è¡Œè§£æï¼Œç”Ÿæˆ <code>CSSOM</code> (CSS Object Model) è§„åˆ™æ ‘ã€‚</li><li>æ ¹æ® <code>DOM</code> æ ‘å’Œ <code>CSSOM</code> è§„åˆ™æ ‘æ„å»ºæ¸²æŸ“æ ‘ã€‚æ¸²æŸ“æ ‘çš„èŠ‚ç‚¹è¢«ç§°ä¸ºæ¸²æŸ“å¯¹è±¡ï¼Œæ¸²æŸ“å¯¹è±¡æ˜¯ä¸€ä¸ªåŒ…å«æœ‰é¢œè‰²å’Œå¤§å°ç­‰å±æ€§çš„çŸ©å½¢ï¼Œæ¸²æŸ“å¯¹è±¡å’Œ <code>DOM</code> å…ƒç´ ç›¸å¯¹åº”ï¼Œä½†è¿™ç§å¯¹åº”å…³ç³»ä¸æ˜¯ä¸€å¯¹ä¸€çš„ï¼Œä¸å¯è§çš„ <code>DOM</code> å…ƒç´ ä¸ä¼šè¢«æ’å…¥æ¸²æŸ“æ ‘ã€‚è¿˜æœ‰ä¸€äº› <code>DOM</code> å…ƒç´ å¯¹åº”å‡ ä¸ªå¯è§å¯¹è±¡ï¼Œå®ƒä»¬ä¸€èˆ¬æ˜¯ä¸€äº›å…·æœ‰å¤æ‚ç»“æ„çš„å…ƒç´ ï¼Œæ— æ³•ç”¨ä¸€ä¸ªçŸ©å½¢æ¥æè¿°ã€‚</li><li>å½“æ¸²æŸ“å¯¹è±¡è¢«åˆ›å»ºå¹¶æ·»åŠ åˆ°æ ‘ä¸­ï¼Œå®ƒä»¬å¹¶æ²¡æœ‰ä½ç½®å’Œå¤§å°ï¼Œæ‰€ä»¥å½“æµè§ˆå™¨ç”Ÿæˆæ¸²æŸ“æ ‘ä»¥åï¼Œå°±ä¼šæ ¹æ®æ¸²æŸ“æ ‘æ¥è¿›è¡Œå¸ƒå±€ï¼ˆä¹Ÿå¯ä»¥å«åš <code>å›æµ</code> ï¼‰ã€‚è¿™ä¸€é˜¶æ®µæµè§ˆå™¨è¦åšçš„äº‹æƒ…æ˜¯è¦å¼„æ¸…æ¥šå„ä¸ªèŠ‚ç‚¹åœ¨é¡µé¢ä¸­çš„ç¡®åˆ‡ä½ç½®å’Œå¤§å°ã€‚é€šå¸¸è¿™ä¸€è¡Œä¸ºä¹Ÿè¢«ç§°ä¸ºâ€œè‡ªåŠ¨é‡æ’â€ï¼ˆåˆç§°ä½œ <code>é‡ç»˜</code> ï¼‰ã€‚</li><li>å¸ƒå±€é˜¶æ®µç»“æŸåæ˜¯ç»˜åˆ¶é˜¶æ®µï¼Œéå†æ¸²æŸ“æ ‘å¹¶è°ƒç”¨æ¸²æŸ“å¯¹è±¡çš„ paint æ–¹æ³•å°†å®ƒä»¬çš„å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œç»˜åˆ¶ä½¿ç”¨ UI åŸºç¡€ç»„ä»¶ã€‚</li></ul><h3 id="å›æµ"><a href="#å›æµ" class="headerlink" title="å›æµ"></a>å›æµ</h3><blockquote><p>å½“æ¸²æŸ“æ ‘ä¸­éƒ¨åˆ†æˆ–è€…å…¨éƒ¨å…ƒç´ çš„<strong>å°ºå¯¸</strong>ã€<strong>ç»“æ„</strong>æˆ–è€…<strong>å±æ€§</strong>å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæµè§ˆå™¨ä¼šé‡æ–°æ¸²æŸ“éƒ¨åˆ†æˆ–è€…å…¨éƒ¨æ–‡æ¡£çš„è¿‡ç¨‹å°±ç§°ä¸º<strong>å›æµ</strong>ã€‚</p></blockquote><p>ä¸‹é¢è¿™äº›æ“ä½œä¼šå¯¼è‡´å›æµï¼š</p><ul><li>é¡µé¢çš„é¦–æ¬¡æ¸²æŸ“</li><li>æµè§ˆå™¨çš„çª—å£å¤§å°å‘ç”Ÿå˜åŒ–</li><li>å…ƒç´ çš„å†…å®¹å‘ç”Ÿå˜åŒ–</li><li>å…ƒç´ çš„å°ºå¯¸æˆ–è€…ä½ç½®å‘ç”Ÿå˜åŒ–</li><li>å…ƒç´ çš„å­—ä½“å¤§å°å‘ç”Ÿå˜åŒ–</li><li>æ¿€æ´» <code>CSS</code> ä¼ªç±»</li><li>æŸ¥è¯¢æŸäº›å±æ€§æˆ–è€…è°ƒç”¨æŸäº›æ–¹æ³•</li><li>æ·»åŠ æˆ–è€…åˆ é™¤å¯è§çš„ <code>DOM</code> å…ƒç´ </li></ul><p>åœ¨è§¦å‘å›æµï¼ˆé‡æ’ï¼‰çš„æ—¶å€™ï¼Œç”±äºæµè§ˆå™¨æ¸²æŸ“é¡µé¢æ˜¯åŸºäºæµå¼å¸ƒå±€çš„ï¼Œæ‰€ä»¥å½“è§¦å‘å›æµæ—¶ï¼Œä¼šå¯¼è‡´å‘¨å›´çš„ <code>DOM</code> å…ƒç´ é‡æ–°æ’åˆ—ï¼Œå®ƒçš„å½±å“èŒƒå›´æœ‰ä¸¤ç§ï¼š</p><ul><li>å…¨å±€èŒƒå›´ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯¹æ•´ä¸ªæ¸²æŸ“æ ‘è¿›è¡Œé‡æ–°å¸ƒå±€</li><li>å±€éƒ¨èŒƒå›´ï¼šå¯¹æ¸²æŸ“æ ‘çš„æŸéƒ¨åˆ†æˆ–è€…ä¸€ä¸ªæ¸²æŸ“å¯¹è±¡è¿›è¡Œé‡æ–°å¸ƒå±€</li></ul><h3 id="é‡ç»˜"><a href="#é‡ç»˜" class="headerlink" title="é‡ç»˜"></a>é‡ç»˜</h3><blockquote><p>å½“é¡µé¢ä¸­æŸäº›å…ƒç´ çš„<strong>æ ·å¼å‘ç”Ÿå˜åŒ–</strong>ï¼Œä½†æ˜¯<strong>ä¸ä¼šå½±å“</strong>å…¶åœ¨<strong>æ–‡æ¡£æµ</strong>ä¸­çš„<strong>ä½ç½®</strong>æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šå¯¹å…ƒç´ è¿›è¡Œé‡æ–°ç»˜åˆ¶ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯<strong>é‡ç»˜</strong>ã€‚</p></blockquote><p>ä¸‹é¢è¿™äº›æ“ä½œä¼šå¯¼è‡´é‡ç»˜ï¼š</p><ul><li><code>color</code> ã€<code>background</code> ç›¸å…³å±æ€§ï¼š<code>background-color</code>ã€<code>background-image</code> ç­‰</li><li><code>outline</code> ç›¸å…³å±æ€§ï¼š<code>outline-color</code>ã€<code>outline-width</code> ã€<code>text-decoration</code></li><li><code>border-radius</code>ã€<code>visibility</code>ã€<code>box-shadow</code></li></ul><p class="note note-warning">æ³¨æ„ï¼š å½“è§¦å‘å›æµæ—¶ï¼Œä¸€å®šä¼šè§¦å‘é‡ç»˜ï¼Œä½†æ˜¯é‡ç»˜ä¸ä¸€å®šä¼šå¼•å‘å›æµã€‚</p><p><strong>æµè§ˆå™¨çš„æ¸²æŸ“å¤§è‡´è¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºï¼š</strong></p><p><img src="https://image.origin-tec.com/img/153b18d744b58e6556e10af9b3f5a61e@663x307.png" alt="æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹å›¾"></p><p class="note note-warning">æ³¨æ„ï¼šè¿™ä¸ªè¿‡ç¨‹æ˜¯é€æ­¥å®Œæˆçš„ï¼Œä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæ¸²æŸ“å¼•æ“å°†ä¼šå°½å¯èƒ½æ—©çš„å°†å†…å®¹å‘ˆç°åˆ°å±å¹•ä¸Šï¼Œå¹¶ä¸ä¼šç­‰åˆ°æ‰€æœ‰çš„ <b>html</b> éƒ½è§£æå®Œæˆä¹‹åå†å»æ„å»ºå’Œå¸ƒå±€ <b>render</b> æ ‘ã€‚å®ƒæ˜¯è§£æå®Œä¸€éƒ¨åˆ†å†…å®¹å°±æ˜¾ç¤ºä¸€éƒ¨åˆ†å†…å®¹ï¼ŒåŒæ—¶ï¼Œå¯èƒ½è¿˜åœ¨é€šè¿‡ç½‘ç»œä¸‹è½½å…¶ä½™å†…å®¹ã€‚</p><h2 id="2-æµè§ˆå™¨æ¸²æŸ“ä¼˜åŒ–"><a href="#2-æµè§ˆå™¨æ¸²æŸ“ä¼˜åŒ–" class="headerlink" title="2. æµè§ˆå™¨æ¸²æŸ“ä¼˜åŒ–"></a>2. æµè§ˆå™¨æ¸²æŸ“ä¼˜åŒ–</h2><h3 id="é’ˆå¯¹JavaScriptï¼š"><a href="#é’ˆå¯¹JavaScriptï¼š" class="headerlink" title="é’ˆå¯¹JavaScriptï¼š"></a>é’ˆå¯¹JavaScriptï¼š</h3><blockquote><p><code>JavaScript</code> æ—¢ä¼šé˜»å¡ <code>HTML</code> çš„è§£æï¼Œä¹Ÿä¼šé˜»å¡ <code>CSS</code> çš„è§£æã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å¯¹ <code>JavaScript</code> çš„åŠ è½½æ–¹å¼è¿›è¡Œæ”¹å˜ï¼Œæ¥è¿›è¡Œä¼˜åŒ–ï¼š</p></blockquote><p>ï¼ˆ1ï¼‰å°½é‡å°† JavaScript æ–‡ä»¶æ”¾åœ¨ <code>body</code> çš„æœ€å</p><p>ï¼ˆ2ï¼‰ <code>body</code> ä¸­é—´å°½é‡ä¸è¦å†™ <code>&lt;script&gt;</code> æ ‡ç­¾</p><p>ï¼ˆ3ï¼‰<code>&lt;script&gt;</code> æ ‡ç­¾çš„å¼•å…¥èµ„æºæ–¹å¼æœ‰ä¸‰ç§ï¼Œæœ‰ä¸€ç§å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ç›´æ¥å¼•å…¥ï¼Œè¿˜æœ‰ä¸¤ç§å°±æ˜¯ä½¿ç”¨ <code>async</code> å±æ€§å’Œ <code>defer</code> å±æ€§æ¥å¼‚æ­¥å¼•å…¥ï¼Œä¸¤è€…éƒ½æ˜¯å»å¼‚æ­¥åŠ è½½å¤–éƒ¨çš„ JS æ–‡ä»¶ï¼Œä¸ä¼šé˜»å¡ <code>DOM</code> çš„è§£æï¼ˆå°½é‡ä½¿ç”¨å¼‚æ­¥åŠ è½½ï¼‰ã€‚ä¸‰è€…çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li><code>script</code> ç«‹å³åœæ­¢é¡µé¢æ¸²æŸ“å»åŠ è½½èµ„æºæ–‡ä»¶ï¼Œå½“èµ„æºåŠ è½½å®Œæ¯•åç«‹å³æ‰§è¡Œ js ä»£ç ï¼Œjs ä»£ç æ‰§è¡Œå®Œæ¯•åç»§ç»­æ¸²æŸ“é¡µé¢ï¼›</li><li><code>async</code> æ˜¯åœ¨ä¸‹è½½å®Œæˆä¹‹åï¼Œç«‹å³å¼‚æ­¥åŠ è½½ï¼ŒåŠ è½½å¥½åç«‹å³æ‰§è¡Œï¼Œå¤šä¸ªå¸¦ <code>async</code> å±æ€§çš„æ ‡ç­¾ï¼Œä¸èƒ½ä¿è¯åŠ è½½çš„é¡ºåºï¼›</li><li><code>defer</code> æ˜¯åœ¨ä¸‹è½½å®Œæˆä¹‹åï¼Œç«‹å³å¼‚æ­¥åŠ è½½ã€‚åŠ è½½å¥½åï¼Œå¦‚æœ DOM æ ‘è¿˜æ²¡æ„å»ºå¥½ï¼Œåˆ™å…ˆç­‰ DOM æ ‘è§£æå¥½å†æ‰§è¡Œï¼›å¦‚æœ DOM æ ‘å·²ç»å‡†å¤‡å¥½ï¼Œåˆ™ç«‹å³æ‰§è¡Œã€‚å¤šä¸ªå¸¦ <code>defer</code> å±æ€§çš„æ ‡ç­¾ï¼ŒæŒ‰ç…§é¡ºåºæ‰§è¡Œã€‚</li></ul><h3 id="é’ˆå¯¹CSSï¼š"><a href="#é’ˆå¯¹CSSï¼š" class="headerlink" title="é’ˆå¯¹CSSï¼š"></a>é’ˆå¯¹CSSï¼š</h3><blockquote><p>ä½¿ç”¨ <code>CSS</code> æœ‰ä¸‰ç§æ–¹å¼ï¼šä½¿ç”¨ <code>link</code> ã€<code>@import</code>ã€<code>å†…è”æ ·å¼</code>ï¼Œå…¶ä¸­ <code>link</code> å’Œ <code>@import</code> éƒ½æ˜¯å¯¼å…¥å¤–éƒ¨æ ·å¼ã€‚å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ï¼š</p></blockquote><ul><li><code>link</code> ï¼šæµè§ˆå™¨ä¼šæ´¾å‘ä¸€ä¸ªæ–°çš„çº¿ç¨‹(HTTPçº¿ç¨‹)å»åŠ è½½èµ„æºæ–‡ä»¶ï¼Œä¸æ­¤åŒæ—¶GUIæ¸²æŸ“çº¿ç¨‹ä¼šç»§ç»­å‘ä¸‹æ¸²æŸ“ä»£ç </li><li><code>@import</code> ï¼šGUIæ¸²æŸ“çº¿ç¨‹ä¼šæš‚æ—¶åœæ­¢æ¸²æŸ“ï¼Œå»æœåŠ¡å™¨åŠ è½½èµ„æºæ–‡ä»¶ï¼Œèµ„æºæ–‡ä»¶æ²¡æœ‰è¿”å›ä¹‹å‰ä¸ä¼šç»§ç»­æ¸²æŸ“(é˜»ç¢æµè§ˆå™¨æ¸²æŸ“)</li><li><code>style</code> ï¼šGUIç›´æ¥æ¸²æŸ“</li></ul><p>å¤–éƒ¨æ ·å¼å¦‚æœé•¿æ—¶é—´æ²¡æœ‰åŠ è½½å®Œæ¯•ï¼Œæµè§ˆå™¨ä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œä¼šä½¿ç”¨æµè§ˆå™¨ä¼šé»˜è®¤æ ·å¼ï¼Œç¡®ä¿é¦–æ¬¡æ¸²æŸ“çš„é€Ÿåº¦ã€‚æ‰€ä»¥ <code>CSS</code> ä¸€èˆ¬å†™åœ¨ <code>header</code> ä¸­ï¼Œè®©æµè§ˆå™¨å°½å¿«å‘é€è¯·æ±‚å»è·å– <code>css</code> æ ·å¼ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯¼å…¥å¤–éƒ¨æ ·å¼ä½¿ç”¨ <code>link</code> ï¼Œè€Œä¸ç”¨ <code>@import</code> ã€‚å¦‚æœ <code>css</code> å°‘ï¼Œå°½å¯èƒ½é‡‡ç”¨å†…åµŒæ ·å¼ï¼Œç›´æ¥å†™åœ¨ <code>style</code> æ ‡ç­¾ä¸­ã€‚</p><h3 id="é’ˆå¯¹DOMæ ‘ã€CSSOMæ ‘ï¼š"><a href="#é’ˆå¯¹DOMæ ‘ã€CSSOMæ ‘ï¼š" class="headerlink" title="é’ˆå¯¹DOMæ ‘ã€CSSOMæ ‘ï¼š"></a>é’ˆå¯¹DOMæ ‘ã€CSSOMæ ‘ï¼š</h3><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥å‡å°‘æ¸²æŸ“çš„æ—¶é—´ï¼š</p><ul><li>HTMLæ–‡ä»¶çš„ä»£ç å±‚çº§å°½é‡ä¸è¦å¤ªæ·±</li><li>ä½¿ç”¨è¯­ä¹‰åŒ–çš„æ ‡ç­¾ï¼Œæ¥é¿å…ä¸æ ‡å‡†è¯­ä¹‰åŒ–çš„ç‰¹æ®Šå¤„ç†</li><li>å‡å°‘CSSçš„ä»£ç çš„å±‚çº§ï¼Œå› ä¸ºé€‰æ‹©å™¨æ˜¯<strong>ä»å³å¾€å·¦</strong>è¿›è¡Œè§£æçš„ï¼ˆ<a href="https://segmentfault.com/q/1010000000713509">é—®é¢˜ï¼šä¸ºä»€ä¹ˆ CSS é€‰æ‹©å™¨è§£æçš„æ—¶å€™æ˜¯ä»å³å¾€å·¦ï¼Ÿ</a>ï¼‰</li></ul><h3 id="å‡å°‘å›æµä¸é‡ç»˜ï¼š"><a href="#å‡å°‘å›æµä¸é‡ç»˜ï¼š" class="headerlink" title="å‡å°‘å›æµä¸é‡ç»˜ï¼š"></a>å‡å°‘å›æµä¸é‡ç»˜ï¼š</h3><ul><li>æ“ä½œ DOM æ—¶ï¼Œå°½é‡åœ¨ä½å±‚çº§çš„ DOM èŠ‚ç‚¹è¿›è¡Œæ“ä½œ</li><li>ä¸è¦ä½¿ç”¨ <code>table</code> å¸ƒå±€ï¼Œä¸€ä¸ªå°çš„æ”¹åŠ¨å¯èƒ½ä¼šä½¿æ•´ä¸ª <code>table</code> è¿›è¡Œé‡æ–°å¸ƒå±€</li><li>ä¸ä½¿ç”¨CSSçš„è¡¨è¾¾å¼</li><li>ä¸è¦é¢‘ç¹æ“ä½œå…ƒç´ çš„æ ·å¼ï¼Œå¯¹äºé™æ€é¡µé¢ï¼Œå¯ä»¥ä¿®æ”¹ç±»åï¼Œè€Œä¸æ˜¯æ ·å¼ã€‚</li><li>ä½¿ç”¨ <code>absolute</code> æˆ–è€… <code>fixed</code> ï¼Œä½¿å…ƒç´ è„±ç¦»æ–‡æ¡£æµï¼Œè¿™æ ·ä»–ä»¬å‘ç”Ÿå˜åŒ–å°±ä¸ä¼šå½±å“å…¶ä»–å…ƒç´ </li><li>é¿å…é¢‘ç¹æ“ä½œDOMï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–‡æ¡£ç‰‡æ®µ <code>documentFragment</code> ï¼Œåœ¨å®ƒä¸Šé¢åº”ç”¨æ‰€æœ‰DOMæ“ä½œï¼Œæœ€åå†æŠŠå®ƒæ·»åŠ åˆ°æ–‡æ¡£ä¸­</li><li>å°†å…ƒç´ å…ˆè®¾ç½® <code>display: none</code>ï¼Œæ“ä½œç»“æŸåå†æŠŠå®ƒæ˜¾ç¤ºå‡ºæ¥ã€‚å› ä¸ºåœ¨ <code>display</code> å±æ€§ä¸º <code>none</code> çš„å…ƒç´ ä¸Šè¿›è¡Œçš„ <code>DOM</code> æ“ä½œä¸ä¼šå¼•å‘å›æµå’Œé‡ç»˜ã€‚</li><li>å°†DOMçš„å¤šä¸ªè¯»æ“ä½œï¼ˆæˆ–è€…å†™æ“ä½œï¼‰æ”¾åœ¨ä¸€èµ·ï¼Œè€Œä¸æ˜¯è¯»å†™æ“ä½œç©¿æ’ç€å†™ã€‚è¿™å¾—ç›Šäºæµè§ˆå™¨çš„æ¸²æŸ“é˜Ÿåˆ—æœºåˆ¶ã€‚</li></ul><p>æµè§ˆå™¨é’ˆå¯¹é¡µé¢çš„å›æµä¸é‡ç»˜ï¼Œè¿›è¡Œäº†è‡ªèº«çš„ä¼˜åŒ–â€”â€”<strong>æ¸²æŸ“é˜Ÿåˆ—</strong></p><p>æµè§ˆå™¨ä¼šå°†æ‰€æœ‰çš„å›æµã€é‡ç»˜çš„æ“ä½œæ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå½“é˜Ÿåˆ—ä¸­çš„æ“ä½œåˆ°äº†ä¸€å®šçš„æ•°é‡æˆ–è€…åˆ°äº†ä¸€å®šçš„æ—¶é—´é—´éš”ï¼Œæµè§ˆå™¨å°±ä¼šå¯¹é˜Ÿåˆ—è¿›è¡Œæ‰¹å¤„ç†ã€‚è¿™æ ·å°±ä¼šè®©å¤šæ¬¡çš„å›æµã€é‡ç»˜å˜æˆä¸€æ¬¡å›æµé‡ç»˜ã€‚</p><p>å°†å¤šä¸ªè¯»æ“ä½œï¼ˆæˆ–è€…å†™æ“ä½œï¼‰æ”¾åœ¨ä¸€èµ·ï¼Œå°±ä¼šç­‰æ‰€æœ‰çš„è¯»æ“ä½œè¿›å…¥é˜Ÿåˆ—ä¹‹åæ‰§è¡Œï¼Œè¿™æ ·ï¼ŒåŸæœ¬åº”è¯¥æ˜¯è§¦å‘å¤šæ¬¡å›æµï¼Œå˜æˆäº†åªè§¦å‘ä¸€æ¬¡å›æµã€‚</p><h2 id="3-æ¸²æŸ“è¿‡ç¨‹ä¸­é‡åˆ°-JS-æ–‡ä»¶å¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#3-æ¸²æŸ“è¿‡ç¨‹ä¸­é‡åˆ°-JS-æ–‡ä»¶å¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="3. æ¸²æŸ“è¿‡ç¨‹ä¸­é‡åˆ° JS æ–‡ä»¶å¦‚ä½•å¤„ç†ï¼Ÿ"></a>3. æ¸²æŸ“è¿‡ç¨‹ä¸­é‡åˆ° JS æ–‡ä»¶å¦‚ä½•å¤„ç†ï¼Ÿ</h2><p>JavaScript çš„åŠ è½½ã€è§£æä¸æ‰§è¡Œä¼šé˜»å¡æ–‡æ¡£çš„è§£æï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ„å»º <code>DOM</code> æ—¶ï¼Œ <code>HTML</code> è§£æå™¨è‹¥é‡åˆ°äº† <code>JavaScript</code> ï¼Œé‚£ä¹ˆå®ƒä¼šæš‚åœæ–‡æ¡£çš„è§£æï¼Œå°†æ§åˆ¶æƒç§»äº¤ç»™ <code>JavaScript</code> å¼•æ“ï¼Œç­‰ <code>JavaScript</code> å¼•æ“è¿è¡Œå®Œæ¯•ï¼Œæµè§ˆå™¨å†ä»ä¸­æ–­çš„åœ°æ–¹æ¢å¤ç»§ç»­è§£ææ–‡æ¡£ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæƒ³è¦é¦–å±æ¸²æŸ“çš„è¶Šå¿«ï¼Œå°±è¶Šä¸åº”è¯¥åœ¨é¦–å±å°±åŠ è½½ JS æ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯éƒ½å»ºè®®å°† <code>script</code> æ ‡ç­¾æ”¾åœ¨ <code>body</code> æ ‡ç­¾åº•éƒ¨çš„åŸå› ã€‚å½“ç„¶åœ¨å½“ä¸‹ï¼Œå¹¶ä¸æ˜¯è¯´ <code>script</code> æ ‡ç­¾å¿…é¡»æ”¾åœ¨åº•éƒ¨ï¼Œå› ä¸ºä½ å¯ä»¥ç»™ <code>script</code> æ ‡ç­¾æ·»åŠ  <code>defer</code> æˆ–è€… <code>async</code> å±æ€§ã€‚</p><h2 id="4-ä»€ä¹ˆæ˜¯æ–‡æ¡£çš„é¢„è§£æï¼Ÿ"><a href="#4-ä»€ä¹ˆæ˜¯æ–‡æ¡£çš„é¢„è§£æï¼Ÿ" class="headerlink" title="4. ä»€ä¹ˆæ˜¯æ–‡æ¡£çš„é¢„è§£æï¼Ÿ"></a>4. ä»€ä¹ˆæ˜¯æ–‡æ¡£çš„é¢„è§£æï¼Ÿ</h2><p><strong>Webkit</strong> å’Œ <strong>Firefox</strong> éƒ½åšäº†è¿™ä¸ªä¼˜åŒ–ï¼Œå½“æ‰§è¡Œ <code>JavaScript</code> è„šæœ¬æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è§£æå‰©ä¸‹çš„æ–‡æ¡£ï¼Œå¹¶åŠ è½½åé¢éœ€è¦é€šè¿‡ç½‘ç»œåŠ è½½çš„èµ„æºã€‚è¿™ç§æ–¹å¼å¯ä»¥ä½¿èµ„æºå¹¶è¡ŒåŠ è½½ä»è€Œä½¿æ•´ä½“é€Ÿåº¦æ›´å¿«ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé¢„è§£æå¹¶ä¸æ”¹å˜ <code>DOM</code> æ ‘ï¼Œå®ƒå°†è¿™ä¸ªå·¥ä½œç•™ç»™ä¸»è§£æè¿‡ç¨‹ï¼Œè‡ªå·±åªè§£æå¤–éƒ¨èµ„æºçš„å¼•ç”¨ï¼Œæ¯”å¦‚å¤–éƒ¨è„šæœ¬ã€æ ·å¼è¡¨åŠå›¾ç‰‡ã€‚</p><h2 id="5-CSS-å¦‚ä½•é˜»å¡æ–‡æ¡£è§£æï¼Ÿ"><a href="#5-CSS-å¦‚ä½•é˜»å¡æ–‡æ¡£è§£æï¼Ÿ" class="headerlink" title="5. CSS å¦‚ä½•é˜»å¡æ–‡æ¡£è§£æï¼Ÿ"></a>5. CSS å¦‚ä½•é˜»å¡æ–‡æ¡£è§£æï¼Ÿ</h2><p>ç†è®ºä¸Šï¼Œæ—¢ç„¶æ ·å¼è¡¨ä¸æ”¹å˜ <code>DOM</code> æ ‘ï¼Œä¹Ÿå°±æ²¡æœ‰å¿…è¦åœä¸‹æ–‡æ¡£çš„è§£æç­‰å¾…å®ƒä»¬ã€‚ç„¶è€Œï¼Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œ <code>JavaScript</code> è„šæœ¬æ‰§è¡Œæ—¶å¯èƒ½åœ¨æ–‡æ¡£çš„è§£æè¿‡ç¨‹ä¸­è¯·æ±‚æ ·å¼ä¿¡æ¯ï¼Œå¦‚æœæ ·å¼è¿˜æ²¡æœ‰åŠ è½½å’Œè§£æï¼Œè„šæœ¬å°†å¾—åˆ°é”™è¯¯çš„å€¼ï¼Œæ˜¾ç„¶è¿™å°†ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜ã€‚æ‰€ä»¥å¦‚æœæµè§ˆå™¨å°šæœªå®Œæˆ <code>CSSOM</code> çš„ä¸‹è½½å’Œæ„å»ºï¼Œè€Œæˆ‘ä»¬å´æƒ³åœ¨æ­¤æ—¶è¿è¡Œè„šæœ¬ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°†å»¶è¿Ÿ <code>JavaScript</code> è„šæœ¬æ‰§è¡Œå’Œæ–‡æ¡£çš„è§£æï¼Œç›´è‡³å…¶å®Œæˆ <code>CSSOM</code> çš„ä¸‹è½½å’Œæ„å»ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¼šå…ˆä¸‹è½½å’Œæ„å»º <code>CSSOM</code> ï¼Œç„¶åå†æ‰§è¡Œ <code>JavaScript</code> ï¼Œæœ€åå†ç»§ç»­æ–‡æ¡£çš„è§£æã€‚</p><h2 id="6-å¦‚ä½•ä¼˜åŒ–å…³é”®æ¸²æŸ“è·¯å¾„ï¼Ÿ"><a href="#6-å¦‚ä½•ä¼˜åŒ–å…³é”®æ¸²æŸ“è·¯å¾„ï¼Ÿ" class="headerlink" title="6. å¦‚ä½•ä¼˜åŒ–å…³é”®æ¸²æŸ“è·¯å¾„ï¼Ÿ"></a>6. å¦‚ä½•ä¼˜åŒ–å…³é”®æ¸²æŸ“è·¯å¾„ï¼Ÿ</h2><p>ä¸ºå°½å¿«å®Œæˆé¦–æ¬¡æ¸²æŸ“ï¼Œæˆ‘ä»¬éœ€è¦æœ€å¤§é™åº¦å‡å°ä»¥ä¸‹ä¸‰ç§å¯å˜å› ç´ ï¼š</p><p> ï¼ˆ1ï¼‰å…³é”®èµ„æºçš„æ•°é‡ã€‚</p><p> ï¼ˆ2ï¼‰å…³é”®è·¯å¾„é•¿åº¦ã€‚</p><p> ï¼ˆ3ï¼‰å…³é”®å­—èŠ‚çš„æ•°é‡ã€‚</p><blockquote><p>å…³é”®èµ„æºæ˜¯å¯èƒ½é˜»æ­¢ç½‘é¡µé¦–æ¬¡æ¸²æŸ“çš„èµ„æºã€‚è¿™äº›èµ„æºè¶Šå°‘ï¼Œæµè§ˆå™¨çš„å·¥ä½œé‡å°±è¶Šå°ï¼Œå¯¹ CPU ä»¥åŠå…¶ä»–èµ„æºçš„å ç”¨ä¹Ÿå°±è¶Šå°‘ã€‚åŒæ ·ï¼Œå…³é”®è·¯å¾„é•¿åº¦å—æ‰€æœ‰å…³é”®èµ„æºä¸å…¶å­—èŠ‚å¤§å°ä¹‹é—´ä¾èµ–å…³ç³»å›¾çš„å½±å“ï¼šæŸäº›èµ„æºåªèƒ½åœ¨ä¸Šä¸€èµ„æºå¤„ç†å®Œæ¯•ä¹‹åæ‰èƒ½å¼€å§‹ä¸‹è½½ï¼Œå¹¶ä¸”èµ„æºè¶Šå¤§ï¼Œä¸‹è½½æ‰€éœ€çš„å¾€è¿”æ¬¡æ•°å°±è¶Šå¤šã€‚æœ€åï¼Œæµè§ˆå™¨éœ€è¦ä¸‹è½½çš„å…³é”®å­—èŠ‚è¶Šå°‘ï¼Œå¤„ç†å†…å®¹å¹¶è®©å…¶å‡ºç°åœ¨å±å¹•ä¸Šçš„é€Ÿåº¦å°±è¶Šå¿«ã€‚è¦å‡å°‘å­—èŠ‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å‡å°‘èµ„æºæ•°ï¼ˆå°†å®ƒä»¬åˆ é™¤æˆ–è®¾ä¸ºéå…³é”®èµ„æºï¼‰ï¼Œæ­¤å¤–è¿˜è¦å‹ç¼©å’Œä¼˜åŒ–å„é¡¹èµ„æºï¼Œç¡®ä¿æœ€å¤§é™åº¦å‡å°ä¼ é€å¤§å°ã€‚</p></blockquote><p>ä¼˜åŒ–å…³é”®æ¸²æŸ“è·¯å¾„çš„å¸¸è§„æ­¥éª¤å¦‚ä¸‹ï¼š</p><p> ï¼ˆ1ï¼‰å¯¹å…³é”®è·¯å¾„è¿›è¡Œåˆ†æå’Œç‰¹æ€§æè¿°ï¼šèµ„æºæ•°ã€å­—èŠ‚æ•°ã€é•¿åº¦ã€‚</p><p> ï¼ˆ2ï¼‰æœ€å¤§é™åº¦å‡å°‘å…³é”®èµ„æºçš„æ•°é‡ï¼šåˆ é™¤å®ƒä»¬ï¼Œå»¶è¿Ÿå®ƒä»¬çš„ä¸‹è½½ï¼Œå°†å®ƒä»¬æ ‡è®°ä¸ºå¼‚æ­¥ç­‰ã€‚</p><p> ï¼ˆ3ï¼‰ä¼˜åŒ–å…³é”®å­—èŠ‚æ•°ä»¥ç¼©çŸ­ä¸‹è½½æ—¶é—´ï¼ˆå¾€è¿”æ¬¡æ•°ï¼‰ã€‚</p><p> ï¼ˆ4ï¼‰ä¼˜åŒ–å…¶ä½™å…³é”®èµ„æºçš„åŠ è½½é¡ºåºï¼šæ‚¨éœ€è¦å°½æ—©ä¸‹è½½æ‰€æœ‰å…³é”®èµ„äº§ï¼Œä»¥ç¼©çŸ­å…³é”®è·¯å¾„é•¿åº¦</p><h2 id="7-ä»€ä¹ˆæƒ…å†µä¼šé˜»å¡æ¸²æŸ“ï¼Ÿ"><a href="#7-ä»€ä¹ˆæƒ…å†µä¼šé˜»å¡æ¸²æŸ“ï¼Ÿ" class="headerlink" title="7. ä»€ä¹ˆæƒ…å†µä¼šé˜»å¡æ¸²æŸ“ï¼Ÿ"></a>7. ä»€ä¹ˆæƒ…å†µä¼šé˜»å¡æ¸²æŸ“ï¼Ÿ</h2><p>é¦–å…ˆæ¸²æŸ“çš„å‰ææ˜¯ç”Ÿæˆæ¸²æŸ“æ ‘ï¼Œæ‰€ä»¥ <code>HTML</code> å’Œ <code>CSS</code> è‚¯å®šä¼šé˜»å¡æ¸²æŸ“ã€‚å¦‚æœä½ æƒ³æ¸²æŸ“çš„è¶Šå¿«ï¼Œä½ è¶Šåº”è¯¥é™ä½ä¸€å¼€å§‹éœ€è¦æ¸²æŸ“çš„æ–‡ä»¶å¤§å°ï¼Œå¹¶ä¸”æ‰å¹³å±‚çº§ï¼Œä¼˜åŒ–é€‰æ‹©å™¨ã€‚ç„¶åå½“æµè§ˆå™¨åœ¨è§£æåˆ° <code>script</code> æ ‡ç­¾æ—¶ï¼Œä¼šæš‚åœæ„å»º <code>DOMï¼Œå®Œæˆåæ‰ä¼šä»æš‚åœçš„åœ°æ–¹é‡æ–°å¼€å§‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æƒ³é¦–å±æ¸²æŸ“çš„è¶Šå¿«ï¼Œå°±è¶Šä¸åº”è¯¥åœ¨é¦–å±å°±åŠ è½½</code> JS æ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯éƒ½å»ºè®®å°† <code>script</code> æ ‡ç­¾æ”¾åœ¨ <code>body</code> æ ‡ç­¾åº•éƒ¨çš„åŸå› ã€‚</p><p>å½“ç„¶åœ¨å½“ä¸‹ï¼Œå¹¶ä¸æ˜¯è¯´ <code>script</code> æ ‡ç­¾å¿…é¡»æ”¾åœ¨åº•éƒ¨ï¼Œå› ä¸ºä½ å¯ä»¥ç»™ <code>script</code> æ ‡ç­¾æ·»åŠ  <code>defer</code> æˆ–è€… <code>async</code> å±æ€§ã€‚å½“ <code>script</code> æ ‡ç­¾åŠ ä¸Š <code>defer</code> å±æ€§ä»¥åï¼Œè¡¨ç¤ºè¯¥ JS æ–‡ä»¶ä¼šå¹¶è¡Œä¸‹è½½ï¼Œä½†æ˜¯ä¼šæ”¾åˆ° <code>HTML</code> è§£æå®Œæˆåé¡ºåºæ‰§è¡Œï¼Œæ‰€ä»¥å¯¹äºè¿™ç§æƒ…å†µä½ å¯ä»¥æŠŠ <code>script</code> æ ‡ç­¾æ”¾åœ¨ä»»æ„ä½ç½®ã€‚å¯¹äºæ²¡æœ‰ä»»ä½•ä¾èµ–çš„ JS æ–‡ä»¶å¯ä»¥åŠ ä¸Š <code>async</code> å±æ€§ï¼Œè¡¨ç¤º JS æ–‡ä»¶ä¸‹è½½å’Œè§£æä¸ä¼šé˜»å¡æ¸²æŸ“ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.yuque.com/cuggz/interview/browser">å‰ç«¯é¢è¯•é¢˜ä¹‹æµè§ˆå™¨åŸç†ç¯‡ - è¯­é›€</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>æµè§ˆå™¨</tag>
      
      <tag>åŸç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitè¿æ¥Githubå¤±è´¥è§£å†³åŠæ³•</title>
    <link href="/2022/07/03/2-git-connect-github-with-errors/"/>
    <url>/2022/07/03/2-git-connect-github-with-errors/</url>
    
    <content type="html"><![CDATA[<p class="note note-primary">å‡ºç°è¿™äº›é”™è¯¯å¤§å¤šæƒ…å†µä¸‹æ˜¯ç”±å½“å‰ä½¿ç”¨äº†ä»£ç†äº§ç”Ÿçš„ï¼Œå¦‚æœå…³é—­äº†ä»£ç†æ— æ³•ç›´è¿Githubå¯ä»¥å‚è€ƒä»¥ä¸‹è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="HTTP-x2F-2-stream"><a href="#HTTP-x2F-2-stream" class="headerlink" title="HTTP&#x2F;2 stream"></a>HTTP&#x2F;2 stream</h2><p class="note note-danger">HTTP/2 stream 1 was not closed cleanly before end of the underlying stream</p><ul><li>æç¤ºé»˜è®¤é€šä¿¡åè®®å‡ºé”™ï¼Œæ›´æ”¹é»˜è®¤é€šä¿¡åè®®</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git config --global http.version HTTP/1.1<br></code></pre></td></tr></table></figure><h2 id="OpenSSL-SSL-read"><a href="#OpenSSL-SSL-read" class="headerlink" title="OpenSSL SSL_read"></a>OpenSSL SSL_read</h2><p class="note note-danger">OpenSSL SSL_read: Connection was aborted, errno 10053</p><ul><li>å¯ä»¥å°è¯•å…³é—­SSLéªŒè¯ï¼Œåœ¨æ§åˆ¶å°è¾“å…¥å¦‚ä¸‹å‘½ä»¤å³å¯</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git config --global http.sslVerify <span class="hljs-string">&quot;false&quot;</span><br></code></pre></td></tr></table></figure><h2 id="Failed-to-connect"><a href="#Failed-to-connect" class="headerlink" title="Failed to connect"></a>Failed to connect</h2><p class="note note-danger">Failed to connect to github.com port 443 after 21224 ms: Timed out </p><p>æ­¤æƒ…å†µç½‘é¡µå¯ä»¥æ­£å¸¸æ‰“å¼€Githubï¼Œä½†æ˜¯æ— æ³•é€šè¿‡Gitè¿æ¥Githubã€‚è€Œåœ¨ç”µè„‘ä¸Šè¿è¡Œäº†ä»£ç†ç¨‹åºæˆ–ä½¿ç”¨äº†å…¶ä»–ä»£ç†æ‰‹æ®µå¯¼è‡´çš„ã€‚</p><h3 id="æ–¹æ³•ä¸€ï¼šé…ç½®-http-ä»£ç†"><a href="#æ–¹æ³•ä¸€ï¼šé…ç½®-http-ä»£ç†" class="headerlink" title="æ–¹æ³•ä¸€ï¼šé…ç½® http ä»£ç†"></a>æ–¹æ³•ä¸€ï¼šé…ç½® http ä»£ç†</h3><blockquote><p>Windows ä¸­ git é»˜è®¤ä¸ä¼šä½¿ç”¨ç³»ç»Ÿä»£ç†ï¼Œæ‰€ä»¥å³ä½¿è¿æ¥ä»£ç†æˆ–è€…æ‰“å¼€ä»£ç†è½¯ä»¶ï¼Œæµè§ˆå™¨ä»ç„¶å¯ä»¥è®¿é—® GitHub æˆ– Giteeï¼›ä½†æ˜¯ä½¿ç”¨ git å‘½ä»¤è¡Œè¿æ¥ GitHub æˆ– Gitee è¿œç¨‹ä»“åº“å¯èƒ½ä¼šå‡ºç°æ— æ³•è®¿é—®çš„ç°è±¡ã€‚é€šè¿‡ä¸º git é…ç½®ä»£ç†è§£å†³å‡ºç°çš„é—®é¢˜ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä»¥ä¸‹ host:port æŒ‡å®šæ˜¯ä½ å½“å‰ä»£ç†ä½¿ç”¨çš„ä¸»æœºåŠç«¯å£å·ã€‚ä¾‹å¦‚ï¼šlocalhost:7890ã€127.0.0.1:7890 ç­‰</span><br><br><span class="hljs-comment"># é…ç½®socks5ä»£ç†</span><br>git config --global http.proxy socks5 host:port<br>git config --global https.proxy socks5 host:port<br><br><span class="hljs-comment"># é…ç½®httpä»£ç†</span><br>git config --global http.proxy host:port<br>git config --global https.proxy host:port<br><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><ul><li>å‘½ä»¤ä¸­çš„ä¸»æœºå·(host)æ˜¯ä½¿ç”¨çš„ä»£ç†çš„ä¸»æœºå·ï¼Œå¦‚æœä»£ç†è½¯ä»¶è¿è¡Œåœ¨æœ¬æœºåˆ™å¡«å…¥127.0.0.1å³å¯ï¼Œå¦åˆ™å¡«å…¥ä»£ç†ä¸»æœº ip</li><li>å‘½ä»¤ä¸­çš„ç«¯å£å·ä¸ºä»£ç†è½¯ä»¶æˆ–ä»£ç†ä¸»æœºçš„ç›‘å¬IPï¼Œå¯ä»¥ä»ä»£ç†æœåŠ¡å™¨é…ç½®ä¸­è·å¾—</li><li>socks5å’Œhttpä¸¤ç§åè®®ç”±ä½¿ç”¨çš„ä»£ç†è½¯ä»¶å†³å®šï¼Œä¸åŒè½¯ä»¶å¯¹è¿™ä¸¤ç§åè®®çš„æ”¯æŒæœ‰å·®å¼‚ï¼Œå¦‚æœä¸ç¡®å®šå¯ä»¥éƒ½å°è¯•ä¸€ä¸‹</li></ul><p><strong>æŸ¥çœ‹ä»£ç†å‘½ä»¤ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git config --global --get http.proxy<br>git config --global --get https.proxy<br></code></pre></td></tr></table></figure><p><strong>å–æ¶ˆä»£ç†å‘½ä»¤:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git config --global --<span class="hljs-built_in">unset</span> http.proxy<br>git config --global --<span class="hljs-built_in">unset</span> https.proxy<br></code></pre></td></tr></table></figure><h3 id="æ–¹æ³•äºŒï¼šé…ç½®-SSH-ä»£ç†"><a href="#æ–¹æ³•äºŒï¼šé…ç½®-SSH-ä»£ç†" class="headerlink" title="æ–¹æ³•äºŒï¼šé…ç½® SSH ä»£ç†"></a>æ–¹æ³•äºŒï¼šé…ç½® SSH ä»£ç†</h3><p class="note note-primary">ä½¿ç”¨ https åè®®è¿æ¥è¾“å…¥è´¦å·å¯†ç æ¯”è¾ƒéº»çƒ¦ï¼Œè€Œä½¿ç”¨ SSH å¯†é’¥éªŒè¯è¿æ¥æ›´æ–¹ä¾¿ä¸”å®‰å…¨ã€‚å¯ä»¥ä¿®æ”¹ç³»ç»Ÿä¸­çš„ SSH é…ç½®è®¾ç½®ä»£ç†ï¼Œå¹¶ä¸”ç»•è¿‡ GFW çš„å°é”ã€‚</p><p>Windowså¹³å°é…ç½®æ–‡ä»¶ä½äºC:\Users$USERNAME$.ssh\configï¼Œå¦‚æœæ²¡æœ‰configæ–‡ä»¶ï¼Œè‡ªå·±åˆ›å»ºä¸€ä¸ªconfigæ–‡ä»¶ï¼Œå…¶ä¸­USERNAMEæ˜¯å½“å‰ç”µè„‘ç”¨æˆ·åã€‚</p><h4 id="Windows-å¹³å°"><a href="#Windows-å¹³å°" class="headerlink" title="Windows å¹³å°"></a>Windows å¹³å°</h4><ul><li><p>Windowså¹³å°çš„gitä¸­é¢„ç½®äº†connect.exeï¼Œå¯ä»¥ç”¨æ¥æ¥ç®¡gitçš„æµé‡ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹æœ¬åœ°SSHé…ç½®æ–‡ä»¶æ¥æ›´æ”¹gitçš„ä»£ç†è®¾ç½®ã€‚</p></li><li><p>Windowså¹³å°é…ç½®æ–‡ä»¶ä½äºC:\Users$USERNAME$.ssh\configï¼Œå¦‚æœæ²¡æœ‰configæ–‡ä»¶ï¼Œè‡ªå·±åˆ›å»ºä¸€ä¸ªconfigæ–‡ä»¶ï¼Œå…¶ä¸­USERNAMEæ˜¯å½“å‰ç”µè„‘ç”¨æˆ·åã€‚</p></li></ul><p>åœ¨æ–‡ä»¶ä¸­åŠ å…¥ä¸‹é¢é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Host github.com *.github.com <span class="hljs-comment"># æŒ‡å®šä»£ç†è§„åˆ™ä½œç”¨åŸŸ</span><br>  User git<br>  Port 22 <span class="hljs-comment"># ç«¯å£å·</span><br>  <span class="hljs-comment"># è‡ªå·±çš„ç§é’¥æ‰€åœ¨è·¯å¾„</span><br>  IdentityFile <span class="hljs-string">&quot;~\.ssh\id_rsa&quot;</span><br>  <span class="hljs-comment"># SOCKSä»£ç†è®¾ç½®æ–¹æ³•</span><br>  ProxyCommand connect -S ä¸»æœºå·:ç«¯å£ %h %p<br>  <span class="hljs-comment"># HTTPSä»£ç†è®¾ç½®æ–¹æ³•</span><br>  ProxyCommand connect -H ä¸»æœºå·:ç«¯å£ %h %p<br></code></pre></td></tr></table></figure><h4 id="Linux-æˆ–-Mac-OS"><a href="#Linux-æˆ–-Mac-OS" class="headerlink" title="Linux æˆ– Mac OS"></a>Linux æˆ– Mac OS</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Host github.com *.github.com<br>  User git<br>  Port 22<br>  IdentityFile <span class="hljs-string">&quot;~\.ssh\id_rsa&quot;</span><br>  <span class="hljs-comment"># SOCKSä»£ç†</span><br>  ProxyCommand nc -v -x ä¸»æœºå·:ç«¯å£ %h %p<br>  <span class="hljs-comment"># HTTPSä»£ç†</span><br>  ProxyCommand socat - PROXY:ä¸»æœºå·:%h:%p,proxyport=ç«¯å£<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><ul><li>ä¿®æ”¹ç³»ç»Ÿé…ç½®éœ€è¦ç®¡ç†å‘˜æƒé™</li><li>é€‰æ‹©SOCKS å’Œ HTTPSä»£ç†éœ€è¦æ ¹æ®ä»£ç†è½¯ä»¶æ”¯æŒçš„åè®®è€Œå®šï¼ŒäºŒé€‰ä¸€</li><li>å¦‚æœè¿æ¥å±€åŸŸç½‘ï¼ˆå†…ç½‘ï¼‰ä»£ç†ï¼Œhostè®¾ç½®ä¸ºä»£ç†æœåŠ¡å™¨åœ°å€å³å¯ï¼Œç«¯å£å·åˆ™è®¾ç½®ä¸ºä»£ç†æœåŠ¡å™¨ç«¯å£å·</li><li>å¦‚æœè½¯ä»¶åœ¨æœ¬æœºè¿è¡Œï¼Œhostè®¾ç½®ä¸ºæœ¬æœºï¼ˆ127.0.0.1ï¼‰å³å¯ï¼Œç«¯å£å·åˆ™è®¾ç½®ä¸ºä»£ç†è½¯ä»¶çš„ç›‘å¬ç«¯å£å·</li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://blog.csdn.net/wls666/article/details/123270948">git æŠ¥é”™Failed to connect to github.com port 443 after 21224 ms: Timed out è§£å†³åŠæ³• - CSDN</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Git</tag>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTTPSåè®®æ˜¯å¦‚ä½•è¿›è¡ŒåŠ å¯†ä¼ è¾“çš„</title>
    <link href="/2022/07/02/1-talk-about-https/"/>
    <url>/2022/07/02/1-talk-about-https/</url>
    
    <content type="html"><![CDATA[<h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p class="note note-primary">HTTP ä¸ HTTPS æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</p><ol><li><p><code>HTTP</code> æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä¿¡æ¯æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œå­˜åœ¨å®‰å…¨é£é™©çš„é—®é¢˜ã€‚<code>HTTPS</code> åˆ™è§£å†³ <code>HTTP</code> ä¸å®‰å…¨çš„ç¼ºé™·ï¼Œåœ¨<code>TCP</code> å’Œ <code>HTTP</code> â½¹ç»œå±‚ä¹‹é—´åŠ â¼Šäº† <code>SSL/TLS</code> å®‰å…¨åè®®ï¼Œä½¿å¾—æŠ¥æ–‡èƒ½å¤ŸåŠ å¯†ä¼ è¾“ã€‚ </p></li><li><p><code>HTTP</code> è¿æ¥å»ºç«‹ç›¸å¯¹ç®€å•ï¼Œ <code>TCP</code> ä¸‰æ¬¡æ¡æ‰‹ä¹‹åä¾¿å¯è¿›â¾ <code>HTTP</code> çš„æŠ¥æ–‡ä¼ è¾“ã€‚è€Œ <code>HTTPS</code> åœ¨ <code>TCP</code> ä¸‰æ¬¡æ¡æ‰‹ä¹‹åï¼Œè¿˜éœ€è¿›â¾ <code>SSL/TLS</code> çš„æ¡æ‰‹è¿‡ç¨‹ï¼Œæ‰å¯è¿›â¼ŠåŠ å¯†æŠ¥æ–‡ä¼ è¾“ã€‚ </p></li><li><p><code>HTTP</code> çš„ç«¯å£å·æ˜¯ <code>80</code>ï¼Œ<code>HTTPS</code> çš„ç«¯å£å·æ˜¯ <code>443</code>ã€‚ </p></li><li><p><code>HTTPS</code> åè®®éœ€è¦å‘ CAï¼ˆè¯ä¹¦æƒå¨æœºæ„ï¼‰ç”³è¯·æ•°å­—è¯ä¹¦ï¼Œæ¥ä¿è¯æœåŠ¡å™¨çš„èº«ä»½æ˜¯å¯ä¿¡çš„ã€‚</p></li></ol><p><img src="https://image.origin-tec.com/img/c582480c316a76377928f5da6bf12e96@841x404.png" alt="httpåè®®ä¸httpsåè®®ç»“æ„ç¤ºæ„å›¾"></p><p class="note note-primary">HTTPS åœ¨ HTTP ä¸ TCP å±‚ä¹‹é—´åŠ â¼Šäº† SSL/TLS åè®®</p><ul><li>ä¿¡æ¯åŠ å¯†ï¼šäº¤äº’ä¿¡æ¯æ— æ³•è¢«çªƒå–ï¼Œä½†ä½ çš„å·ä¼šå› ä¸ºã€Œè‡ªèº«å¿˜è®°ã€è´¦å·è€Œæ²¡ã€‚</li><li>æ ¡éªŒæœºåˆ¶ï¼šæ— æ³•ç¯¡æ”¹é€šä¿¡å†…å®¹ï¼Œç¯¡æ”¹äº†å°±ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œä½†ç™¾åº¦ã€Œç«ä»·æ’åã€ä¾ç„¶å¯ä»¥æœç´¢åƒåœ¾å¹¿å‘Šã€‚</li><li>èº«ä»½è¯ä¹¦ï¼šè¯æ˜æ·˜å®æ˜¯çœŸçš„æ·˜å®â½¹ï¼Œä½†ä½ çš„é’±è¿˜æ˜¯ä¼šå› ä¸ºã€Œå‰æ‰‹ã€è€Œæ²¡ã€‚</li></ul><blockquote><p>å¯è§ï¼Œåªè¦è‡ªèº«ä¸åšã€Œæ¶ã€ï¼ŒSSL&#x2F;TLS åè®®æ˜¯èƒ½ä¿è¯é€šä¿¡æ˜¯å®‰å…¨çš„</p></blockquote><h3 id="1-æ··åˆåŠ å¯†"><a href="#1-æ··åˆåŠ å¯†" class="headerlink" title="1. æ··åˆåŠ å¯†"></a>1. æ··åˆåŠ å¯†</h3><blockquote><p>é€šè¿‡æ··åˆåŠ å¯†çš„æ–¹å¼å¯ä»¥ä¿è¯ä¿¡æ¯çš„æœºå¯†æ€§ï¼Œè§£å†³äº†çªƒå¬çš„é£é™©ã€‚</p></blockquote><p><img src="https://image.origin-tec.com/img/7625e8818660455ace40e976ef35ca53@637x513.png" alt="httpsåŠ å¯†ä¼ è¾“ç¤ºæ„å›¾"></p><h4 id="HTTPS-é‡‡ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ç»“åˆçš„ã€Œæ··åˆåŠ å¯†ã€æ–¹å¼ï¼š"><a href="#HTTPS-é‡‡ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ç»“åˆçš„ã€Œæ··åˆåŠ å¯†ã€æ–¹å¼ï¼š" class="headerlink" title="HTTPS é‡‡ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ç»“åˆçš„ã€Œæ··åˆåŠ å¯†ã€æ–¹å¼ï¼š"></a>HTTPS é‡‡ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ç»“åˆçš„ã€Œæ··åˆåŠ å¯†ã€æ–¹å¼ï¼š</h4><ul><li><p>åœ¨é€šä¿¡å»ºç«‹å‰é‡‡ç”¨éå¯¹ç§°åŠ å¯†çš„æ–¹å¼äº¤æ¢ã€Œä¼šè¯ç§˜é’¥ã€ï¼Œåç»­å°±ä¸å†ä½¿ç”¨éå¯¹ç§°åŠ å¯†ã€‚</p></li><li><p>åœ¨é€šä¿¡è¿‡ç¨‹ä¸­å…¨éƒ¨ä½¿ç”¨å¯¹ç§°åŠ å¯†çš„ã€Œä¼šè¯ç§˜é’¥ã€çš„æ–¹å¼åŠ å¯†æ˜æ–‡æ•°æ®ã€‚</p></li></ul><h4 id="é‡‡ç”¨ã€Œæ··åˆåŠ å¯†ã€çš„æ–¹å¼çš„åŸå› ï¼š"><a href="#é‡‡ç”¨ã€Œæ··åˆåŠ å¯†ã€çš„æ–¹å¼çš„åŸå› ï¼š" class="headerlink" title="é‡‡ç”¨ã€Œæ··åˆåŠ å¯†ã€çš„æ–¹å¼çš„åŸå› ï¼š"></a>é‡‡ç”¨ã€Œæ··åˆåŠ å¯†ã€çš„æ–¹å¼çš„åŸå› ï¼š</h4><ul><li><p>å¯¹ç§°åŠ å¯†åªä½¿ç”¨â¼€ä¸ªå¯†é’¥ï¼Œè¿ç®—é€Ÿåº¦å¿«ï¼Œå¯†é’¥å¿…é¡»ä¿å¯†ï¼Œæ— æ³•åšåˆ°å®‰å…¨çš„å¯†é’¥äº¤æ¢ã€‚</p></li><li><p>éå¯¹ç§°åŠ å¯†ä½¿ç”¨ä¸¤ä¸ªå¯†é’¥ï¼šå…¬é’¥å’Œç§é’¥ï¼Œå…¬é’¥å¯ä»¥ä»»æ„åˆ†å‘è€Œç§é’¥ä¿å¯†ï¼Œè§£å†³äº†å¯†é’¥äº¤æ¢é—®é¢˜ä½†é€Ÿåº¦æ…¢ã€‚</p></li></ul><h3 id="2-æ‘˜è¦ç®—æ³•"><a href="#2-æ‘˜è¦ç®—æ³•" class="headerlink" title="2. æ‘˜è¦ç®—æ³•"></a>2. æ‘˜è¦ç®—æ³•</h3><blockquote><p>æ‘˜è¦ç®—æ³•ç”¨æ¥å®ç°å®Œæ•´æ€§ï¼Œèƒ½å¤Ÿä¸ºæ•°æ®ç”Ÿæˆç‹¬â¼€æ— äºŒçš„ã€ŒæŒ‡çº¹ã€ï¼Œç”¨äºæ ¡éªŒæ•°æ®çš„å®Œæ•´æ€§ï¼Œè§£å†³äº†ç¯¡æ”¹çš„é£é™©ã€‚</p></blockquote><p><img src="https://image.origin-tec.com/img/12b4ea8cc14b8dc4de9581b921a9941a@687x269.png" alt="æ‘˜è¦ç®—æ³•"></p><p>å®¢æˆ·ç«¯åœ¨å‘é€æ˜æ–‡ä¹‹å‰ä¼šé€šè¿‡æ‘˜è¦ç®—æ³•ç®—å‡ºæ˜æ–‡çš„ã€ŒæŒ‡çº¹ã€ï¼Œå‘é€çš„æ—¶å€™æŠŠã€ŒæŒ‡çº¹ + æ˜æ–‡ã€â¼€åŒåŠ å¯†æˆå¯†æ–‡åï¼Œå‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è§£å¯†åï¼Œç”¨ç›¸åŒçš„æ‘˜è¦ç®—æ³•ç®—å‡ºå‘é€è¿‡æ¥çš„æ˜æ–‡ï¼Œé€šè¿‡â½è¾ƒå®¢æˆ·ç«¯æºå¸¦çš„ã€ŒæŒ‡çº¹ã€å’Œå½“å‰ç®—å‡ºçš„ã€ŒæŒ‡çº¹ã€åšâ½è¾ƒï¼Œè‹¥ã€ŒæŒ‡çº¹ã€ç›¸åŒï¼Œè¯´æ˜æ•°æ®æ˜¯å®Œæ•´çš„ã€‚</p><h3 id="3-æ•°å­—è¯ä¹¦"><a href="#3-æ•°å­—è¯ä¹¦" class="headerlink" title="3. æ•°å­—è¯ä¹¦"></a>3. æ•°å­—è¯ä¹¦</h3><blockquote><p>å®¢æˆ·ç«¯å…ˆå‘æœåŠ¡å™¨ç«¯ç´¢è¦å…¬é’¥ï¼Œç„¶åç”¨å…¬é’¥åŠ å¯†ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯†æ–‡åï¼Œç”¨â¾ƒâ¼°çš„ç§é’¥è§£å¯†ã€‚</p></blockquote><p><img src="https://image.origin-tec.com/img/36411ba174f87f0aebe044f179fe07d1@692x533.png" alt="æ•°å­—è¯ä¹¦"></p><p>è¿™å°±å­˜åœ¨äº›é—®é¢˜ï¼Œå¦‚ä½•ä¿è¯å…¬é’¥ä¸è¢«ç¯¡æ”¹å’Œä¿¡ä»»åº¦ï¼Ÿ</p><p>æ‰€ä»¥è¿™â¾¥å°±éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹æƒå¨æœºæ„ CA ï¼ˆæ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼‰ï¼Œå°†<strong>æœåŠ¡å™¨å…¬é’¥æ”¾åœ¨æ•°å­—è¯ä¹¦</strong>ï¼ˆç”±æ•°å­—è¯ä¹¦è®¤è¯æœºæ„é¢å‘ï¼‰ä¸­ï¼Œåªè¦è¯ä¹¦æ˜¯å¯ä¿¡çš„ï¼Œå…¬é’¥å°±æ˜¯å¯ä¿¡çš„ã€‚</p><p>é€šè¿‡æ•°å­—è¯ä¹¦çš„æ–¹å¼ä¿è¯æœåŠ¡å™¨å…¬é’¥çš„èº«ä»½ï¼Œè§£å†³å†’å……çš„é£é™©ã€‚</p><p class="note note-primary">HTTPS æ˜¯å¦‚ä½•å»ºç«‹è¿æ¥çš„ï¼Ÿå…¶é—´äº¤äº’äº†ä»€ä¹ˆï¼Ÿ</p><p><code>SSL/TLS</code> åè®®åŸºæœ¬æµç¨‹ï¼š</p><ul><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç´¢è¦å¹¶éªŒè¯æœåŠ¡å™¨çš„å…¬é’¥ã€‚</li><li>åŒæ–¹åå•†ç”Ÿäº§ã€Œä¼šè¯ç§˜é’¥ã€ã€‚</li><li>åŒæ–¹é‡‡ç”¨ã€Œä¼šè¯ç§˜é’¥ã€è¿›â¾åŠ å¯†é€šä¿¡ã€‚</li></ul><h3 id="SSL-x2F-TLS-åè®®å»ºç«‹çš„è¯¦ç»†æµç¨‹ï¼š"><a href="#SSL-x2F-TLS-åè®®å»ºç«‹çš„è¯¦ç»†æµç¨‹ï¼š" class="headerlink" title="SSL&#x2F;TLS åè®®å»ºç«‹çš„è¯¦ç»†æµç¨‹ï¼š"></a>SSL&#x2F;TLS åè®®å»ºç«‹çš„è¯¦ç»†æµç¨‹ï¼š</h3><h4 id="1-ClientHello"><a href="#1-ClientHello" class="headerlink" title="1. ClientHello"></a>1. ClientHello</h4><blockquote><p>é¦–å…ˆï¼Œç”±å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·åŠ å¯†é€šä¿¡è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯ <code>ClientHello</code> è¯·æ±‚ã€‚ åœ¨è¿™â¼€æ­¥ï¼Œå®¢æˆ·ç«¯ä¸»è¦å‘æœåŠ¡å™¨å‘é€ä»¥ä¸‹ä¿¡æ¯ï¼š </p></blockquote><p>ï¼ˆ1ï¼‰å®¢æˆ·ç«¯æ”¯æŒçš„ SSL&#x2F;TLS åè®®ç‰ˆæœ¬ï¼Œå¦‚ TLS 1.2 ç‰ˆæœ¬ã€‚<br>ï¼ˆ2ï¼‰å®¢æˆ·ç«¯ç”Ÿäº§çš„éšæœºæ•°ï¼ˆ <code>Client Random</code> ï¼‰ï¼Œåé¢ç”¨äºç”Ÿäº§ã€Œä¼šè¯ç§˜é’¥ã€ã€‚<br>ï¼ˆ3ï¼‰å®¢æˆ·ç«¯æ”¯æŒçš„å¯†ç å¥—ä»¶åˆ—è¡¨ï¼Œå¦‚ RSA åŠ å¯†ç®—æ³•ã€‚ </p><h4 id="2-SeverHello"><a href="#2-SeverHello" class="headerlink" title="2. SeverHello"></a>2. SeverHello</h4><blockquote><p>æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åï¼Œå‘å®¢æˆ·ç«¯å‘å‡ºå“åº”ï¼Œä¹Ÿå°±æ˜¯ <code>SeverHello</code> ã€‚æœåŠ¡å™¨å›åº”çš„å†…å®¹æœ‰å¦‚ä¸‹å†…å®¹ï¼š </p></blockquote><p>ï¼ˆ1ï¼‰ç¡®è®¤ SSL&#x2F; TLS åè®®ç‰ˆæœ¬ï¼Œå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒï¼Œåˆ™å…³é—­åŠ å¯†é€šä¿¡ã€‚<br>ï¼ˆ2ï¼‰æœåŠ¡å™¨ç”Ÿäº§çš„éšæœºæ•°ï¼ˆ <code>Server Random</code> ï¼‰ï¼Œåé¢ç”¨äºç”Ÿäº§ã€Œä¼šè¯ç§˜é’¥ã€ã€‚<br>ï¼ˆ3ï¼‰ç¡®è®¤çš„å¯†ç å¥—ä»¶åˆ—è¡¨ï¼Œå¦‚ RSA åŠ å¯†ç®—æ³•ã€‚<br>ï¼ˆ4ï¼‰æœåŠ¡å™¨çš„æ•°å­—è¯ä¹¦ã€‚ </p><h4 id="3-å®¢æˆ·ç«¯å›åº”"><a href="#3-å®¢æˆ·ç«¯å›åº”" class="headerlink" title="3. å®¢æˆ·ç«¯å›åº”"></a>3. å®¢æˆ·ç«¯å›åº”</h4><blockquote><p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„å›åº”ä¹‹åï¼Œé¦–å…ˆé€šè¿‡æµè§ˆå™¨æˆ–è€…æ“ä½œç³»ç»Ÿä¸­çš„ CA å…¬é’¥ï¼Œç¡®è®¤æœåŠ¡å™¨çš„æ•°å­—è¯ä¹¦çš„çœŸå®æ€§ã€‚<br>å¦‚æœè¯ä¹¦æ²¡æœ‰é—®é¢˜ï¼Œå®¢æˆ·ç«¯ä¼šä»æ•°å­—è¯ä¹¦ä¸­å–å‡ºæœåŠ¡å™¨çš„å…¬é’¥ï¼Œç„¶åä½¿ç”¨å®ƒåŠ å¯†æŠ¥æ–‡ï¼Œå‘æœåŠ¡å™¨å‘é€å¦‚ä¸‹ä¿¡æ¯ï¼š </p></blockquote><p>ï¼ˆ1ï¼‰â¼€ä¸ªéšæœºæ•°ï¼ˆ <code>pre-master key</code> ï¼‰ã€‚è¯¥éšæœºæ•°ä¼šè¢«æœåŠ¡å™¨å…¬é’¥åŠ å¯†ã€‚<br>ï¼ˆ2ï¼‰åŠ å¯†é€šä¿¡ç®—æ³•æ”¹å˜é€šçŸ¥ï¼Œè¡¨ç¤ºéšåçš„ä¿¡æ¯éƒ½å°†ç”¨ã€Œä¼šè¯ç§˜é’¥ã€åŠ å¯†é€šä¿¡ã€‚<br>ï¼ˆ3ï¼‰å®¢æˆ·ç«¯æ¡æ‰‹ç»“æŸé€šçŸ¥ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„æ¡æ‰‹é˜¶æ®µå·²ç»ç»“æŸã€‚è¿™â¼€é¡¹åŒæ—¶æŠŠä¹‹å‰æ‰€æœ‰å†…å®¹çš„å‘ç”Ÿçš„æ•°æ®åšä¸ªæ‘˜è¦ï¼Œç”¨æ¥ä¾›æœåŠ¡ç«¯æ ¡éªŒã€‚ä¸Šé¢ç¬¬â¼€é¡¹çš„éšæœºæ•°æ˜¯æ•´ä¸ªæ¡æ‰‹é˜¶æ®µçš„ç¬¬ä¸‰ä¸ªéšæœºæ•°ï¼Œè¿™æ ·æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å°±åŒæ—¶æœ‰ä¸‰ä¸ªéšæœºæ•°ï¼Œæ¥ç€å°±ç”¨åŒæ–¹åå•†çš„åŠ å¯†ç®—æ³•ï¼Œå„â¾ƒç”Ÿæˆæœ¬æ¬¡é€šä¿¡çš„ã€Œä¼šè¯ç§˜é’¥ã€ã€‚</p><h4 id="4-æœåŠ¡å™¨çš„æœ€åå›åº”"><a href="#4-æœåŠ¡å™¨çš„æœ€åå›åº”" class="headerlink" title="4. æœåŠ¡å™¨çš„æœ€åå›åº”"></a>4. æœåŠ¡å™¨çš„æœ€åå›åº”</h4><blockquote><p>æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¬¬ä¸‰ä¸ªéšæœºæ•°ï¼ˆ <code>pre-master key</code> ï¼‰ä¹‹åï¼Œé€šè¿‡åå•†çš„åŠ å¯†ç®—æ³•ï¼Œè®¡ç®—å‡ºæœ¬æ¬¡é€šä¿¡çš„ã€Œä¼šè¯ç§˜é’¥ã€ã€‚ç„¶åï¼Œå‘å®¢æˆ·ç«¯å‘ç”Ÿæœ€åçš„ä¿¡æ¯ï¼š </p></blockquote><p>ï¼ˆ1ï¼‰åŠ å¯†é€šä¿¡ç®—æ³•æ”¹å˜é€šçŸ¥ï¼Œè¡¨ç¤ºéšåçš„ä¿¡æ¯éƒ½å°†ç”¨ã€Œä¼šè¯ç§˜é’¥ã€åŠ å¯†é€šä¿¡ã€‚<br>ï¼ˆ2ï¼‰æœåŠ¡å™¨æ¡æ‰‹ç»“æŸé€šçŸ¥ï¼Œè¡¨ç¤ºæœåŠ¡å™¨çš„æ¡æ‰‹é˜¶æ®µå·²ç»ç»“æŸã€‚è¿™â¼€é¡¹åŒæ—¶æŠŠä¹‹å‰æ‰€æœ‰å†…å®¹çš„å‘ç”Ÿçš„æ•°æ®åšä¸ªæ‘˜è¦ï¼Œç”¨æ¥ä¾›å®¢æˆ·ç«¯æ ¡éªŒã€‚â¾„æ­¤ï¼Œæ•´ä¸ª SSL&#x2F;TLS çš„æ¡æ‰‹é˜¶æ®µå…¨éƒ¨ç»“æŸã€‚æ¥ä¸‹æ¥ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿›â¼ŠåŠ å¯†é€šä¿¡ï¼Œå°±å®Œå…¨æ˜¯ä½¿ç”¨æ™®é€šçš„ HTTPåè®®ï¼Œåªä¸è¿‡ç”¨ã€Œä¼šè¯ç§˜é’¥ã€åŠ å¯†å†…å®¹ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://blog.csdn.net/qq_34827674/article/details/124089736">å›¾è§£ç½‘ç»œ - å°æ—Coding - CSDN</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
      <category>WEBå®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      
      <tag>HTTPS</tag>
      
      <tag>Webå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
